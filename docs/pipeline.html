<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Pipeline | Lecture notes for &quot;Introduction to Stochastic Processes&quot;</title>
  <meta name="description" content="A set of lecture notes for M362M: Introduction to Stochastic Processes" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Pipeline | Lecture notes for &quot;Introduction to Stochastic Processes&quot;" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A set of lecture notes for M362M: Introduction to Stochastic Processes" />
  <meta name="github-repo" content="gordanz/M362M" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Pipeline | Lecture notes for &quot;Introduction to Stochastic Processes&quot;" />
  
  <meta name="twitter:description" content="A set of lecture notes for M362M: Introduction to Stochastic Processes" />
  

<meta name="author" content="Gordan Zitkovic" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simulation-of-random-variables-and-monte-carlo.html"/>
<link rel="next" href="dist.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">M362M Lecture notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> An intro to R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#setting-up-an-r-environment-on-your-computer"><i class="fa fa-check"></i><b>1.1</b> Setting up an R environment on your computer</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#installing-r"><i class="fa fa-check"></i><b>1.1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#installing-rstudio"><i class="fa fa-check"></i><b>1.1.2</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.1.3" data-path="intro.html"><a href="intro.html#installing-basic-packages"><i class="fa fa-check"></i><b>1.1.3</b> Installing basic packages</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#learning-the-basics-of-r"><i class="fa fa-check"></i><b>1.2</b> Learning the basics of R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#the-console-scripts-and-r-notebooks"><i class="fa fa-check"></i><b>1.2.1</b> The console, Scripts and R Notebooks</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#asking-for-help"><i class="fa fa-check"></i><b>1.2.2</b> Asking for help</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#vectors"><i class="fa fa-check"></i><b>1.2.3</b> Vectors</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#matrices"><i class="fa fa-check"></i><b>1.2.4</b> Matrices</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#functions"><i class="fa fa-check"></i><b>1.2.5</b> Functions</a></li>
<li class="chapter" data-level="1.2.6" data-path="intro.html"><a href="intro.html#if-else-statements"><i class="fa fa-check"></i><b>1.2.6</b> If-else statements</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#problems"><i class="fa fa-check"></i><b>1.3</b> Problems</a></li>
</ul></li>
<li class="part"><span><b>I Probability and Simulation</b></span></li>
<li class="chapter" data-level="2" data-path="simulation-of-random-variables-and-monte-carlo.html"><a href="simulation-of-random-variables-and-monte-carlo.html"><i class="fa fa-check"></i><b>2</b> Simulation of Random Variables and Monte Carlo</a>
<ul>
<li class="chapter" data-level="2.1" data-path="simulation-of-random-variables-and-monte-carlo.html"><a href="simulation-of-random-variables-and-monte-carlo.html#simulation-of-some-common-probability-distributions"><i class="fa fa-check"></i><b>2.1</b> Simulation of some common probability distributions</a></li>
<li class="chapter" data-level="2.2" data-path="simulation-of-random-variables-and-monte-carlo.html"><a href="simulation-of-random-variables-and-monte-carlo.html#additional-problems"><i class="fa fa-check"></i><b>2.2</b> Additional Problems</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>3</b> Pipeline</a>
<ul>
<li class="chapter" data-level="3.1" data-path="pipeline.html"><a href="pipeline.html#multivariate-distributions"><i class="fa fa-check"></i><b>3.1</b> Multivariate Distributions</a></li>
<li class="chapter" data-level="3.2" data-path="pipeline.html"><a href="pipeline.html#monte-carlo"><i class="fa fa-check"></i><b>3.2</b> Monte Carlo</a></li>
<li class="chapter" data-level="3.3" data-path="pipeline.html"><a href="pipeline.html#conditional-probability-and-independence."><i class="fa fa-check"></i><b>3.3</b> Conditional probability and independence.</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="dist.html"><a href="dist.html"><i class="fa fa-check"></i><b>A</b> Probability Distributions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="dist.html"><a href="dist.html#discrete-distributions"><i class="fa fa-check"></i><b>A.1</b> Discrete distributions:</a></li>
<li class="chapter" data-level="A.2" data-path="dist.html"><a href="dist.html#continuous-distributions"><i class="fa fa-check"></i><b>A.2</b> Continuous distributions:</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lecture notes for "Introduction to Stochastic Processes"</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pipeline" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Pipeline</h1>
<div id="multivariate-distributions" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Multivariate Distributions</h2>

<div class="exercise">
<p><span id="exr:unnamed-chunk-79" class="exercise"><strong>Problem 3.1  </strong></span>Let <code>x</code> contain <span class="math inline">\(10,000\)</span> draws from <span class="math inline">\(N(0,1)\)</span>, <code>y</code> another <span class="math inline">\(10,000\)</span> draws from <span class="math inline">\(N(0,1)\)</span> and let <code>z=x+y</code>.</p>
<ol style="list-style-type: decimal">
<li>Draw a scatterplot of <code>x</code> and <code>y</code>.</li>
<li>If you apply the function <code>sample</code> to <code>y</code> (without any additional arguments) it will randomly permute the components of <code>y</code>. Draw a scatterplot of <code>x</code> and <code>sample(y)</code>; does it qualitatively differ from the scatterplot of <code>x</code> and <code>y</code> your drew in 1. above? Try a few times to get a feel for the variability.
</div>
<strong>Solution:</strong></li>
</ol>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="pipeline.html#cb54-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb54-2"><a href="pipeline.html#cb54-2" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb54-3"><a href="pipeline.html#cb54-3" aria-hidden="true"></a>z =<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="pipeline.html#cb55-1" aria-hidden="true"></a><span class="kw">library</span>(hexbin)</span>
<span id="cb55-2"><a href="pipeline.html#cb55-2" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">hexbin</span>(x, y))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="pipeline.html#cb56-1" aria-hidden="true"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb56-2"><a href="pipeline.html#cb56-2" aria-hidden="true"></a><span class="co">## Create cuts:</span></span>
<span id="cb56-3"><a href="pipeline.html#cb56-3" aria-hidden="true"></a>x_c &lt;-<span class="st"> </span><span class="kw">cut</span>(x, <span class="dv">20</span>)</span>
<span id="cb56-4"><a href="pipeline.html#cb56-4" aria-hidden="true"></a>y_c &lt;-<span class="st"> </span><span class="kw">cut</span>(y, <span class="dv">20</span>)</span>
<span id="cb56-5"><a href="pipeline.html#cb56-5" aria-hidden="true"></a></span>
<span id="cb56-6"><a href="pipeline.html#cb56-6" aria-hidden="true"></a><span class="co">## Calculate joint counts at cut levels:</span></span>
<span id="cb56-7"><a href="pipeline.html#cb56-7" aria-hidden="true"></a>z &lt;-<span class="st"> </span><span class="kw">table</span>(x_c, y_c)</span>
<span id="cb56-8"><a href="pipeline.html#cb56-8" aria-hidden="true"></a></span>
<span id="cb56-9"><a href="pipeline.html#cb56-9" aria-hidden="true"></a><span class="co">## Plot as a 3D histogram:</span></span>
<span id="cb56-10"><a href="pipeline.html#cb56-10" aria-hidden="true"></a><span class="kw">hist3D</span>(<span class="dt">z =</span> z, <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">zlab =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="pipeline.html#cb57-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb57-2"><a href="pipeline.html#cb57-2" aria-hidden="true"></a><span class="kw">library</span>(plot3D)</span>
<span id="cb57-3"><a href="pipeline.html#cb57-3" aria-hidden="true"></a>knitr<span class="op">::</span>knit_hooks<span class="op">$</span><span class="kw">set</span>(<span class="dt">webgl =</span> hook_webgl)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="pipeline.html#cb58-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>))</span>
<span id="cb58-2"><a href="pipeline.html#cb58-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb58-3"><a href="pipeline.html#cb58-3" aria-hidden="true"></a>z &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span><span class="kw">atan2</span>(x, y)</span>
<span id="cb58-4"><a href="pipeline.html#cb58-4" aria-hidden="true"></a><span class="kw">plot3d</span>(x, y, z, <span class="dt">col =</span> <span class="kw">rainbow</span>(<span class="dv">1000</span>))</span></code></pre></div>
<script>/*
* Copyright (C) 2009 Apple Inc. All Rights Reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
* 1. Redistributions of source code must retain the above copyright
*    notice, this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright
*    notice, this list of conditions and the following disclaimer in the
*    documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
* PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* Copyright (2016) Duncan Murdoch - fixed CanvasMatrix4.ortho,
* cleaned up.
*/
/*
CanvasMatrix4 class
This class implements a 4x4 matrix. It has functions which
duplicate the functionality of the OpenGL matrix stack and
glut functions.
IDL:
[
Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4
Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)
Constructor()                                   // create new CanvasMatrix4 with identity matrix
]
interface CanvasMatrix4 {
attribute float m11;
attribute float m12;
attribute float m13;
attribute float m14;
attribute float m21;
attribute float m22;
attribute float m23;
attribute float m24;
attribute float m31;
attribute float m32;
attribute float m33;
attribute float m34;
attribute float m41;
attribute float m42;
attribute float m43;
attribute float m44;
void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix
void load(in sequence<float> array);                // copy 16 floats into the matrix
sequence<float> getAsArray();                       // return the matrix as an array of 16 floats
WebGLFloatArray getAsCanvasFloatArray();           // return the matrix as a WebGLFloatArray with 16 values
void makeIdentity();                                // replace the matrix with identity
void transpose();                                   // replace the matrix with its transpose
void invert();                                      // replace the matrix with its inverse
void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right
void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right
void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right
in float x, in float y, in float z);    // (angle is in degrees)
void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right
void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left
void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right
in float bottom, in float top,
in float near, in float far);
void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right
in float bottom, in float top,
in float near, in float far);
void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right
in float zNear, in float zFar);
void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat
in float ctrx, in float ctry, in float ctrz,    // values on the right
in float upx, in float upy, in float upz);
}
*/
CanvasMatrix4 = function(m)
{
if (typeof m == 'object') {
if ("length" in m && m.length >= 16) {
this.load(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);
return;
}
else if (m instanceof CanvasMatrix4) {
this.load(m);
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.load = function()
{
if (arguments.length == 1 && typeof arguments[0] == 'object') {
var matrix = arguments[0];
if ("length" in matrix && matrix.length == 16) {
this.m11 = matrix[0];
this.m12 = matrix[1];
this.m13 = matrix[2];
this.m14 = matrix[3];
this.m21 = matrix[4];
this.m22 = matrix[5];
this.m23 = matrix[6];
this.m24 = matrix[7];
this.m31 = matrix[8];
this.m32 = matrix[9];
this.m33 = matrix[10];
this.m34 = matrix[11];
this.m41 = matrix[12];
this.m42 = matrix[13];
this.m43 = matrix[14];
this.m44 = matrix[15];
return;
}
if (arguments[0] instanceof CanvasMatrix4) {
this.m11 = matrix.m11;
this.m12 = matrix.m12;
this.m13 = matrix.m13;
this.m14 = matrix.m14;
this.m21 = matrix.m21;
this.m22 = matrix.m22;
this.m23 = matrix.m23;
this.m24 = matrix.m24;
this.m31 = matrix.m31;
this.m32 = matrix.m32;
this.m33 = matrix.m33;
this.m34 = matrix.m34;
this.m41 = matrix.m41;
this.m42 = matrix.m42;
this.m43 = matrix.m43;
this.m44 = matrix.m44;
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.getAsArray = function()
{
return [
this.m11, this.m12, this.m13, this.m14,
this.m21, this.m22, this.m23, this.m24,
this.m31, this.m32, this.m33, this.m34,
this.m41, this.m42, this.m43, this.m44
];
};
CanvasMatrix4.prototype.getAsWebGLFloatArray = function()
{
return new WebGLFloatArray(this.getAsArray());
};
CanvasMatrix4.prototype.makeIdentity = function()
{
this.m11 = 1;
this.m12 = 0;
this.m13 = 0;
this.m14 = 0;
this.m21 = 0;
this.m22 = 1;
this.m23 = 0;
this.m24 = 0;
this.m31 = 0;
this.m32 = 0;
this.m33 = 1;
this.m34 = 0;
this.m41 = 0;
this.m42 = 0;
this.m43 = 0;
this.m44 = 1;
};
CanvasMatrix4.prototype.transpose = function()
{
var tmp = this.m12;
this.m12 = this.m21;
this.m21 = tmp;
tmp = this.m13;
this.m13 = this.m31;
this.m31 = tmp;
tmp = this.m14;
this.m14 = this.m41;
this.m41 = tmp;
tmp = this.m23;
this.m23 = this.m32;
this.m32 = tmp;
tmp = this.m24;
this.m24 = this.m42;
this.m42 = tmp;
tmp = this.m34;
this.m34 = this.m43;
this.m43 = tmp;
};
CanvasMatrix4.prototype.invert = function()
{
// Calculate the 4x4 determinant
// If the determinant is zero,
// then the inverse matrix is not unique.
var det = this._determinant4x4();
if (Math.abs(det) < 1e-8)
return null;
this._makeAdjoint();
// Scale the adjoint matrix to get the inverse
this.m11 /= det;
this.m12 /= det;
this.m13 /= det;
this.m14 /= det;
this.m21 /= det;
this.m22 /= det;
this.m23 /= det;
this.m24 /= det;
this.m31 /= det;
this.m32 /= det;
this.m33 /= det;
this.m34 /= det;
this.m41 /= det;
this.m42 /= det;
this.m43 /= det;
this.m44 /= det;
};
CanvasMatrix4.prototype.translate = function(x,y,z)
{
if (x === undefined)
x = 0;
if (y === undefined)
y = 0;
if (z === undefined)
z = 0;
var matrix = new CanvasMatrix4();
matrix.m41 = x;
matrix.m42 = y;
matrix.m43 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.scale = function(x,y,z)
{
if (x === undefined)
x = 1;
if (z === undefined) {
if (y === undefined) {
y = x;
z = x;
}
else
z = 1;
}
else if (y === undefined)
y = x;
var matrix = new CanvasMatrix4();
matrix.m11 = x;
matrix.m22 = y;
matrix.m33 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.rotate = function(angle,x,y,z)
{
// angles are in degrees. Switch to radians
angle = angle / 180 * Math.PI;
angle /= 2;
var sinA = Math.sin(angle);
var cosA = Math.cos(angle);
var sinA2 = sinA * sinA;
// normalize
var length = Math.sqrt(x * x + y * y + z * z);
if (length === 0) {
// bad vector, just use something reasonable
x = 0;
y = 0;
z = 1;
} else if (length != 1) {
x /= length;
y /= length;
z /= length;
}
var mat = new CanvasMatrix4();
// optimize case where axis is along major axis
if (x == 1 && y === 0 && z === 0) {
mat.m11 = 1;
mat.m12 = 0;
mat.m13 = 0;
mat.m21 = 0;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 2 * sinA * cosA;
mat.m31 = 0;
mat.m32 = -2 * sinA * cosA;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y == 1 && z === 0) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 0;
mat.m13 = -2 * sinA * cosA;
mat.m21 = 0;
mat.m22 = 1;
mat.m23 = 0;
mat.m31 = 2 * sinA * cosA;
mat.m32 = 0;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y === 0 && z == 1) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 2 * sinA * cosA;
mat.m13 = 0;
mat.m21 = -2 * sinA * cosA;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 0;
mat.m31 = 0;
mat.m32 = 0;
mat.m33 = 1;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else {
var x2 = x*x;
var y2 = y*y;
var z2 = z*z;
mat.m11 = 1 - 2 * (y2 + z2) * sinA2;
mat.m12 = 2 * (x * y * sinA2 + z * sinA * cosA);
mat.m13 = 2 * (x * z * sinA2 - y * sinA * cosA);
mat.m21 = 2 * (y * x * sinA2 - z * sinA * cosA);
mat.m22 = 1 - 2 * (z2 + x2) * sinA2;
mat.m23 = 2 * (y * z * sinA2 + x * sinA * cosA);
mat.m31 = 2 * (z * x * sinA2 + y * sinA * cosA);
mat.m32 = 2 * (z * y * sinA2 - x * sinA * cosA);
mat.m33 = 1 - 2 * (x2 + y2) * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
}
this.multRight(mat);
};
CanvasMatrix4.prototype.multRight = function(mat)
{
var m11 = (this.m11 * mat.m11 + this.m12 * mat.m21 +
this.m13 * mat.m31 + this.m14 * mat.m41);
var m12 = (this.m11 * mat.m12 + this.m12 * mat.m22 +
this.m13 * mat.m32 + this.m14 * mat.m42);
var m13 = (this.m11 * mat.m13 + this.m12 * mat.m23 +
this.m13 * mat.m33 + this.m14 * mat.m43);
var m14 = (this.m11 * mat.m14 + this.m12 * mat.m24 +
this.m13 * mat.m34 + this.m14 * mat.m44);
var m21 = (this.m21 * mat.m11 + this.m22 * mat.m21 +
this.m23 * mat.m31 + this.m24 * mat.m41);
var m22 = (this.m21 * mat.m12 + this.m22 * mat.m22 +
this.m23 * mat.m32 + this.m24 * mat.m42);
var m23 = (this.m21 * mat.m13 + this.m22 * mat.m23 +
this.m23 * mat.m33 + this.m24 * mat.m43);
var m24 = (this.m21 * mat.m14 + this.m22 * mat.m24 +
this.m23 * mat.m34 + this.m24 * mat.m44);
var m31 = (this.m31 * mat.m11 + this.m32 * mat.m21 +
this.m33 * mat.m31 + this.m34 * mat.m41);
var m32 = (this.m31 * mat.m12 + this.m32 * mat.m22 +
this.m33 * mat.m32 + this.m34 * mat.m42);
var m33 = (this.m31 * mat.m13 + this.m32 * mat.m23 +
this.m33 * mat.m33 + this.m34 * mat.m43);
var m34 = (this.m31 * mat.m14 + this.m32 * mat.m24 +
this.m33 * mat.m34 + this.m34 * mat.m44);
var m41 = (this.m41 * mat.m11 + this.m42 * mat.m21 +
this.m43 * mat.m31 + this.m44 * mat.m41);
var m42 = (this.m41 * mat.m12 + this.m42 * mat.m22 +
this.m43 * mat.m32 + this.m44 * mat.m42);
var m43 = (this.m41 * mat.m13 + this.m42 * mat.m23 +
this.m43 * mat.m33 + this.m44 * mat.m43);
var m44 = (this.m41 * mat.m14 + this.m42 * mat.m24 +
this.m43 * mat.m34 + this.m44 * mat.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.multLeft = function(mat)
{
var m11 = (mat.m11 * this.m11 + mat.m12 * this.m21 +
mat.m13 * this.m31 + mat.m14 * this.m41);
var m12 = (mat.m11 * this.m12 + mat.m12 * this.m22 +
mat.m13 * this.m32 + mat.m14 * this.m42);
var m13 = (mat.m11 * this.m13 + mat.m12 * this.m23 +
mat.m13 * this.m33 + mat.m14 * this.m43);
var m14 = (mat.m11 * this.m14 + mat.m12 * this.m24 +
mat.m13 * this.m34 + mat.m14 * this.m44);
var m21 = (mat.m21 * this.m11 + mat.m22 * this.m21 +
mat.m23 * this.m31 + mat.m24 * this.m41);
var m22 = (mat.m21 * this.m12 + mat.m22 * this.m22 +
mat.m23 * this.m32 + mat.m24 * this.m42);
var m23 = (mat.m21 * this.m13 + mat.m22 * this.m23 +
mat.m23 * this.m33 + mat.m24 * this.m43);
var m24 = (mat.m21 * this.m14 + mat.m22 * this.m24 +
mat.m23 * this.m34 + mat.m24 * this.m44);
var m31 = (mat.m31 * this.m11 + mat.m32 * this.m21 +
mat.m33 * this.m31 + mat.m34 * this.m41);
var m32 = (mat.m31 * this.m12 + mat.m32 * this.m22 +
mat.m33 * this.m32 + mat.m34 * this.m42);
var m33 = (mat.m31 * this.m13 + mat.m32 * this.m23 +
mat.m33 * this.m33 + mat.m34 * this.m43);
var m34 = (mat.m31 * this.m14 + mat.m32 * this.m24 +
mat.m33 * this.m34 + mat.m34 * this.m44);
var m41 = (mat.m41 * this.m11 + mat.m42 * this.m21 +
mat.m43 * this.m31 + mat.m44 * this.m41);
var m42 = (mat.m41 * this.m12 + mat.m42 * this.m22 +
mat.m43 * this.m32 + mat.m44 * this.m42);
var m43 = (mat.m41 * this.m13 + mat.m42 * this.m23 +
mat.m43 * this.m33 + mat.m44 * this.m43);
var m44 = (mat.m41 * this.m14 + mat.m42 * this.m24 +
mat.m43 * this.m34 + mat.m44 * this.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)
{
var tx = (left + right) / (left - right);
var ty = (top + bottom) / (bottom - top);
var tz = (far + near) / (near - far);
var matrix = new CanvasMatrix4();
matrix.m11 = 2 / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = 0;
matrix.m32 = 0;
matrix.m33 = -2 / (far - near);
matrix.m34 = 0;
matrix.m41 = tx;
matrix.m42 = ty;
matrix.m43 = tz;
matrix.m44 = 1;
this.multRight(matrix);
};
CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)
{
var matrix = new CanvasMatrix4();
var A = (right + left) / (right - left);
var B = (top + bottom) / (top - bottom);
var C = -(far + near) / (far - near);
var D = -(2 * far * near) / (far - near);
matrix.m11 = (2 * near) / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 * near / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = A;
matrix.m32 = B;
matrix.m33 = C;
matrix.m34 = -1;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = D;
matrix.m44 = 0;
this.multRight(matrix);
};
CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)
{
var top = Math.tan(fovy * Math.PI / 360) * zNear;
var bottom = -top;
var left = aspect * bottom;
var right = aspect * top;
this.frustum(left, right, bottom, top, zNear, zFar);
};
CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)
{
var matrix = new CanvasMatrix4();
// Make rotation matrix
// Z vector
var zx = eyex - centerx;
var zy = eyey - centery;
var zz = eyez - centerz;
var mag = Math.sqrt(zx * zx + zy * zy + zz * zz);
if (mag) {
zx /= mag;
zy /= mag;
zz /= mag;
}
// Y vector
var yx = upx;
var yy = upy;
var yz = upz;
// X vector = Y cross Z
xx =  yy * zz - yz * zy;
xy = -yx * zz + yz * zx;
xz =  yx * zy - yy * zx;
// Recompute Y = Z cross X
yx = zy * xz - zz * xy;
yy = -zx * xz + zz * xx;
yx = zx * xy - zy * xx;
// cross product gives area of parallelogram, which is < 1.0 for
// non-perpendicular unit-length vectors; so normalize x, y here
mag = Math.sqrt(xx * xx + xy * xy + xz * xz);
if (mag) {
xx /= mag;
xy /= mag;
xz /= mag;
}
mag = Math.sqrt(yx * yx + yy * yy + yz * yz);
if (mag) {
yx /= mag;
yy /= mag;
yz /= mag;
}
matrix.m11 = xx;
matrix.m12 = xy;
matrix.m13 = xz;
matrix.m14 = 0;
matrix.m21 = yx;
matrix.m22 = yy;
matrix.m23 = yz;
matrix.m24 = 0;
matrix.m31 = zx;
matrix.m32 = zy;
matrix.m33 = zz;
matrix.m34 = 0;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = 0;
matrix.m44 = 1;
matrix.translate(-eyex, -eyey, -eyez);
this.multRight(matrix);
};
// Support functions
CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)
{
return a * d - b * c;
};
CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)
{
return a1 * this._determinant2x2(b2, b3, c2, c3) -
b1 * this._determinant2x2(a2, a3, c2, c3) +
c1 * this._determinant2x2(a2, a3, b2, b3);
};
CanvasMatrix4.prototype._determinant4x4 = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) -
b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) +
c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) -
d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
};
CanvasMatrix4.prototype._makeAdjoint = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
// Row column labeling reversed since we transpose rows & columns
this.m11  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);
this.m21  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);
this.m31  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);
this.m41  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
this.m12  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);
this.m22  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);
this.m32  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);
this.m42  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);
this.m13  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);
this.m23  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);
this.m33  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);
this.m43  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);
this.m14  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);
this.m24  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);
this.m34  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);
this.m44  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);
};</script>
<script>// To generate the help pages for this library, use
// jsdoc --destination ../../../doc/rglwidgetClass --template ~/node_modules/jsdoc-baseline rglClass.src.js
// To validate, use
// setwd(".../inst/htmlwidgets/lib/rglClass")
// hints <- js::jshint(readLines("rglClass.src.js"))
// hints[, c("line", "reason")]
/**
* The class of an rgl widget
* @class
*/
rglwidgetClass = function() {
this.canvas = null;
this.userMatrix = new CanvasMatrix4();
this.types = [];
this.prMatrix = new CanvasMatrix4();
this.mvMatrix = new CanvasMatrix4();
this.vp = null;
this.prmvMatrix = null;
this.origs = null;
this.gl = null;
this.scene = null;
this.select = {state: "inactive", subscene: null, region: {p1: {x:0, y:0}, p2: {x:0, y:0}}};
this.drawing = false;
};
/**
* Multiply matrix by vector
* @returns {number[]}
* @param M {number[][]} Left operand
* @param v {number[]} Right operand
*/
rglwidgetClass.prototype.multMV = function(M, v) {
return [ M.m11 * v[0] + M.m12 * v[1] + M.m13 * v[2] + M.m14 * v[3],
M.m21 * v[0] + M.m22 * v[1] + M.m23 * v[2] + M.m24 * v[3],
M.m31 * v[0] + M.m32 * v[1] + M.m33 * v[2] + M.m34 * v[3],
M.m41 * v[0] + M.m42 * v[1] + M.m43 * v[2] + M.m44 * v[3]
];
};
/**
* Multiply row vector by Matrix
* @returns {number[]}
* @param v {number[]} left operand
* @param M {number[][]} right operand
*/
rglwidgetClass.prototype.multVM = function(v, M) {
return [ M.m11 * v[0] + M.m21 * v[1] + M.m31 * v[2] + M.m41 * v[3],
M.m12 * v[0] + M.m22 * v[1] + M.m32 * v[2] + M.m42 * v[3],
M.m13 * v[0] + M.m23 * v[1] + M.m33 * v[2] + M.m43 * v[3],
M.m14 * v[0] + M.m24 * v[1] + M.m34 * v[2] + M.m44 * v[3]
];
};
/**
* Euclidean length of a vector
* @returns {number}
* @param v {number[]}
*/
rglwidgetClass.prototype.vlen = function(v) {
return Math.sqrt(this.dotprod(v, v));
};
/**
* Dot product of two vectors
* @instance rglwidgetClass
* @returns {number}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.dotprod = function(a, b) {
return a[0]*b[0] + a[1]*b[1] + a[2]*b[2];
};
/**
* Cross product of two vectors
* @returns {number[]}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.xprod = function(a, b) {
return [a[1]*b[2] - a[2]*b[1],
a[2]*b[0] - a[0]*b[2],
a[0]*b[1] - a[1]*b[0]];
};
/**
* Bind vectors or matrices by columns
* @returns {number[][]}
* @param a {number[]|number[][]}
* @param b {number[]|number[][]}
*/
rglwidgetClass.prototype.cbind = function(a, b) {
if (b.length < a.length)
b = this.repeatToLen(b, a.length);
else if (a.length < b.length)
a = this.repeatToLen(a, b.length);
return a.map(function(currentValue, index, array) {
return currentValue.concat(b[index]);
});
};
/**
* Swap elements
* @returns {any[]}
* @param a {any[]}
* @param i {number} Element to swap
* @param j {number} Other element to swap
*/
rglwidgetClass.prototype.swap = function(a, i, j) {
var temp = a[i];
a[i] = a[j];
a[j] = temp;
};
/**
* Flatten a matrix into a vector
* @returns {any[]}
* @param a {any[][]}
*/
rglwidgetClass.prototype.flatten = function(arr, result) {
var value;
if (typeof result === "undefined") result = [];
for (var i = 0, length = arr.length; i < length; i++) {
value = arr[i];
if (Array.isArray(value)) {
this.flatten(value, result);
} else {
result.push(value);
}
}
return result;
};
/**
* set element of 1d or 2d array as if it was flattened.
* Column major, zero based!
* @returns {any[]|any[][]}
* @param {any[]|any[][]} a - array
* @param {number} i - element
* @param {any} value
*/
rglwidgetClass.prototype.setElement = function(a, i, value) {
if (Array.isArray(a[0])) {
var dim = a.length,
col = Math.floor(i/dim),
row = i % dim;
a[row][col] = value;
} else {
a[i] = value;
}
};
/**
* Transpose an array
* @returns {any[][]}
* @param {any[][]} a
*/
rglwidgetClass.prototype.transpose = function(a) {
var newArray = [],
n = a.length,
m = a[0].length,
i;
for(i = 0; i < m; i++){
newArray.push([]);
}
for(i = 0; i < n; i++){
for(var j = 0; j < m; j++){
newArray[j].push(a[i][j]);
}
}
return newArray;
};
/**
* Calculate sum of squares of a numeric vector
* @returns {number}
* @param {number[]} x
*/
rglwidgetClass.prototype.sumsq = function(x) {
var result = 0, i;
for (i=0; i < x.length; i++)
result += x[i]*x[i];
return result;
};
/**
* Convert a matrix to a CanvasMatrix4
* @returns {CanvasMatrix4}
* @param {number[][]|number[]} mat
*/
rglwidgetClass.prototype.toCanvasMatrix4 = function(mat) {
if (mat instanceof CanvasMatrix4)
return mat;
var result = new CanvasMatrix4();
mat = this.flatten(this.transpose(mat));
result.load(mat);
return result;
};
/**
* Convert an R-style numeric colour string to an rgb vector
* @returns {number[]}
* @param {string} s
*/
rglwidgetClass.prototype.stringToRgb = function(s) {
s = s.replace("#", "");
var bigint = parseInt(s, 16);
return [((bigint >> 16) & 255)/255,
((bigint >> 8) & 255)/255,
(bigint & 255)/255];
};
/**
* Take a component-by-component product of two 3 vectors
* @returns {number[]}
* @param {number[]} x
* @param {number[]} y
*/
rglwidgetClass.prototype.componentProduct = function(x, y) {
if (typeof y === "undefined") {
this.alertOnce("Bad arg to componentProduct");
}
var result = new Float32Array(3), i;
for (i = 0; i<3; i++)
result[i] = x[i]*y[i];
return result;
};
/**
* Get next higher power of two
* @returns { number }
* @param { number } value - input value
*/
rglwidgetClass.prototype.getPowerOfTwo = function(value) {
var pow = 1;
while(pow<value) {
pow *= 2;
}
return pow;
};
/**
* Unique entries
* @returns { any[] }
* @param { any[] } arr - An array
*/
rglwidgetClass.prototype.unique = function(arr) {
arr = [].concat(arr);
return arr.filter(function(value, index, self) {
return self.indexOf(value) === index;
});
};
/**
* Shallow compare of arrays
* @returns { boolean }
* @param { any[] } a - An array
* @param { any[] } b - Another array
*/
rglwidgetClass.prototype.equalArrays = function(a, b) {
return a === b || (a && b &&
a.length === b.length &&
a.every(function(v, i) {return v === b[i];}));
};
/**
* Repeat an array to a desired length
* @returns {any[]}
* @param {any | any[]} arr The input array
* @param {number} len The desired output length
*/
rglwidgetClass.prototype.repeatToLen = function(arr, len) {
arr = [].concat(arr);
while (arr.length < len/2)
arr = arr.concat(arr);
return arr.concat(arr.slice(0, len - arr.length));
};
/**
* Give a single alert message, not to be repeated.
* @param {string} msg  The message to give.
*/
rglwidgetClass.prototype.alertOnce = function(msg) {
if (typeof this.alerted !== "undefined")
return;
this.alerted = true;
alert(msg);
};
rglwidgetClass.prototype.f_is_lit = 1;
rglwidgetClass.prototype.f_is_smooth = 2;
rglwidgetClass.prototype.f_has_texture = 4;
rglwidgetClass.prototype.f_depth_sort = 8;
rglwidgetClass.prototype.f_fixed_quads = 16;
rglwidgetClass.prototype.f_is_transparent = 32;
rglwidgetClass.prototype.f_is_lines = 64;
rglwidgetClass.prototype.f_sprites_3d = 128;
rglwidgetClass.prototype.f_sprite_3d = 256;
rglwidgetClass.prototype.f_is_subscene = 512;
rglwidgetClass.prototype.f_is_clipplanes = 1024;
rglwidgetClass.prototype.f_fixed_size = 2048;
rglwidgetClass.prototype.f_is_points = 4096;
rglwidgetClass.prototype.f_is_twosided = 8192;
rglwidgetClass.prototype.f_fat_lines = 16384;
rglwidgetClass.prototype.f_is_brush = 32768;
/**
* Which list does a particular id come from?
* @returns { string }
* @param {number} id The id to look up.
*/
rglwidgetClass.prototype.whichList = function(id) {
var obj = this.getObj(id),
flags = obj.flags;
if (obj.type === "light")
return "lights";
if (flags & this.f_is_subscene)
return "subscenes";
if (flags & this.f_is_clipplanes)
return "clipplanes";
if (flags & this.f_is_transparent)
return "transparent";
return "opaque";
};
/**
* Get an object by id number.
* @returns { Object }
* @param {number} id
*/
rglwidgetClass.prototype.getObj = function(id) {
if (typeof id !== "number") {
this.alertOnce("getObj id is "+typeof id);
}
return this.scene.objects[id];
};
/**
* Get ids of a particular type from a subscene or the whole scene
* @returns { number[] }
* @param {string} type What type of object?
* @param {number} subscene  Which subscene?  If not given, find in the whole scene
*/
rglwidgetClass.prototype.getIdsByType = function(type, subscene) {
var
result = [], i, self = this;
if (typeof subscene === "undefined") {
Object.keys(this.scene.objects).forEach(
function(key) {
key = parseInt(key, 10);
if (self.getObj(key).type === type)
result.push(key);
});
} else {
ids = this.getObj(subscene).objects;
for (i=0; i < ids.length; i++) {
if (this.getObj(ids[i]).type === type) {
result.push(ids[i]);
}
}
}
return result;
};
/**
* Get a particular material property for an id
* @returns { any }
* @param {number} id  Which object?
* @param {string} property Which material property?
*/
rglwidgetClass.prototype.getMaterial = function(id, property) {
var obj = this.getObj(id), mat;
if (typeof obj.material === "undefined")
console.error("material undefined");
mat = obj.material[property];
if (typeof mat === "undefined")
mat = this.scene.material[property];
return mat;
};
/**
* Is a particular id in a subscene?
* @returns { boolean }
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.inSubscene = function(id, subscene) {
return this.getObj(subscene).objects.indexOf(id) > -1;
};
/**
* Add an id to a subscene.
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.addToSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
ids = [id],
obj = this.getObj(id), i;
if (typeof obj != "undefined" && typeof (obj.newIds) !== "undefined") {
ids = ids.concat(obj.newIds);
}
thesub.objects = [].concat(thesub.objects);
for (i = 0; i < ids.length; i++) {
id = ids[i];
if (thesub.objects.indexOf(id) == -1) {
thelist = this.whichList(id);
thesub.objects.push(id);
thesub[thelist].push(id);
}
}
};
/**
* Delete an id from a subscene
* @param { number } id - the id to add
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.delFromSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
obj = this.getObj(id),
ids = [id], i;
if (typeof obj !== "undefined" && typeof (obj.newIds) !== "undefined")
ids = ids.concat(obj.newIds);
thesub.objects = [].concat(thesub.objects); // It might be a scalar
for (j=0; j<ids.length;j++) {
id = ids[j];
i = thesub.objects.indexOf(id);
if (i > -1) {
thesub.objects.splice(i, 1);
thelist = this.whichList(id);
i = thesub[thelist].indexOf(id);
thesub[thelist].splice(i, 1);
}
}
};
/**
* Set the ids in a subscene
* @param { number[] } ids - the ids to set
* @param { number } subsceneid - the id of the subscene
*/
rglwidgetClass.prototype.setSubsceneEntries = function(ids, subsceneid) {
var sub = this.getObj(subsceneid);
sub.objects = ids;
this.initSubscene(subsceneid);
};
/**
* Get the ids in a subscene
* @returns {number[]}
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getSubsceneEntries = function(subscene) {
return this.getObj(subscene).objects;
};
/**
* Get the ids of the subscenes within a subscene
* @returns { number[] }
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getChildSubscenes = function(subscene) {
return this.getObj(subscene).subscenes;
};
/**
* Start drawing
* @returns { boolean } Previous state
*/
rglwidgetClass.prototype.startDrawing = function() {
var value = this.drawing;
this.drawing = true;
return value;
};
/**
* Stop drawing and check for context loss
* @param { boolean } saved - Previous state
*/
rglwidgetClass.prototype.stopDrawing = function(saved) {
this.drawing = saved;
if (!saved && this.gl && this.gl.isContextLost())
this.restartCanvas();
};
/**
* Generate the vertex shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getVertexShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userVertexShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
nclipplanes = this.countClipplanes(),
fixed_size = flags & this.f_fixed_size,
is_points = flags & this.f_is_points,
is_twosided = flags & this.f_is_twosided,
fat_lines = flags & this.f_fat_lines,
is_brush = flags & this.f_is_brush,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
result = "  /* ****** "+type+" object "+id+" vertex shader ****** */\n"+
"  attribute vec3 aPos;\n"+
"  attribute vec4 aCol;\n"+
" uniform mat4 mvMatrix;\n"+
" uniform mat4 prMatrix;\n"+
" varying vec4 vCol;\n"+
" varying vec4 vPosition;\n";
if ((is_lit && !fixed_quads && !is_brush) || sprite_3d)
result = result + "  attribute vec3 aNorm;\n"+
" uniform mat4 normMatrix;\n"+
" varying vec3 vNormal;\n";
if (has_texture || type === "text")
result = result + " attribute vec2 aTexcoord;\n"+
" varying vec2 vTexcoord;\n";
if (fixed_size)
result = result + "  uniform vec2 textScale;\n";
if (fixed_quads)
result = result + "  attribute vec2 aOfs;\n";
else if (sprite_3d)
result = result + "  uniform vec3 uOrig;\n"+
"  uniform float uSize;\n"+
"  uniform mat4 usermat;\n";
if (is_twosided)
result = result + "  attribute vec3 aPos1;\n"+
"  attribute vec3 aPos2;\n"+
"  varying float normz;\n";
if (fat_lines) {
result = result +   "  attribute vec3 aNext;\n"+
"  attribute vec2 aPoint;\n"+
"  varying vec2 vPoint;\n"+
"  varying float vLength;\n"+
"  uniform float uAspect;\n"+
"  uniform float uLwd;\n";
}
result = result + "  void main(void) {\n";
if ((nclipplanes || (!fixed_quads && !sprite_3d)) && !is_brush)
result = result + "    vPosition = mvMatrix * vec4(aPos, 1.);\n";
if (!fixed_quads && !sprite_3d && !is_brush)
result = result + "    gl_Position = prMatrix * vPosition;\n";
if (is_points) {
var size = this.getMaterial(id, "size");
result = result + "    gl_PointSize = "+size.toFixed(1)+";\n";
}
result = result + "    vCol = aCol;\n";
if (is_lit && !fixed_quads && !sprite_3d && !is_brush)
result = result + "    vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n";
if (has_texture || type == "text")
result = result + "    vTexcoord = aTexcoord;\n";
if (fixed_size)
result = result + "    vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w;\n"+
"   gl_Position = pos + vec4(aOfs*textScale, 0.,0.);\n";
if (type == "sprites" && !fixed_size)
result = result + "    vec4 pos = mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w + vec4(aOfs, 0., 0.);\n"+
"   gl_Position = prMatrix*pos;\n";
if (sprite_3d)
result = result + "   vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n"+
"   vec4 pos = mvMatrix * vec4(uOrig, 1.);\n"+
"   vPosition = pos/pos.w + vec4(uSize*(vec4(aPos, 1.)*usermat).xyz,0.);\n"+
"   gl_Position = prMatrix * vPosition;\n";
if (is_twosided)
result = result + "   vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n"+
"   pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n"+
"   vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n"+
"   pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n"+
"   normz = pos1.x*pos2.y - pos1.y*pos2.x;\n";
if (fat_lines) 
/* This code was inspired by Matt Deslauriers' code in https://mattdesl.svbtle.com/drawing-lines-is-hard */
result = result + "   vec2 aspectVec = vec2(uAspect, 1.0);\n"+
"   mat4 projViewModel = prMatrix * mvMatrix;\n"+
"   vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n"+
"   currentProjected = currentProjected/currentProjected.w;\n"+
"   vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n"+
"   vec2 currentScreen = currentProjected.xy * aspectVec;\n"+
"   vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n"+
"   float len = uLwd;\n"+
"   vec2 dir = vec2(1.0, 0.0);\n"+
"   vPoint = aPoint;\n"+
"   vLength = length(nextScreen - currentScreen)/2.0;\n"+
"   vLength = vLength/(vLength + len);\n"+
"   if (vLength > 0.0) {\n"+
"     dir = normalize(nextScreen - currentScreen);\n"+
"   }\n"+
"   vec2 normal = vec2(-dir.y, dir.x);\n"+
"   dir.x /= uAspect;\n"+
"   normal.x /= uAspect;\n"+
"   vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n"+
"   gl_Position = currentProjected + offset;\n";
if (is_brush)
result = result + "   gl_Position = vec4(aPos, 1.);\n";
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Generate the fragment shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getFragmentShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userFragmentShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
is_twosided = (flags & this.f_is_twosided) > 0,
fat_lines = flags & this.f_fat_lines,
is_transparent = flags & this.f_is_transparent,
nclipplanes = this.countClipplanes(), i,
texture_format, nlights,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
if (has_texture)
texture_format = this.getMaterial(id, "textype");
result = "/* ****** "+type+" object "+id+" fragment shader ****** */\n"+
"#ifdef GL_ES\n"+
"#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+
"  precision highp float;\n"+
"#else\n"+
"  precision mediump float;\n"+
"#endif\n"+
"#endif\n"+
"  varying vec4 vCol; // carries alpha\n"+
"  varying vec4 vPosition;\n";
if (has_texture || type === "text")
result = result + "  varying vec2 vTexcoord;\n"+
" uniform sampler2D uSampler;\n";
if (is_lit && !fixed_quads)
result = result + "  varying vec3 vNormal;\n";
for (i = 0; i < nclipplanes; i++)
result = result + "  uniform vec4 vClipplane"+i+";\n";
if (is_lit) {
nlights = this.countLights();
if (nlights)
result = result + "  uniform mat4 mvMatrix;\n";
else
is_lit = false;
}
if (is_lit) {
result = result + "   uniform vec3 emission;\n"+
"   uniform float shininess;\n";
for (i=0; i < nlights; i++) {
result = result + "   uniform vec3 ambient" + i + ";\n"+
"   uniform vec3 specular" + i +"; // light*material\n"+
"   uniform vec3 diffuse" + i + ";\n"+
"   uniform vec3 lightDir" + i + ";\n"+
"   uniform bool viewpoint" + i + ";\n"+
"   uniform bool finite" + i + ";\n";
}
}
if (is_twosided)
result = result + "   uniform bool front;\n"+
"   varying float normz;\n";
if (fat_lines)
result = result + "   varying vec2 vPoint;\n"+
"   varying float vLength;\n";
result = result + "  void main(void) {\n";
if (fat_lines) {
result = result + "    vec2 point = vPoint;\n"+
"    bool neg = point.y < 0.0;\n"+
"    point.y = neg ? "+
"      (point.y + vLength)/(1.0 - vLength) :\n"+
"     -(point.y - vLength)/(1.0 - vLength);\n";
if (is_transparent && type == "linestrip")
result = result+"    if (neg && length(point) <= 1.0) discard;\n";
result = result + "    point.y = min(point.y, 0.0);\n"+
"    if (length(point) > 1.0) discard;\n";
}
for (i=0; i < nclipplanes;i++)
result = result + "    if (dot(vPosition, vClipplane"+i+") < 0.0) discard;\n";
if (fixed_quads) {
result = result +   "    vec3 n = vec3(0., 0., 1.);\n";
} else if (is_lit) {
result = result +   "    vec3 n = normalize(vNormal);\n";
}
if (is_twosided) {
result = result +   "    if ((normz <= 0.) != front) discard;\n";
}
if (is_lit) {
result = result + "    vec3 eye = normalize(-vPosition.xyz);\n"+
"   vec3 lightdir;\n"+
"   vec4 colDiff;\n"+
"   vec3 halfVec;\n"+
"   vec4 lighteffect = vec4(emission, 0.);\n"+
"   vec3 col;\n"+
"   float nDotL;\n";
if (!fixed_quads) {
result = result +   "   n = -faceforward(n, n, eye);\n";
}
for (i=0; i < nlights; i++) {
result = result + "   colDiff = vec4(vCol.rgb * diffuse" + i + ", vCol.a);\n"+
"   lightdir = lightDir" + i + ";\n"+
"   if (!viewpoint" + i +")\n"+
"     lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n"+
"   if (!finite" + i + ") {\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   } else {\n"+
"     lightdir = normalize(lightdir - vPosition.xyz);\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   }\n"+
"    col = ambient" + i + ";\n"+
"   nDotL = dot(n, lightdir);\n"+
"   col = col + max(nDotL, 0.) * colDiff.rgb;\n"+
"   col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular" + i + ";\n"+
"   lighteffect = lighteffect + vec4(col, colDiff.a);\n";
}
} else {
result = result +   "   vec4 colDiff = vCol;\n"+
"    vec4 lighteffect = colDiff;\n";
}
if (type === "text")
result = result +   "    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n";
if (has_texture) {
result = result + {
rgb:            "   vec4 textureColor = lighteffect*vec4(texture2D(uSampler, vTexcoord).rgb, 1.);\n",
rgba:           "   vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n",
alpha:          "   vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.), textureColor.rgb)/3.;\n"+
"   textureColor =  vec4(lighteffect.rgb, lighteffect.a*luminance);\n",
luminance:      "   vec4 textureColor = vec4(lighteffect.rgb*dot(texture2D(uSampler, vTexcoord).rgb, vec3(1.,1.,1.))/3., lighteffect.a);\n",
"luminance.alpha":"    vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n"+
"   textureColor = vec4(lighteffect.rgb*luminance, lighteffect.a*textureColor.a);\n"
}[texture_format]+
"   gl_FragColor = textureColor;\n";
} else if (type === "text") {
result = result +   "    if (textureColor.a < 0.1)\n"+
"     discard;\n"+
"   else\n"+
"     gl_FragColor = textureColor;\n";
} else
result = result +   "   gl_FragColor = lighteffect;\n";
//if (fat_lines)
//  result = result +   "   gl_FragColor = vec4(0.0, abs(point.x), abs(point.y), 1.0);"
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Call gl functions to create and compile shader
* @returns {Object}
* @param { number } shaderType - gl code for shader type
* @param { string } code - code for the shader
*/
rglwidgetClass.prototype.getShader = function(shaderType, code) {
var gl = this.gl, shader;
shader = gl.createShader(shaderType);
gl.shaderSource(shader, code);
gl.compileShader(shader);
if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS) && !gl.isContextLost())
alert(gl.getShaderInfoLog(shader));
return shader;
};
/**
* Handle a texture after its image has been loaded
* @param { Object } texture - the gl texture object
* @param { Object } textureCanvas - the canvas holding the image
*/
rglwidgetClass.prototype.handleLoadedTexture = function(texture, textureCanvas) {
var gl = this.gl || this.initGL();
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
gl.generateMipmap(gl.TEXTURE_2D);
gl.bindTexture(gl.TEXTURE_2D, null);
};
/**
* Get maximum dimension of texture in current browser.
* @returns {number}
*/
rglwidgetClass.prototype.getMaxTexSize = function() {
var gl = this.gl || this.initGL();	
return Math.min(4096, gl.getParameter(gl.MAX_TEXTURE_SIZE));
};
/**
* Load an image to a texture
* @param { string } uri - The image location
* @param { Object } texture - the gl texture object
*/
rglwidgetClass.prototype.loadImageToTexture = function(uri, texture) {
var canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
image = new Image(),
self = this;
image.onload = function() {
var w = image.width,
h = image.height,
canvasX = self.getPowerOfTwo(w),
canvasY = self.getPowerOfTwo(h),
gl = self.gl || self.initGL(),
maxTexSize = self.getMaxTexSize();
while (canvasX > 1 && canvasY > 1 && (canvasX > maxTexSize || canvasY > maxTexSize)) {
canvasX /= 2;
canvasY /= 2;
}
canvas.width = canvasX;
canvas.height = canvasY;
ctx.imageSmoothingEnabled = true;
ctx.drawImage(image, 0, 0, canvasX, canvasY);
self.handleLoadedTexture(texture, canvas);
self.drawScene();
};
image.src = uri;
};
/**
* Draw text to the texture canvas
* @returns { Object } object with text measurements
* @param { string } text - the text
* @param { number } cex - expansion
* @param { string } family - font family
* @param { number } font - font number
*/
rglwidgetClass.prototype.drawTextToCanvas = function(text, cex, family, font) {
var canvasX, canvasY,
textY,
scaling = 20,
textColour = "white",
backgroundColour = "rgba(0,0,0,0)",
canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
i, textHeight = 0, textHeights = [], width, widths = [], 
offsetx, offsety = 0, line, lines = [], offsetsx = [],
offsetsy = [], lineoffsetsy = [], fontStrings = [],
maxTexSize = this.getMaxTexSize(),
getFontString = function(i) {
textHeights[i] = scaling*cex[i];
var fontString = textHeights[i] + "px",
family0 = family[i],
font0 = font[i];
if (family0 === "sans")
family0 = "sans-serif";
else if (family0 === "mono")
family0 = "monospace";
fontString = fontString + " " + family0;
if (font0 === 2 || font0 === 4)
fontString = "bold " + fontString;
if (font0 === 3 || font0 === 4)
fontString = "italic " + fontString;
return fontString;
};
cex = this.repeatToLen(cex, text.length);
family = this.repeatToLen(family, text.length);
font = this.repeatToLen(font, text.length);
canvasX = 1;
line = -1;
offsetx = maxTexSize;
for (i = 0; i < text.length; i++)  {
ctx.font = fontStrings[i] = getFontString(i);
width = widths[i] = ctx.measureText(text[i]).width;
if (offsetx + width > maxTexSize) {
line += 1;
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
if (offsety > maxTexSize)
console.error("Too many strings for texture.");
textHeight = 0;
offsetx = 0;
}
textHeight = Math.max(textHeight, textHeights[i]);
offsetsx[i] = offsetx;
offsetx += width;
canvasX = Math.max(canvasX, offsetx);
lines[i] = line;
}
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
for (i = 0; i < text.length; i++) {
offsetsy[i] = lineoffsetsy[lines[i]];
}
canvasX = this.getPowerOfTwo(canvasX);
canvasY = this.getPowerOfTwo(offsety);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.fillStyle = backgroundColour;
ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
ctx.textBaseline = "alphabetic";
for(i = 0; i < text.length; i++) {
ctx.font = fontStrings[i];
ctx.fillStyle = textColour;
ctx.textAlign = "left";
ctx.fillText(text[i], offsetsx[i],  offsetsy[i]);
}
return {canvasX:canvasX, canvasY:canvasY,
widths:widths, textHeights:textHeights,
offsetsx:offsetsx, offsetsy:offsetsy};
};
/**
* Set the gl viewport and scissor test
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setViewport = function(id) {
var gl = this.gl || this.initGL(),
vp = this.getObj(id).par3d.viewport,
x = vp.x*this.canvas.width,
y = vp.y*this.canvas.height,
width = vp.width*this.canvas.width,
height = vp.height*this.canvas.height;
this.vp = {x:x, y:y, width:width, height:height};
gl.viewport(x, y, width, height);
gl.scissor(x, y, width, height);
gl.enable(gl.SCISSOR_TEST);
};
/**
* Set the projection matrix for a subscene
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setprMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.projection;
if (embedding === "replace")
this.prMatrix.makeIdentity();
else
this.setprMatrix(subscene.parent);
if (embedding === "inherit")
return;
// This is based on the Frustum::enclose code from geom.cpp
var bbox = subscene.par3d.bbox,
scale = subscene.par3d.scale,
ranges = [(bbox[1]-bbox[0])*scale[0]/2,
(bbox[3]-bbox[2])*scale[1]/2,
(bbox[5]-bbox[4])*scale[2]/2],
radius = Math.sqrt(this.sumsq(ranges))*1.1; // A bit bigger to handle labels
if (radius <= 0) radius = 1;
var observer = subscene.par3d.observer,
distance = observer[2],
FOV = subscene.par3d.FOV, ortho = FOV === 0,
t = ortho ? 1 : Math.tan(FOV*Math.PI/360),
near = distance - radius,
far = distance + radius,
hlen,
aspect = this.vp.width/this.vp.height,
z = subscene.par3d.zoom,
userProjection = subscene.par3d.userProjection;
if (far < 0.0)
far = 1.0;
if (near < far/100.0)
near = far/100.0;
hlen = t*near;
if (ortho) {
if (aspect > 1)
this.prMatrix.ortho(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.ortho(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
} else {
if (aspect > 1)
this.prMatrix.frustum(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.frustum(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
}
this.prMatrix.multRight(userProjection);
};
/**
* Set the model-view matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmvMatrix = function(id) {
var observer = this.getObj(id).par3d.observer;
this.mvMatrix.makeIdentity();
this.setmodelMatrix(id);
this.mvMatrix.translate(-observer[0], -observer[1], -observer[2]);
};
/**
* Set the model matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmodelMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.model;
if (embedding !== "inherit") {
var scale = subscene.par3d.scale,
bbox = subscene.par3d.bbox,
center = [(bbox[0]+bbox[1])/2,
(bbox[2]+bbox[3])/2,
(bbox[4]+bbox[5])/2];
this.mvMatrix.translate(-center[0], -center[1], -center[2]);
this.mvMatrix.scale(scale[0], scale[1], scale[2]);
this.mvMatrix.multRight( subscene.par3d.userMatrix );
}
if (embedding !== "replace")
this.setmodelMatrix(subscene.parent);
};
/**
* Set the normals matrix for a subscene
* @param { number } subsceneid - id of the subscene
*/
rglwidgetClass.prototype.setnormMatrix = function(subsceneid) {
var self = this,
recurse = function(id) {
var sub = self.getObj(id),
embedding = sub.embeddings.model;
if (embedding !== "inherit") {
var scale = sub.par3d.scale;
self.normMatrix.scale(1/scale[0], 1/scale[1], 1/scale[2]);
self.normMatrix.multRight(sub.par3d.userMatrix);
}
if (embedding !== "replace")
recurse(sub.parent);
};
self.normMatrix.makeIdentity();
recurse(subsceneid);
};
/**
* Set the combined projection-model-view matrix
*/
rglwidgetClass.prototype.setprmvMatrix = function() {
this.prmvMatrix = new CanvasMatrix4( this.mvMatrix );
this.prmvMatrix.multRight( this.prMatrix );
};
/**
* Count clipping planes in a scene
* @returns {number}
*/
rglwidgetClass.prototype.countClipplanes = function() {
return this.countObjs("clipplanes");
};
/**
* Count lights in a scene
* @returns { number }
*/
rglwidgetClass.prototype.countLights = function() {
return this.countObjs("light");
};
/**
* Count objects of specific type in a scene
* @returns { number }
* @param { string } type - Type of object to count
*/
rglwidgetClass.prototype.countObjs = function(type) {
var self = this,
bound = 0;
Object.keys(this.scene.objects).forEach(
function(key) {
if (self.getObj(parseInt(key, 10)).type === type)
bound = bound + 1;
});
return bound;
};
/**
* Initialize a subscene
* @param { number } id - id of subscene.
*/
rglwidgetClass.prototype.initSubscene = function(id) {
var sub = this.getObj(id),
i, obj;
if (sub.type !== "subscene")
return;
sub.par3d.userMatrix = this.toCanvasMatrix4(sub.par3d.userMatrix);
sub.par3d.userProjection = this.toCanvasMatrix4(sub.par3d.userProjection);
sub.par3d.userProjection.transpose();
sub.par3d.listeners = [].concat(sub.par3d.listeners);
sub.backgroundId = undefined;
sub.subscenes = [];
sub.clipplanes = [];
sub.transparent = [];
sub.opaque = [];
sub.lights = [];
for (i=0; i < sub.objects.length; i++) {
obj = this.getObj(sub.objects[i]);
if (typeof obj === "undefined") {
sub.objects.splice(i, 1);
i--;
} else if (obj.type === "background")
sub.backgroundId = obj.id;
else
sub[this.whichList(obj.id)].push(obj.id);
}
};
/**
* Copy object
* @param { number } id - id of object to copy
* @param { string } reuse - Document id of scene to reuse
*/
rglwidgetClass.prototype.copyObj = function(id, reuse) {
var obj = this.getObj(id),
prev = document.getElementById(reuse);
if (prev !== null) {
prev = prev.rglinstance;
var
prevobj = prev.getObj(id),
fields = ["flags", "type",
"colors", "vertices", "centers",
"normals", "offsets",
"texts", "cex", "family", "font", "adj",
"material",
"radii",
"texcoords",
"userMatrix", "ids",
"dim",
"par3d", "userMatrix",
"viewpoint", "finite",
"pos"],
i;
for (i = 0; i < fields.length; i++) {
if (typeof prevobj[fields[i]] !== "undefined")
obj[fields[i]] = prevobj[fields[i]];
}
} else
console.warn("copyObj failed");
};
/**
* Update the triangles used to display a plane
* @param { number } id - id of the plane
* @param { Object } bbox - bounding box in which to display the plane
*/
rglwidgetClass.prototype.planeUpdateTriangles = function(id, bbox) {
var perms = [[0,0,1], [1,2,2], [2,1,0]],
x, xrow, elem, A, d, nhits, i, j, k, u, v, w, intersect, which, v0, v2, vx, reverse,
face1 = [], face2 = [], normals = [],
obj = this.getObj(id),
nPlanes = obj.normals.length;
obj.bbox = bbox;
obj.vertices = [];
obj.initialized = false;
for (elem = 0; elem < nPlanes; elem++) {
//    Vertex Av = normal.getRecycled(elem);
x = [];
A = obj.normals[elem];
d = obj.offsets[elem][0];
nhits = 0;
for (i=0; i<3; i++)
for (j=0; j<2; j++)
for (k=0; k<2; k++) {
u = perms[0][i];
v = perms[1][i];
w = perms[2][i];
if (A[w] !== 0.0) {
intersect = -(d + A[u]*bbox[j+2*u] + A[v]*bbox[k+2*v])/A[w];
if (bbox[2*w] < intersect && intersect < bbox[1+2*w]) {
xrow = [];
xrow[u] = bbox[j+2*u];
xrow[v] = bbox[k+2*v];
xrow[w] = intersect;
x.push(xrow);
face1[nhits] = j + 2*u;
face2[nhits] = k + 2*v;
nhits++;
}
}
}
if (nhits > 3) {
/* Re-order the intersections so the triangles work */
for (i=0; i<nhits-2; i++) {
which = 0; /* initialize to suppress warning */
for (j=i+1; j<nhits; j++) {
if (face1[i] == face1[j] || face1[i] == face2[j] ||
face2[i] == face1[j] || face2[i] == face2[j] ) {
which = j;
break;
}
}
if (which > i+1) {
this.swap(x, i+1, which);
this.swap(face1, i+1, which);
this.swap(face2, i+1, which);
}
}
}
if (nhits >= 3) {
/* Put in order so that the normal points out the FRONT of the faces */
v0 = [x[0][0] - x[1][0] , x[0][1] - x[1][1], x[0][2] - x[1][2]];
v2 = [x[2][0] - x[1][0] , x[2][1] - x[1][1], x[2][2] - x[1][2]];
/* cross-product */
vx = this.xprod(v0, v2);
reverse = this.dotprod(vx, A) > 0;
for (i=0; i<nhits-2; i++) {
obj.vertices.push(x[0]);
normals.push(A);
for (j=1; j<3; j++) {
obj.vertices.push(x[i + (reverse ? 3-j : j)]);
normals.push(A);
}
}
}
}
obj.pnormals = normals;
};
rglwidgetClass.prototype.getAdj = function (pos, offset, text) {
switch(pos) {
case 1: return [0.5, 1 + offset];
case 2: return [1 + offset/text.length, 0.5];
case 3: return [0.5, -offset];
case 4: return [-offset/text.length, 0.5];
}
}
/**
* Initialize object for display
* @param { number } id - id of object to initialize
*/
rglwidgetClass.prototype.initObj = function(id) {
var obj = this.getObj(id),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = obj.is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
is_brush = flags & this.f_is_brush,
gl = this.gl || this.initGL(),
polygon_offset,
texinfo, drawtype, nclipplanes, f, nrows, oldrows,
i,j,v,v1,v2, mat, uri, matobj, pass, passes, pmode,
dim, nx, nz, attr;
if (typeof id !== "number") {
this.alertOnce("initObj id is "+typeof id);
}
obj.initialized = true;
if (type === "bboxdeco" || type === "subscene")
return;
if (type === "light") {
obj.ambient = new Float32Array(obj.colors[0].slice(0,3));
obj.diffuse = new Float32Array(obj.colors[1].slice(0,3));
obj.specular = new Float32Array(obj.colors[2].slice(0,3));
obj.lightDir = new Float32Array(obj.vertices[0]);
return;
}
if (type === "clipplanes") {
obj.vClipplane = this.flatten(this.cbind(obj.normals, obj.offsets));
return;
}
if (type === "background" && typeof obj.ids !== "undefined") {
obj.quad = this.flatten([].concat(obj.ids));
return;
}
polygon_offset = this.getMaterial(id, "polygon_offset");
if (polygon_offset[0] != 0 || polygon_offset[1] != 0)
obj.polygon_offset = polygon_offset;
if (is_transparent) {
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}
if (is_brush)
this.initSelection(id);
if (typeof obj.vertices === "undefined")
obj.vertices = [];
v = obj.vertices;
obj.vertexCount = v.length;
if (!obj.vertexCount) return;
if (is_twosided) {
if (typeof obj.userAttributes === "undefined")
obj.userAttributes = {};
v1 = Array(v.length);
v2 = Array(v.length);
if (obj.type == "triangles" || obj.type == "quads") {
if (obj.type == "triangles")
nrow = 3;
else
nrow = 4;
for (i=0; i<Math.floor(v.length/nrow); i++)
for (j=0; j<nrow; j++) {
v1[nrow*i + j] = v[nrow*i + ((j+1) % nrow)];
v2[nrow*i + j] = v[nrow*i + ((j+2) % nrow)];
}
} else if (obj.type == "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz && j+1 < nx) {
v2[j + nx*i] = v[j + nx*(i+1)];
v1[j + nx*i] = v[j+1 + nx*(i+1)];
} else if (i+1 < nz) {
v2[j + nx*i] = v[j-1 + nx*i];
v1[j + nx*i] = v[j + nx*(i+1)];
} else {
v2[j + nx*i] = v[j + nx*(i-1)];
v1[j + nx*i] = v[j-1 + nx*(i-1)];
}
}
}
}
obj.userAttributes.aPos1 = v1;
obj.userAttributes.aPos2 = v2;
}
if (!sprites_3d) {
if (gl.isContextLost()) return;
obj.prog = gl.createProgram();
gl.attachShader(obj.prog, this.getShader( gl.VERTEX_SHADER,
this.getVertexShader(id) ));
gl.attachShader(obj.prog, this.getShader( gl.FRAGMENT_SHADER,
this.getFragmentShader(id) ));
//  Force aPos to location 0, aCol to location 1
gl.bindAttribLocation(obj.prog, 0, "aPos");
gl.bindAttribLocation(obj.prog, 1, "aCol");
gl.linkProgram(obj.prog);
var linked = gl.getProgramParameter(obj.prog, gl.LINK_STATUS);
if (!linked) {
// An error occurred while linking
var lastError = gl.getProgramInfoLog(obj.prog);
console.warn("Error in program linking:" + lastError);
gl.deleteProgram(obj.prog);
return;
}
}
if (type === "text") {
texinfo = this.drawTextToCanvas(obj.texts,
this.flatten(obj.cex),
this.flatten(obj.family),
this.flatten(obj.family));
}
if (fixed_quads && !sprites_3d) {
obj.ofsLoc = gl.getAttribLocation(obj.prog, "aOfs");
}
if (sprite_3d) {
obj.origLoc = gl.getUniformLocation(obj.prog, "uOrig");
obj.sizeLoc = gl.getUniformLocation(obj.prog, "uSize");
obj.usermatLoc = gl.getUniformLocation(obj.prog, "usermat");
}
if (has_texture || type == "text") {
if (!obj.texture)
obj.texture = gl.createTexture();
obj.texLoc = gl.getAttribLocation(obj.prog, "aTexcoord");
obj.sampler = gl.getUniformLocation(obj.prog, "uSampler");
}
if (has_texture) {
mat = obj.material;
if (typeof mat.uri !== "undefined")
uri = mat.uri;
else if (typeof mat.uriElementId === "undefined") {
matobj = this.getObj(mat.uriId);
if (typeof matobj !== "undefined") {
uri = matobj.material.uri;
} else {
uri = "";
}
} else
uri = document.getElementById(mat.uriElementId).rglinstance.getObj(mat.uriId).material.uri;
this.loadImageToTexture(uri, obj.texture);
}
if (type === "text") {
this.handleLoadedTexture(obj.texture, this.textureCanvas);
}
var stride = 3, nc, cofs, nofs, radofs, oofs, tofs, vnew, fnew,
nextofs = -1, pointofs = -1, alias, colors, key, selection, filter, adj, pos, offset;
obj.alias = undefined;
colors = obj.colors;
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
key = this.scene.crosstalk.key[j];
options = this.scene.crosstalk.options[j];
colors = colors.slice(0); 
for (i = 0; i < v.length; i++)
colors[i] = obj.colors[i % obj.colors.length].slice(0);
if ( (selection = this.scene.crosstalk.selection) &&
(selection.length || !options.selectedIgnoreNone) )
for (i = 0; i < v.length; i++) {
if (!selection.includes(key[i])) {
if (options.deselectedColor)
colors[i] = options.deselectedColor.slice(0);
colors[i][3] = colors[i][3]*options.deselectedFade;   /* default: mostly transparent if not selected */
} else if (options.selectedColor)
colors[i] = options.selectedColor.slice(0);
}
if ( (filter = this.scene.crosstalk.filter) )
for (i = 0; i < v.length; i++) 
if (!filter.includes(key[i])) {
if (options.filteredColor)
colors[i] = options.filteredColor.slice(0);
colors[i][3] = colors[i][3]*options.filteredFade;   /* default: completely hidden if filtered */
}
}  
nc = obj.colorCount = colors.length;
if (nc > 1) {
cofs = stride;
stride = stride + 4;
v = this.cbind(v, colors);
} else {
cofs = -1;
obj.onecolor = this.flatten(colors);
}
if (typeof obj.normals !== "undefined") {
nofs = stride;
stride = stride + 3;
v = this.cbind(v, typeof obj.pnormals !== "undefined" ? obj.pnormals : obj.normals);
} else
nofs = -1;
if (typeof obj.radii !== "undefined") {
radofs = stride;
stride = stride + 1;
// FIXME:  always concat the radii?
if (obj.radii.length === v.length) {
v = this.cbind(v, obj.radii);
} else if (obj.radii.length === 1) {
v = v.map(function(row, i, arr) { return row.concat(obj.radii[0]);});
}
} else
radofs = -1;
// Add default indices
f = Array(v.length);
for (i = 0; i < v.length; i++)
f[i] = i;
obj.f = [f,f];
if (type == "sprites" && !sprites_3d) {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
fnew = new Array(4*v.length);
alias = new Array(v.length);
var rescale = fixed_size ? 72 : 1,
size = obj.radii, s = rescale*size[0]/2;
last = v.length;
f = obj.f[0];
for (i=0; i < v.length; i++) {
if (size.length > 1)
s = rescale*size[i]/2;
vnew[i]  = v[i].concat([0,0,-s,-s]);
fnew[4*i] = f[i];
vnew[last]= v[i].concat([1,0, s,-s]);
fnew[4*i+1] = last++;
vnew[last]= v[i].concat([1,1, s, s]);
fnew[4*i+2] = last++;
vnew[last]= v[i].concat([0,1,-s, s]);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (type === "text") {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
f = obj.f[0];
fnew = new Array(4*f.length);
alias = new Array(v.length);
last = v.length;
adj = this.flatten(obj.adj);
if (typeof obj.pos !== "undefined") {
pos = this.flatten(obj.pos);
offset = adj[0];
}
for (i=0; i < v.length; i++) {
if (typeof pos !== "undefined")
adj = this.getAdj(pos[i % pos.length], offset, obj.texts[i]);
vnew[i]  = v[i].concat([0,-0.5]).concat(adj);
fnew[4*i] = f[i];
vnew[last] = v[i].concat([1,-0.5]).concat(adj);
fnew[4*i+1] = last++;
vnew[last] = v[i].concat([1, 1.5]).concat(adj);
fnew[4*i+2] = last++;
vnew[last] = v[i].concat([0, 1.5]).concat(adj);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
for (j=0; j < 4; j++) {
v1 = vnew[fnew[4*i+j]];
v1[tofs+2] = 2*(v1[tofs]-v1[tofs+2])*texinfo.widths[i];
v1[tofs+3] = 2*(v1[tofs+1]-v1[tofs+3])*texinfo.textHeights[i];
v1[tofs] = (texinfo.offsetsx[i] + v1[tofs]*texinfo.widths[i])/texinfo.canvasX;
v1[tofs+1] = 1.0-(texinfo.offsetsy[i] -
v1[tofs+1]*texinfo.textHeights[i])/texinfo.canvasY;
vnew[fnew[4*i+j]] = v1;
}
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (typeof obj.texcoords !== "undefined") {
tofs = stride;
stride += 2;
oofs = -1;
v = this.cbind(v, obj.texcoords);
} else {
tofs = -1;
oofs = -1;
}
obj.alias = alias;
if (typeof obj.userAttributes !== "undefined") {
obj.userAttribOffsets = {};
obj.userAttribLocations = {};
obj.userAttribSizes = {};
for (attr in obj.userAttributes) {
obj.userAttribLocations[attr] = gl.getAttribLocation(obj.prog, attr);
if (obj.userAttribLocations[attr] >= 0) { // Attribute may not have been used
obj.userAttribOffsets[attr] = stride;
v = this.cbind(v, obj.userAttributes[attr]);
stride = v[0].length;
obj.userAttribSizes[attr] = stride - obj.userAttribOffsets[attr];
}
}
}
if (typeof obj.userUniforms !== "undefined") {
obj.userUniformLocations = {};
for (attr in obj.userUniforms)
obj.userUniformLocations[attr] = gl.getUniformLocation(obj.prog, attr);
}
if (sprites_3d) {
obj.userMatrix = new CanvasMatrix4(obj.userMatrix);
obj.objects = this.flatten([].concat(obj.ids));
is_lit = false;
for (i=0; i < obj.objects.length; i++)
this.initObj(obj.objects[i]);
}
if (is_lit && !fixed_quads) {
obj.normLoc = gl.getAttribLocation(obj.prog, "aNorm");
}
nclipplanes = this.countClipplanes();
if (nclipplanes && !sprites_3d) {
obj.clipLoc = [];
for (i=0; i < nclipplanes; i++)
obj.clipLoc[i] = gl.getUniformLocation(obj.prog,"vClipplane" + i);
}
if (is_lit) {
obj.emissionLoc = gl.getUniformLocation(obj.prog, "emission");
obj.emission = new Float32Array(this.stringToRgb(this.getMaterial(id, "emission")));
obj.shininessLoc = gl.getUniformLocation(obj.prog, "shininess");
obj.shininess = this.getMaterial(id, "shininess");
obj.nlights = this.countLights();
obj.ambientLoc = [];
obj.ambient = new Float32Array(this.stringToRgb(this.getMaterial(id, "ambient")));
obj.specularLoc = [];
obj.specular = new Float32Array(this.stringToRgb(this.getMaterial(id, "specular")));
obj.diffuseLoc = [];
obj.lightDirLoc = [];
obj.viewpointLoc = [];
obj.finiteLoc = [];
for (i=0; i < obj.nlights; i++) {
obj.ambientLoc[i] = gl.getUniformLocation(obj.prog, "ambient" + i);
obj.specularLoc[i] = gl.getUniformLocation(obj.prog, "specular" + i);
obj.diffuseLoc[i] = gl.getUniformLocation(obj.prog, "diffuse" + i);
obj.lightDirLoc[i] = gl.getUniformLocation(obj.prog, "lightDir" + i);
obj.viewpointLoc[i] = gl.getUniformLocation(obj.prog, "viewpoint" + i);
obj.finiteLoc[i] = gl.getUniformLocation(obj.prog, "finite" + i);
}
}
obj.passes = is_twosided + 1;
obj.pmode = new Array(obj.passes);
for (pass = 0; pass < obj.passes; pass++) {
if (type === "triangles" || type === "quads" || type === "surface")
pmode = this.getMaterial(id, (pass === 0) ? "front" : "back");
else pmode = "filled";
obj.pmode[pass] = pmode;
}
obj.f.length = obj.passes;
for (pass = 0; pass < obj.passes; pass++) {
f = fnew = obj.f[pass];
pmode = obj.pmode[pass];
if (pmode === "culled")
f = [];
else if (pmode === "points") {
// stay with default
} else if ((type === "quads" || type === "text" ||
type === "sprites") && !sprites_3d) {
nrows = Math.floor(obj.vertexCount/4);
if (pmode === "filled") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[4*i];
fnew[6*i+1] = f[4*i + 1];
fnew[6*i+2] = f[4*i + 2];
fnew[6*i+3] = f[4*i];
fnew[6*i+4] = f[4*i + 2];
fnew[6*i+5] = f[4*i + 3];
}
} else {
fnew = Array(8*nrows);
for (i=0; i < nrows; i++) {
fnew[8*i] = f[4*i];
fnew[8*i+1] = f[4*i + 1];
fnew[8*i+2] = f[4*i + 1];
fnew[8*i+3] = f[4*i + 2];
fnew[8*i+4] = f[4*i + 2];
fnew[8*i+5] = f[4*i + 3];
fnew[8*i+6] = f[4*i + 3];
fnew[8*i+7] = f[4*i];
}
}
} else if (type === "triangles") {
nrows = Math.floor(obj.vertexCount/3);
if (pmode === "filled") {
fnew = Array(3*nrows);
for (i=0; i < fnew.length; i++) {
fnew[i] = f[i];
}
} else if (pmode === "lines") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[3*i];
fnew[6*i + 1] = f[3*i + 1];
fnew[6*i + 2] = f[3*i + 1];
fnew[6*i + 3] = f[3*i + 2];
fnew[6*i + 4] = f[3*i + 2];
fnew[6*i + 5] = f[3*i];
}
}
} else if (type === "spheres") {
// default
} else if (type === "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
if (pmode === "filled") {
fnew = [];
for (j=0; j<nx-1; j++) {
for (i=0; i<nz-1; i++) {
fnew.push(f[j + nx*i],
f[j + nx*(i+1)],
f[j + 1 + nx*(i+1)],
f[j + nx*i],
f[j + 1 + nx*(i+1)],
f[j + 1 + nx*i]);
}
}
} else if (pmode === "lines") {
fnew = [];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz)
fnew.push(f[j + nx*i],
f[j + nx*(i+1)]);
if (j+1 < nx)
fnew.push(f[j + nx*i],
f[j+1 + nx*i]);
}
}
}
}
obj.f[pass] = fnew;
if (depth_sort) {
drawtype = "DYNAMIC_DRAW";
} else {
drawtype = "STATIC_DRAW";
}
}
if (fat_lines) {
alias = undefined;
obj.nextLoc = gl.getAttribLocation(obj.prog, "aNext");
obj.pointLoc = gl.getAttribLocation(obj.prog, "aPoint");
obj.aspectLoc = gl.getUniformLocation(obj.prog, "uAspect");
obj.lwdLoc = gl.getUniformLocation(obj.prog, "uLwd");
// Expand vertices to turn each segment into a pair of triangles
for (pass = 0; pass < obj.passes; pass++) {
f = obj.f[pass];	
oldrows = f.length;
if (obj.pmode[pass] === "lines") 
break;
}
if (type === "linestrip") 
nrows = 4*(oldrows - 1); 
else
nrows = 2*oldrows;
vnew = new Array(nrows);
fnew = new Array(1.5*nrows);
var fnext = new Array(nrows),
fpt = new Array(nrows), 
pt, start, gap = type === "linestrip" ? 3 : 1;
// We're going to turn each pair of vertices into 4 new ones, with the "next" and "pt" attributes
// added.
// We do this by copying the originals in the first pass, adding the new attributes, then in a 
// second pass add new vertices at the end.
for (i = 0; i < v.length; i++) {
vnew[i] = v[i].concat([0,0,0,0,0]); 
}
nextofs = stride;
pointofs = stride + 3;
stride = stride + 5;
// Now add the extras
last = v.length - 1;
ind = 0;
alias = new Array(f.length);
for (i = 0; i < f.length; i++)
alias[i] = [];
for (i = 0; i < f.length - 1; i++) {
if (type !== "linestrip" && i % 2 == 1)
continue;
k = ++last;
vnew[k] = vnew[f[i]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i+1]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = -1;
fnew[ind] = k;
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+1] = last;
alias[f[i]].push(last-1, last);
last++;
k = last;
vnew[k] = vnew[f[i+1]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = 1;
fnew[ind+2] = k;
fnew[ind+3] = fnew[ind+1];
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+4] = last;
fnew[ind+5] = fnew[ind+2];
ind += 6;
alias[f[i+1]].push(last-1, last);
}
vnew.length = last+1;
v = vnew;
obj.vertexCount = v.length;
if (typeof alias !== "undefined" && typeof obj.alias !== "undefined") {  // Already have aliases from previous section?
var oldalias = obj.alias, newalias = Array(obj.alias.length);
for (i = 0; i < newalias.length; i++) {
newalias[i] = oldalias[i].slice();
for (j = 0; j < oldalias[i].length; j++)
Array.prototype.push.apply(newalias[i], alias[oldalias[j]]); // pushes each element 
}
obj.alias = newalias;
} else
obj.alias = alias;
for (pass = 0; pass < obj.passes; pass++)
if (type === "lines" || type === "linestrip" || obj.pmode[pass] == "lines") {
obj.f[pass] = fnew;
}
if (depth_sort) 
drawtype = "DYNAMIC_DRAW";
else
drawtype = "STATIC_DRAW";
}
for (pass = 0; pass < obj.passes; pass++) {
if (obj.vertexCount > 65535) {
if (this.index_uint) {
obj.f[pass] = new Uint32Array(obj.f[pass]);
obj.index_uint = true;
} else
this.alertOnce("Object has "+obj.vertexCount+" vertices, not supported in this browser.");
} else {
obj.f[pass] = new Uint16Array(obj.f[pass]);
obj.index_uint = false;
}
}
if (stride !== v[0].length) {
this.alertOnce("problem in stride calculation");
}
obj.vOffsets = {vofs:0, cofs:cofs, nofs:nofs, radofs:radofs, oofs:oofs, tofs:tofs,
nextofs:nextofs, pointofs:pointofs, stride:stride};
obj.values = new Float32Array(this.flatten(v));
if (type !== "spheres" && !sprites_3d) {
obj.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW); //
obj.ibuf = Array(obj.passes);
obj.ibuf[0] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[0]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[0], gl[drawtype]);
if (is_twosided) {
obj.ibuf[1] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[1]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[1], gl[drawtype]);
}
}
if (!sprites_3d) {
obj.mvMatLoc = gl.getUniformLocation(obj.prog, "mvMatrix");
obj.prMatLoc = gl.getUniformLocation(obj.prog, "prMatrix");
}
if (fixed_size) {
obj.textScaleLoc = gl.getUniformLocation(obj.prog, "textScale");
}
if (is_lit && !sprites_3d) {
obj.normMatLoc = gl.getUniformLocation(obj.prog, "normMatrix");
}
if (is_twosided) {
obj.frontLoc = gl.getUniformLocation(obj.prog, "front");
}
};
/**
* Set gl depth test based on object's material
* @param { number } id - object to use
*/
rglwidgetClass.prototype.setDepthTest = function(id) {
var gl = this.gl || this.initGL(),
tests = {never: gl.NEVER,
less:  gl.LESS,
equal: gl.EQUAL,
lequal:gl.LEQUAL,
greater: gl.GREATER,
notequal: gl.NOTEQUAL,
gequal: gl.GEQUAL,
always: gl.ALWAYS},
test = tests[this.getMaterial(id, "depth_test")];
gl.depthFunc(test);
};
rglwidgetClass.prototype.mode4type = {points : "POINTS",
linestrip : "LINE_STRIP",
abclines : "LINES",
lines : "LINES",
sprites : "TRIANGLES",
planes : "TRIANGLES",
text : "TRIANGLES",
quads : "TRIANGLES",
surface : "TRIANGLES",
triangles : "TRIANGLES"};
/**
* Sort objects from back to front
* @returns { number[] }
* @param { Object } obj - object to sort
*/
rglwidgetClass.prototype.depthSort = function(obj) {
var n = obj.centers.length,
depths = new Float32Array(n),
result = new Array(n),
compare = function(i,j) { return depths[j] - depths[i]; },
z, w;
for(i=0; i<n; i++) {
z = this.prmvMatrix.m13*obj.centers[i][0] +
this.prmvMatrix.m23*obj.centers[i][1] +
this.prmvMatrix.m33*obj.centers[i][2] +
this.prmvMatrix.m43;
w = this.prmvMatrix.m14*obj.centers[i][0] +
this.prmvMatrix.m24*obj.centers[i][1] +
this.prmvMatrix.m34*obj.centers[i][2] +
this.prmvMatrix.m44;
depths[i] = z/w;
result[i] = i;
}
result.sort(compare);
return result;
};
rglwidgetClass.prototype.disableArrays = function(obj, enabled) {
var gl = this.gl || this.initGL(),
objLocs = ["normLoc", "texLoc", "ofsLoc", "pointLoc", "nextLoc"],
thisLocs = ["posLoc", "colLoc"], i, attr;
for (i = 0; i < objLocs.length; i++) 
if (enabled[objLocs[i]]) gl.disableVertexAttribArray(obj[objLocs[i]]);
for (i = 0; i < thisLocs.length; i++)
if (enabled[thisLocs[i]]) gl.disableVertexAttribArray(this[objLocs[i]]);
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.disableVertexAttribArray( obj.userAttribLocations[attr] );
}
}
}
/**
* Draw an object in a subscene
* @param { number } id - object to draw
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawObj = function(id, subsceneid) {
var obj = this.getObj(id),
subscene = this.getObj(subsceneid),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = flags & this.f_is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
is_points = flags & this.f_is_points,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
gl = this.gl || this.initGL(),
mat,
sphereMV, baseofs, ofs, sscale, i, count, light,
pass, mode, pmode, attr,
enabled = {};
if (typeof id !== "number") {
this.alertOnce("drawObj id is "+typeof id);
}
if (type === "planes") {
if (obj.bbox !== subscene.par3d.bbox || !obj.initialized) {
this.planeUpdateTriangles(id, subscene.par3d.bbox);
}
}
if (!obj.initialized)
this.initObj(id);
if (type === "clipplanes") {
count = obj.offsets.length;
var IMVClip = [];
for (i=0; i < count; i++) {
IMVClip[i] = this.multMV(this.invMatrix, obj.vClipplane.slice(4*i, 4*(i+1)));
}
obj.IMVClip = IMVClip;
return;
}
if (type === "light" || type === "bboxdeco" || !obj.vertexCount)
return;
if (!is_transparent &&
obj.someHidden) {
is_transparent = true;
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}        
this.setDepthTest(id);
if (sprites_3d) {
var norigs = obj.vertices.length,
savenorm = new CanvasMatrix4(this.normMatrix);
this.origs = obj.vertices;
this.usermat = new Float32Array(obj.userMatrix.getAsArray());
this.radii = obj.radii;
this.normMatrix = subscene.spriteNormmat;
for (this.iOrig=0; this.iOrig < norigs; this.iOrig++) {
for (i=0; i < obj.objects.length; i++) {
this.drawObj(obj.objects[i], subsceneid);
}
}
this.normMatrix = savenorm;
return;
} else {
gl.useProgram(obj.prog);
}
if (typeof obj.polygon_offset !== "undefined") {
gl.polygonOffset(obj.polygon_offset[0],
obj.polygon_offset[1]);
gl.enable(gl.POLYGON_OFFSET_FILL);
}
if (sprite_3d) {
gl.uniform3fv(obj.origLoc, new Float32Array(this.origs[this.iOrig]));
if (this.radii.length > 1) {
gl.uniform1f(obj.sizeLoc, this.radii[this.iOrig][0]);
} else {
gl.uniform1f(obj.sizeLoc, this.radii[0][0]);
}
gl.uniformMatrix4fv(obj.usermatLoc, false, this.usermat);
}
if (type === "spheres") {
gl.bindBuffer(gl.ARRAY_BUFFER, this.sphere.buf);
} else {
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
}
gl.uniformMatrix4fv( obj.prMatLoc, false, new Float32Array(this.prMatrix.getAsArray()) );
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(this.mvMatrix.getAsArray()) );
var clipcheck = 0,
clipplaneids = subscene.clipplanes,
clip, j;
for (i=0; i < clipplaneids.length; i++) {
clip = this.getObj(clipplaneids[i]);
for (j=0; j < clip.offsets.length; j++) {
gl.uniform4fv(obj.clipLoc[clipcheck + j], clip.IMVClip[j]);
}
clipcheck += clip.offsets.length;
}
if (typeof obj.clipLoc !== "undefined")
for (i=clipcheck; i < obj.clipLoc.length; i++)
gl.uniform4f(obj.clipLoc[i], 0,0,0,0);
if (is_lit) {
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(this.normMatrix.getAsArray()) );
gl.uniform3fv( obj.emissionLoc, obj.emission);
gl.uniform1f( obj.shininessLoc, obj.shininess);
for (i=0; i < subscene.lights.length; i++) {
light = this.getObj(subscene.lights[i]);
if (!light.initialized) this.initObj(subscene.lights[i]);
gl.uniform3fv( obj.ambientLoc[i], this.componentProduct(light.ambient, obj.ambient));
gl.uniform3fv( obj.specularLoc[i], this.componentProduct(light.specular, obj.specular));
gl.uniform3fv( obj.diffuseLoc[i], light.diffuse);
gl.uniform3fv( obj.lightDirLoc[i], light.lightDir);
gl.uniform1i( obj.viewpointLoc[i], light.viewpoint);
gl.uniform1i( obj.finiteLoc[i], light.finite);
}
for (i=subscene.lights.length; i < obj.nlights; i++) {
gl.uniform3f( obj.ambientLoc[i], 0,0,0);
gl.uniform3f( obj.specularLoc[i], 0,0,0);
gl.uniform3f( obj.diffuseLoc[i], 0,0,0);
}
}
if (fixed_size) {
gl.uniform2f( obj.textScaleLoc, 0.75/this.vp.width, 0.75/this.vp.height);
}
gl.enableVertexAttribArray( this.posLoc );
enabled.posLoc = true;
var nc = obj.colorCount;
count = obj.vertexCount;
if (type === "spheres") {
subscene = this.getObj(subsceneid);
var scale = subscene.par3d.scale,
scount = count, indices;
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.enableVertexAttribArray(obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.disableVertexAttribArray( this.colLoc );
var sphereNorm = new CanvasMatrix4();
sphereNorm.scale(scale[0], scale[1], scale[2]);
sphereNorm.multRight(this.normMatrix);
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(sphereNorm.getAsArray()) );
if (nc == 1) {
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
}
if (has_texture) {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,
4*this.sphere.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (depth_sort)
indices = this.depthSort(obj);
for (i = 0; i < scount; i++) {
sphereMV = new CanvasMatrix4();
if (depth_sort) {
baseofs = indices[i]*obj.vOffsets.stride;
} else {
baseofs = i*obj.vOffsets.stride;
}
ofs = baseofs + obj.vOffsets.radofs;
sscale = obj.values[ofs];
sphereMV.scale(sscale/scale[0], sscale/scale[1], sscale/scale[2]);
sphereMV.translate(obj.values[baseofs],
obj.values[baseofs+1],
obj.values[baseofs+2]);
sphereMV.multRight(this.mvMatrix);
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(sphereMV.getAsArray()) );
if (nc > 1) {
ofs = baseofs + obj.vOffsets.cofs;
gl.vertexAttrib4f( this.colLoc, obj.values[ofs],
obj.values[ofs+1],
obj.values[ofs+2],
obj.values[ofs+3] );
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.sphere.ibuf);
gl.drawElements(gl.TRIANGLES, this.sphere.sphereCount, gl.UNSIGNED_SHORT, 0);
}
this.disableArrays(obj, enabled);
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
return;
} else {
if (obj.colorCount === 1) {
gl.disableVertexAttribArray( this.colLoc );
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
} else {
gl.enableVertexAttribArray( this.colLoc );
enabled.colLoc = true;
gl.vertexAttribPointer(this.colLoc, 4, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.cofs);
}
}
if (is_lit && obj.vOffsets.nofs > 0) {
gl.enableVertexAttribArray( obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nofs);
}
if (has_texture || type === "text") {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (fixed_quads) {
gl.enableVertexAttribArray( obj.ofsLoc );
enabled.ofsLoc = true;
gl.vertexAttribPointer(obj.ofsLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.oofs);
}
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.enableVertexAttribArray( obj.userAttribLocations[attr] );
gl.vertexAttribPointer( obj.userAttribLocations[attr], obj.userAttribSizes[attr],
gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.userAttribOffsets[attr]);
}
}
if (typeof obj.userUniforms !== "undefined") {
for (attr in obj.userUniformLocations) {
var loc = obj.userUniformLocations[attr];
if (loc !== null) {
var uniform = obj.userUniforms[attr];
if (typeof uniform.length === "undefined")
gl.uniform1f(loc, uniform);
else if (typeof uniform[0].length === "undefined") {
uniform = new Float32Array(uniform);
switch(uniform.length) {
case 2: gl.uniform2fv(loc, uniform); break;
case 3: gl.uniform3fv(loc, uniform); break;
case 4: gl.uniform4fv(loc, uniform); break;
default: console.warn("bad uniform length");
}
} else if (uniform.length == 4 && uniform[0].length == 4)
gl.uniformMatrix4fv(loc, false, new Float32Array(uniform.getAsArray()));
else
console.warn("unsupported uniform matrix");
}
}
}
for (pass = 0; pass < obj.passes; pass++) {
pmode = obj.pmode[pass];
if (pmode === "culled")
continue;
mode = fat_lines && (is_lines || pmode == "lines") ? "TRIANGLES" : this.mode4type[type];
if (depth_sort && pmode == "filled") {// Don't try depthsorting on wireframe or points
var faces = this.depthSort(obj),
nfaces = faces.length,
frowsize = Math.floor(obj.f[pass].length/nfaces);
if (type !== "spheres") {
var f = obj.index_uint ? new Uint32Array(obj.f[pass].length) : new Uint16Array(obj.f[pass].length);
for (i=0; i<nfaces; i++) {
for (j=0; j<frowsize; j++) {
f[frowsize*i + j] = obj.f[pass][frowsize*faces[i] + j];
}
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.DYNAMIC_DRAW);
}
}
if (is_twosided)
gl.uniform1i(obj.frontLoc, pass !== 0);
if (type !== "spheres") 
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
if (type === "sprites" || type === "text" || type === "quads") {
count = count * 6/4;
} else if (type === "surface") {
count = obj.f[pass].length;
}
count = obj.f[pass].length;
if (!is_lines && pmode === "lines" && !fat_lines) {
mode = "LINES";
} else if (pmode === "points") {
mode = "POINTS";
}
if ((is_lines || pmode === "lines") && fat_lines) {
gl.enableVertexAttribArray(obj.pointLoc);
enabled.pointLoc = true;
gl.vertexAttribPointer(obj.pointLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.pointofs);
gl.enableVertexAttribArray(obj.nextLoc );
enabled.nextLoc = true;
gl.vertexAttribPointer(obj.nextLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nextofs);
gl.uniform1f(obj.aspectLoc, this.vp.width/this.vp.height);
gl.uniform1f(obj.lwdLoc, this.getMaterial(id, "lwd")/this.vp.height);
}
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*obj.vOffsets.stride,  4*obj.vOffsets.vofs);
gl.drawElements(gl[mode], count, obj.index_uint ? gl.UNSIGNED_INT : gl.UNSIGNED_SHORT, 0);
this.disableArrays(obj, enabled);
}
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
};
/**
* Draw the background for a subscene
* @param { number } id - id of background object
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawBackground = function(id, subsceneid) {
var gl = this.gl || this.initGL(),
obj = this.getObj(id),
bg, i;
if (!obj.initialized)
this.initObj(id);
if (obj.colors.length) {
bg = obj.colors[0];
gl.clearColor(bg[0], bg[1], bg[2], bg[3]);
gl.depthMask(true);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
}
if (typeof obj.quad !== "undefined") {
this.prMatrix.makeIdentity();
this.mvMatrix.makeIdentity();
gl.disable(gl.BLEND);
gl.disable(gl.DEPTH_TEST);
gl.depthMask(false);
for (i=0; i < obj.quad.length; i++)
this.drawObj(obj.quad[i], subsceneid);
}
};
/**
* Draw a subscene
* @param { number } subsceneid - id of subscene
* @param { boolean } opaquePass - is this the opaque drawing pass?
*/
rglwidgetClass.prototype.drawSubscene = function(subsceneid, opaquePass) {
var gl = this.gl || this.initGL(),
sub = this.getObj(subsceneid),
objects = this.scene.objects,
subids = sub.objects,
subscene_has_faces = false,
subscene_needs_sorting = false,
flags, i, obj;
if (sub.par3d.skipRedraw)
return;
for (i=0; i < subids.length; i++) {
obj = objects[subids[i]];
flags = obj.flags;
if (typeof flags !== "undefined") {
subscene_has_faces |= (flags & this.f_is_lit)
& !(flags & this.f_fixed_quads);
obj.is_transparent = (flags & this.f_is_transparent) || obj.someHidden;
subscene_needs_sorting |= (flags & this.f_depth_sort) || obj.is_transparent;
}
}
this.setViewport(subsceneid);
if (typeof sub.backgroundId !== "undefined" && opaquePass)
this.drawBackground(sub.backgroundId, subsceneid);
if (subids.length) {
this.setprMatrix(subsceneid);
this.setmvMatrix(subsceneid);
if (subscene_has_faces) {
this.setnormMatrix(subsceneid);
if ((sub.flags & this.f_sprites_3d) &&
typeof sub.spriteNormmat === "undefined") {
sub.spriteNormmat = new CanvasMatrix4(this.normMatrix);
}
}
if (subscene_needs_sorting)
this.setprmvMatrix();
var clipids = sub.clipplanes;
if (typeof clipids === "undefined") {
console.warn("bad clipids");
}
if (clipids.length > 0) {
this.invMatrix = new CanvasMatrix4(this.mvMatrix);
this.invMatrix.invert();
for (i = 0; i < clipids.length; i++)
this.drawObj(clipids[i], subsceneid);
}
subids = sub.opaque.concat(sub.transparent);
if (opaquePass) {
gl.enable(gl.DEPTH_TEST);
gl.depthMask(true);
gl.disable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (!this.getObj(subids[i]).is_transparent)	
this.drawObj(subids[i], subsceneid);
}
} else {
gl.depthMask(false);
gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA,
gl.ONE, gl.ONE);
gl.enable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (this.getObj(subids[i]).is_transparent)
this.drawObj(subids[i], subsceneid);
}
}
subids = sub.subscenes;
for (i = 0; i < subids.length; i++) {
this.drawSubscene(subids[i], opaquePass);
}
}
};
/**
* Respond to brush change
*/
rglwidgetClass.prototype.selectionChanged = function() {
var i, j, k, id, subid = this.select.subscene, subscene,
objids, obj,
p1 = this.select.region.p1, p2 = this.select.region.p2,
filter, selection = [], handle, keys, xmin, x, xmax, ymin, y, ymax, z, v,
someHidden;
if (!subid)
return;
subscene = this.getObj(subid);
objids = subscene.objects;
filter = this.scene.crosstalk.filter;
this.setmvMatrix(subid);
this.setprMatrix(subid);
this.setprmvMatrix();
xmin = Math.min(p1.x, p2.x);
xmax = Math.max(p1.x, p2.x);
ymin = Math.min(p1.y, p2.y);
ymax = Math.max(p1.y, p2.y);
for (i = 0; i < objids.length; i++) {
id = objids[i];
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
keys = this.scene.crosstalk.key[j];
obj = this.getObj(id);
someHidden = false;
for (k = 0; k < keys.length; k++) {
if (filter && filter.indexOf(keys[k]) < 0) {
someHidden = true;
continue;
}
v = [].concat(obj.vertices[k]).concat(1.0);
v = this.multVM(v, this.prmvMatrix);
x = v[0]/v[3];
y = v[1]/v[3];
z = v[2]/v[3];
if (xmin <= x && x <= xmax && ymin <= y && y <= ymax && -1.0 <= z && z <= 1.0) {
selection.push(keys[k]);
} else
someHidden = true;
}
obj.someHidden = someHidden && (filter || selection.length);
obj.initialized = false;
/* Who should we notify?  Only shared data in the current subscene, or everyone? */
if (!this.equalArrays(selection, this.scene.crosstalk.selection)) {
handle = this.scene.crosstalk.sel_handle[j];
handle.set(selection, {rglSubsceneId: this.select.subscene});
}
}
}
};
/**
* Respond to selection or filter change from crosstalk
* @param { Object } event - crosstalk event
* @param { boolean } filter - filter or selection?
*/
rglwidgetClass.prototype.selection = function(event, filter) {
var i, j, ids, obj, keys, crosstalk = this.scene.crosstalk,
selection, someHidden;
// Record the message and find out if this event makes some objects have mixed values:
crosstalk = this.scene.crosstalk;
if (filter) {
filter = crosstalk.filter = event.value;
selection = crosstalk.selection;
} else {  
selection = crosstalk.selection = event.value;
filter = crosstalk.filter;
}
ids = crosstalk.id;
for (i = 0; i < ids.length ; i++) {
obj = this.getObj(ids[i]);
obj.initialized = false;
keys = crosstalk.key[i];
someHidden = false;
for (j = 0; j < keys.length && !someHidden; j++) {
if ((filter && filter.indexOf(keys[j]) < 0) ||
(selection.length && selection.indexOf(keys[j]) < 0))
someHidden = true;
}
obj.someHidden = someHidden;
}
this.drawScene();
};
/**
* Clear the selection brush
* @param { number } except - Subscene that should ignore this request
*/
rglwidgetClass.prototype.clearBrush = function(except) {
if (this.select.subscene != except) {
this.select.state = "inactive";
this.delFromSubscene(this.scene.brushId, this.select.subscene);
}
this.drawScene();
};
/**
* Compute mouse coordinates relative to current canvas
* @returns { Object }
* @param { Object } event - event object from mouse click
*/
rglwidgetClass.prototype.relMouseCoords = function(event) {
var totalOffsetX = 0,
totalOffsetY = 0,
currentElement = this.canvas;
do {
totalOffsetX += currentElement.offsetLeft;
totalOffsetY += currentElement.offsetTop;
currentElement = currentElement.offsetParent;
}
while(currentElement);
var canvasX = event.pageX - totalOffsetX,
canvasY = event.pageY - totalOffsetY;
return {x:canvasX, y:canvasY};
};
/**
* Set mouse handlers for the scene
*/
rglwidgetClass.prototype.setMouseHandlers = function() {
var self = this, activeSubscene, handler,
handlers = {}, drag = 0;
handlers.rotBase = 0;
this.screenToVector = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
radius = Math.max(width, height)/2.0,
cx = width/2.0,
cy = height/2.0,
px = (x-cx)/radius,
py = (y-cy)/radius,
plen = Math.sqrt(px*px+py*py);
if (plen > 1.e-6) {
px = px/plen;
py = py/plen;
}
var angle = (Math.SQRT2 - plen)/Math.SQRT2*Math.PI/2,
z = Math.sin(angle),
zlen = Math.sqrt(1.0 - z*z);
px = px * zlen;
py = py * zlen;
return [px, py, z];
};
handlers.trackballdown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.rotBase = this.screenToVector(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.trackballmove = function(x,y) {
var rotCurrent = this.screenToVector(x,y),
rotBase = handlers.rotBase,
dot = rotBase[0]*rotCurrent[0] +
rotBase[1]*rotCurrent[1] +
rotBase[2]*rotCurrent[2],
angle = Math.acos( dot/this.vlen(rotBase)/this.vlen(rotCurrent) )*180.0/Math.PI,
axis = this.xprod(rotBase, rotCurrent),
objects = this.scene.objects,
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
l = activeModel.par3d.listeners,
i;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(angle, axis[0], axis[1], axis[2]);
}
this.drawScene();
};
handlers.trackballend = 0;
this.clamp = function(x, lo, hi) {
return Math.max(lo, Math.min(x, hi));
};
this.screenToPolar = function(x,y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
r = Math.min(width, height)/2,
dx = this.clamp(x - width/2, -r, r),
dy = this.clamp(y - height/2, -r, r);
return [Math.asin(dx/r), Math.asin(-dy/r)];
};
handlers.polardown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.dragBase = this.screenToPolar(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
activeSub.camBase = [-Math.atan2(activeSub.saveMat.m13, activeSub.saveMat.m11),
Math.atan2(activeSub.saveMat.m32, activeSub.saveMat.m22)];
}
};
handlers.polarmove = function(x,y) {
var dragCurrent = this.screenToPolar(x,y),
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
objects = this.scene.objects,
l = activeModel.par3d.listeners,
i, changepos = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
for (j=0; j<2; j++)
changepos[j] = -(dragCurrent[j] - handlers.dragBase[j]);
activeSub.par3d.userMatrix.makeIdentity();
activeSub.par3d.userMatrix.rotate(changepos[0]*180/Math.PI, 0,-1,0);
activeSub.par3d.userMatrix.multRight(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(changepos[1]*180/Math.PI, -1,0,0);
}
this.drawScene();
};
handlers.polarend = 0;
handlers.axisdown = function(x,y) {
handlers.rotBase = this.screenToVector(x, this.canvas.height/2);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.axismove = function(x,y) {
var rotCurrent = this.screenToVector(x, this.canvas.height/2),
rotBase = handlers.rotBase,
angle = (rotCurrent[0] - rotBase[0])*180/Math.PI,
rotMat = new CanvasMatrix4();
rotMat.rotate(angle, handlers.axis[0], handlers.axis[1], handlers.axis[2]);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(activeSub.saveMat);
activeSub.par3d.userMatrix.multLeft(rotMat);
}
this.drawScene();
};
handlers.axisend = 0;
handlers.y0zoom = 0;
handlers.zoom0 = 0;
handlers.zoomdown = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
handlers.y0zoom = y;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.zoom0 = Math.log(activeSub.par3d.zoom);
}
};
handlers.zoommove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.zoom = Math.exp(activeSub.zoom0 + (y-handlers.y0zoom)/this.canvas.height);
}
this.drawScene();
};
handlers.zoomend = 0;
handlers.y0fov = 0;
handlers.fovdown = function(x, y) {
handlers.y0fov = y;
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.fov0 = activeSub.par3d.FOV;
}
};
handlers.fovmove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.FOV = Math.max(1, Math.min(179, activeSub.fov0 +
180*(y-handlers.y0fov)/this.canvas.height));
}
this.drawScene();
};
handlers.fovend = 0;
handlers.selectingdown = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height, 
p = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
this.select.region = {p1: p, p2: p};
if (this.select.subscene && this.select.subscene != activeSubscene)
this.delFromSubscene(this.scene.brushId, this.select.subscene);
this.select.subscene = activeSubscene;
this.addToSubscene(this.scene.brushId, activeSubscene);
this.select.state = "changing";
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingmove = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height;
if (this.select.state === "inactive") 
return;
this.select.region.p2 = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingend = 0;
this.canvas.onmousedown = function ( ev ){
if (!ev.which) // Use w3c defns in preference to MS
switch (ev.button) {
case 0: ev.which = 1; break;
case 1:
case 4: ev.which = 2; break;
case 2: ev.which = 3;
}
drag = ["left", "middle", "right"][ev.which-1];
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height-coords.y;
activeSubscene = self.whichSubscene(coords);
var sub = self.getObj(activeSubscene), f;
handler = sub.par3d.mouseMode[drag];
switch (handler) {
case "xAxis":
handler = "axis";
handlers.axis = [1.0, 0.0, 0.0];
break;
case "yAxis":
handler = "axis";
handlers.axis = [0.0, 1.0, 0.0];
break;
case "zAxis":
handler = "axis";
handlers.axis = [0.0, 0.0, 1.0];
break;
}
f = handlers[handler + "down"];
if (f) {
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
ev.preventDefault();
} else
console.warn("Mouse handler '" + handler + "' is not implemented.");
};
this.canvas.onmouseup = function ( ev ){
if ( drag === 0 ) return;
var f = handlers[handler + "end"];
if (f) {
f.call(self);
ev.preventDefault();
}
drag = 0;
};
this.canvas.onmouseout = this.canvas.onmouseup;
this.canvas.onmousemove = function ( ev ) {
if ( drag === 0 ) return;
var f = handlers[handler + "move"];
if (f) {
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height - coords.y;
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
}
};
handlers.wheelHandler = function(ev) {
var del = 1.02, i;
if (ev.shiftKey) del = 1.002;
var ds = ((ev.detail || ev.wheelDelta) > 0) ? del : (1 / del);
if (typeof activeSubscene === "undefined")
activeSubscene = self.scene.rootSubscene;
var activeSub = self.getObj(activeSubscene),
activeProjection = self.getObj(self.useid(activeSub.id, "projection")),
l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = self.getObj(l[i]);
activeSub.par3d.zoom *= ds;
}
self.drawScene();
ev.preventDefault();
};
this.canvas.addEventListener("DOMMouseScroll", handlers.wheelHandler, false);
this.canvas.addEventListener("mousewheel", handlers.wheelHandler, false);
};
/**
* Find a particular subscene by inheritance
* @returns { number } id of subscene to use
* @param { number } subsceneid - child subscene
* @param { string } type - type of inheritance:  "projection" or "model"
*/
rglwidgetClass.prototype.useid = function(subsceneid, type) {
var sub = this.getObj(subsceneid);
if (sub.embeddings[type] === "inherit")
return(this.useid(sub.parent, type));
else
return subsceneid;
};
/**
* Check whether point is in viewport of subscene
* @returns {boolean}
* @param { Object } coords - screen coordinates of point
* @param { number } subsceneid - subscene to check
*/
rglwidgetClass.prototype.inViewport = function(coords, subsceneid) {
var viewport = this.getObj(subsceneid).par3d.viewport,
x0 = coords.x - viewport.x*this.canvas.width,
y0 = coords.y - viewport.y*this.canvas.height;
return 0 <= x0 && x0 <= viewport.width*this.canvas.width &&
0 <= y0 && y0 <= viewport.height*this.canvas.height;
};
/**
* Find which subscene contains a point
* @returns { number } subscene id
* @param { Object } coords - coordinates of point
*/
rglwidgetClass.prototype.whichSubscene = function(coords) {
var self = this,
recurse = function(subsceneid) {
var subscenes = self.getChildSubscenes(subsceneid), i, id;
for (i=0; i < subscenes.length; i++) {
id = recurse(subscenes[i]);
if (typeof(id) !== "undefined")
return(id);
}
if (self.inViewport(coords, subsceneid))
return(subsceneid);
else
return undefined;
},
rootid = this.scene.rootSubscene,
result = recurse(rootid);
if (typeof(result) === "undefined")
result = rootid;
return result;
};
/**
* Translate from window coordinates to viewport coordinates
* @returns { Object } translated coordinates
* @param { number } subsceneid - which subscene to use?
* @param { Object } coords - point to translate
*/
rglwidgetClass.prototype.translateCoords = function(subsceneid, coords) {
var viewport = this.getObj(subsceneid).par3d.viewport;
return {x: coords.x - viewport.x*this.canvas.width,
y: coords.y - viewport.y*this.canvas.height};
};
/**
* Initialize the sphere object
*/
rglwidgetClass.prototype.initSphere = function() {
var verts = this.scene.sphereVerts,
reuse = verts.reuse, result;
if (typeof reuse !== "undefined") {
var prev = document.getElementById(reuse).rglinstance.sphere;
result = {values: prev.values, vOffsets: prev.vOffsets, it: prev.it};
} else
result = {values: new Float32Array(this.flatten(this.cbind(this.transpose(verts.vb),
this.transpose(verts.texcoords)))),
it: new Uint16Array(this.flatten(this.transpose(verts.it))),
vOffsets: {vofs:0, cofs:-1, nofs:-1, radofs:-1, oofs:-1,
tofs:3, nextofs:-1, pointofs:-1, stride:5}};
result.sphereCount = result.it.length;
this.sphere = result;
};
/**
* Set the vertices in the selection box object
*/
rglwidgetClass.prototype.initSelection = function(id) {
if (typeof this.select.region === "undefined")
return;
var obj = this.getObj(id),
width = this.canvas.width,
height = this.canvas.height, 
p1 = this.select.region.p1,
p2 = this.select.region.p2;
obj.vertices = [[p1.x, p1.y, 0.0],
[p2.x, p1.y, 0.0],
[p2.x, p2.y, 0.0],
[p1.x, p2.y, 0.0],
[p1.x, p1.y, 0.0]];
};
/**
* Do the gl part of initializing the sphere
*/
rglwidgetClass.prototype.initSphereGL = function() {
var gl = this.gl || this.initGL(), sphere = this.sphere;
if (gl.isContextLost()) return;
sphere.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sphere.buf);
gl.bufferData(gl.ARRAY_BUFFER, sphere.values, gl.STATIC_DRAW);
sphere.ibuf = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphere.ibuf);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, sphere.it, gl.STATIC_DRAW);
return;
};
/**
* Initialize the DOM object
* @param { Object } el - the DOM object
* @param { Object } x - the scene data sent by JSON from R
*/
rglwidgetClass.prototype.initialize = function(el, x) {
this.textureCanvas = document.createElement("canvas");
this.textureCanvas.style.display = "block";
this.scene = x;
this.normMatrix = new CanvasMatrix4();
this.saveMat = {};
this.distance = null;
this.posLoc = 0;
this.colLoc = 1;
if (el) {
el.rglinstance = this;
this.el = el;
this.webGLoptions = el.rglinstance.scene.webGLoptions;
this.initCanvas();
}
if (typeof Shiny !== "undefined") {
var self = this;
Shiny.addCustomMessageHandler("shinyGetPar3d",
function(message) {
var i, param, 
subscene = self.getObj(message.subscene),
parameters = [].concat(message.parameters),
result = {tag: message.tag, subscene: message.subscene};
if (typeof subscene !== "undefined") {
for (i = 0; i < parameters.length; i++) {
param = parameters[i];
result[param] = subscene.par3d[param];
};
} else {
console.log("subscene "+message.subscene+" undefined.")
}
Shiny.setInputValue("par3d:shinyPar3d", result, {priority: "event"});
});
Shiny.addCustomMessageHandler("shinySetPar3d",
function(message) {
var param = message.parameter, 
subscene = self.getObj(message.subscene);
if (typeof subscene !== "undefined") {
subscene.par3d[param] = message.value;
subscene.initialized = false;
self.drawScene();
} else {
console.log("subscene "+message.subscene+" undefined.")
}
})
}
};
/**
* Restart the WebGL canvas
*/
rglwidgetClass.prototype.restartCanvas = function() {
var newcanvas = document.createElement("canvas"),
self = this;
newcanvas.width = this.el.width;
newcanvas.height = this.el.height;
newcanvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
newcanvas.addEventListener("webglcontextlost",
this.onContextLost, false);
while (this.el.firstChild) {
this.el.removeChild(this.el.firstChild);
}
this.el.appendChild(newcanvas);
this.canvas = newcanvas;
this.setMouseHandlers();
if (this.gl) 
Object.keys(this.scene.objects).forEach(function(key){
self.getObj(parseInt(key, 10)).texture = undefined; 
});
this.gl = null;
};
/**
* Initialize the WebGL canvas
*/
rglwidgetClass.prototype.initCanvas = function() {
this.restartCanvas();
var objs = this.scene.objects,
self = this;
Object.keys(objs).forEach(function(key){
var id = parseInt(key, 10),
obj = self.getObj(id);
if (typeof obj.reuse !== "undefined")
self.copyObj(id, obj.reuse);
});
Object.keys(objs).forEach(function(key){
self.initSubscene(parseInt(key, 10));
});
this.setMouseHandlers();
this.initSphere();
this.onContextRestored = function(event) {
self.initGL();
self.drawScene();
};
this.onContextLost = function(event) {
if (!self.drawing)
this.gl = null;
event.preventDefault();
};
this.initGL0();
this.lazyLoadScene = function() {
if (typeof self.slide === "undefined")
self.slide = self.getSlide();
if (self.isInBrowserViewport()) {
if (!self.gl || self.gl.isContextLost())
self.initGL();
self.drawScene();
}
};
window.addEventListener("DOMContentLoaded", this.lazyLoadScene, false);
window.addEventListener("load", this.lazyLoadScene, false);
window.addEventListener("resize", this.lazyLoadScene, false);
window.addEventListener("scroll", this.lazyLoadScene, false);
this.slide = this.getSlide();
if (this.slide) {
if (typeof this.slide.rgl === "undefined")
this.slide.rgl = [this];
else
this.slide.rgl.push(this);
if (this.scene.context.rmarkdown) 
if (this.scene.context.rmarkdown === "ioslides_presentation") {
this.slide.setAttribute("slideenter", "this.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window);})");
} else if (this.scene.context.rmarkdown === "slidy_presentation") {
// This method would also work in ioslides, but it gets triggered
// something like 5 times per slide for every slide change, so
// you'd need a quicker function than lazyLoadScene.
var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver,
observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
self.slide.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window); });});});
observer.observe(this.slide, { attributes: true, attributeFilter:["class"] });
}
}
};
/**
* Start the writeWebGL scene. This is only used by writeWebGL; rglwidget has
no debug element and does the drawing in rglwidget.js.
*/
rglwidgetClass.prototype.start = function() {
if (typeof this.prefix !== "undefined") {
this.debugelement = document.getElementById(this.prefix + "debug");
this.debug("");
}
this.drag = 0;
this.drawScene();
};
/**
* Display a debug message
* @param { string } msg - The message to display
* @param { Object } [img] - Image to insert before message
*/
rglwidgetClass.prototype.debug = function(msg, img) {
if (typeof this.debugelement !== "undefined" && this.debugelement !== null) {
this.debugelement.innerHTML = msg;
if (typeof img !== "undefined") {
this.debugelement.insertBefore(img, this.debugelement.firstChild);
}
} else if (msg !== "")
alert(msg);
};
/**
* Get the snapshot image of this scene
* @returns { Object } The img DOM element
*/
rglwidgetClass.prototype.getSnapshot = function() {
var img;
if (typeof this.scene.snapshot !== "undefined") {
img = document.createElement("img");
img.src = this.scene.snapshot;
img.alt = "Snapshot";
}
return img;
};
/**
* Initial test for WebGL
*/
rglwidgetClass.prototype.initGL0 = function() {
if (!window.WebGLRenderingContext){
alert("Your browser does not support WebGL. See http://get.webgl.org");
return;
}
};
/**
* If we are in an ioslides or slidy presentation, get the
* DOM element of the current slide
* @returns { Object }
*/
rglwidgetClass.prototype.getSlide = function() {
var result = this.el, done = false;
while (result && !done && this.scene.context.rmarkdown) {
switch(this.scene.context.rmarkdown) {
case "ioslides_presentation":
if (result.tagName === "SLIDE") return result;
break;
case "slidy_presentation":
if (result.tagName === "DIV" && result.classList.contains("slide"))
return result;
break;
default: return null;
}
result = result.parentElement;
}
return null;
};
/**
* Is this scene visible in the browser?
* @returns { boolean }
*/
rglwidgetClass.prototype.isInBrowserViewport = function() {
var rect = this.canvas.getBoundingClientRect(),
windHeight = (window.innerHeight || document.documentElement.clientHeight),
windWidth = (window.innerWidth || document.documentElement.clientWidth);
if (this.scene.context && this.scene.context.rmarkdown !== null) {
if (this.slide)
return (this.scene.context.rmarkdown === "ioslides_presentation" &&
this.slide.classList.contains("current")) ||
(this.scene.context.rmarkdown === "slidy_presentation" &&
!this.slide.classList.contains("hidden"));
}
return (
rect.top >= -windHeight &&
rect.left >= -windWidth &&
rect.bottom <= 2*windHeight &&
rect.right <= 2*windWidth);
};
/**
* Initialize WebGL
* @returns { Object } the WebGL context
*/
rglwidgetClass.prototype.initGL = function() {
var self = this;
if (this.gl) {
if (!this.drawing && this.gl.isContextLost())
this.restartCanvas();
else
return this.gl;
}
// if (!this.isInBrowserViewport()) return; Return what??? At this point we know this.gl is null.
this.canvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
this.canvas.addEventListener("webglcontextlost",
this.onContextLost, false);
this.gl = this.canvas.getContext("webgl", this.webGLoptions) ||
this.canvas.getContext("experimental-webgl", this.webGLoptions);
this.index_uint = this.gl.getExtension("OES_element_index_uint");
var save = this.startDrawing();
this.initSphereGL();
Object.keys(this.scene.objects).forEach(function(key){
self.initObj(parseInt(key, 10));
});
this.stopDrawing(save);
return this.gl;
};
/**
* Resize the display to match element
* @param { Object } el - DOM element to match
*/
rglwidgetClass.prototype.resize = function(el) {
this.canvas.width = el.width;
this.canvas.height = el.height;
};
/**
* Draw the whole scene
*/
rglwidgetClass.prototype.drawScene = function() {
var gl = this.gl || this.initGL(),
wasDrawing = this.startDrawing();
if (!wasDrawing) {
if (this.select.state !== "inactive")
this.selectionChanged();
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);
gl.clearDepth(1.0);
gl.clearColor(1,1,1,1);
gl.depthMask(true); // Must be true before clearing depth buffer
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
this.drawSubscene(this.scene.rootSubscene, true);
this.drawSubscene(this.scene.rootSubscene, false);
}
this.stopDrawing(wasDrawing);
};
/**
* Change the displayed subset
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The subset control data.
*/
rglwidgetClass.prototype.subsetSetter = function(el, control) {
if (typeof control.subscenes === "undefined" ||
control.subscenes === null)
control.subscenes = this.scene.rootSubscene;
var value = Math.round(control.value),
subscenes = [].concat(control.subscenes),
fullset = [].concat(control.fullset),
i, j, entries, subsceneid,
adds = [], deletes = [],
ismissing = function(x) {
return fullset.indexOf(x) < 0;
},
tointeger = function(x) {
return parseInt(x, 10);
};
if (isNaN(value))
value = control.value = 0;
if (control.accumulate)
for (i=0; i <= value; i++)
adds = adds.concat(control.subsets[i]);
else
adds = adds.concat(control.subsets[value]);
deletes = fullset.filter(function(x) { return adds.indexOf(x) < 0; });
for (i = 0; i < subscenes.length; i++) {
subsceneid = subscenes[i];
if (typeof this.getObj(subsceneid) === "undefined")
this.alertOnce("typeof object is undefined");
for (j = 0; j < adds.length; j++)
this.addToSubscene(adds[j], subsceneid);
for (j = 0; j < deletes.length; j++)
this.delFromSubscene(deletes[j], subsceneid);
}
};
/**
* Change the requested property
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The property setter control data.
*/
rglwidgetClass.prototype.propertySetter = function(el, control)  {
var value = control.value,
values = [].concat(control.values),
svals = [].concat(control.param),
direct = values[0] === null,
entries = [].concat(control.entries),
ncol = entries.length,
nrow = values.length/ncol,
properties = this.repeatToLen(control.properties, ncol),
objids = this.repeatToLen(control.objids, ncol),
property, objid = objids[0],
obj = this.getObj(objid),
propvals, i, v1, v2, p, entry, gl, needsBinding,
newprop, newid,
getPropvals = function() {
if (property === "userMatrix")
return obj.par3d.userMatrix.getAsArray();
else if (property === "scale" || property === "FOV" || property === "zoom")
return [].concat(obj.par3d[property]);
else
return [].concat(obj[property]);
};
putPropvals = function(newvals) {
if (newvals.length == 1)
newvals = newvals[0];
if (property === "userMatrix")
obj.par3d.userMatrix.load(newvals);
else if (property === "scale" || property === "FOV" || property === "zoom")
obj.par3d[property] = newvals;
else
obj[property] = newvals;
};
if (direct && typeof value === "undefined")
return;
if (control.interp) {
values = values.slice(0, ncol).concat(values).
concat(values.slice(ncol*(nrow-1), ncol*nrow));
svals = [-Infinity].concat(svals).concat(Infinity);
for (i = 1; i < svals.length; i++) {
if (value <= svals[i]) {
if (svals[i] === Infinity)
p = 1;
else
p = (svals[i] - value)/(svals[i] - svals[i-1]);
break;
}
}
} else if (!direct) {
value = Math.round(value);
}
for (j=0; j<entries.length; j++) {
entry = entries[j];
newprop = properties[j];
newid = objids[j];
if (newprop !== property || newid != objid) {
if (typeof property !== "undefined")
putPropvals(propvals);
property = newprop;
objid = newid;
obj = this.getObj(objid);
propvals = getPropvals();
}
if (control.interp) {
v1 = values[ncol*(i-1) + j];
v2 = values[ncol*i + j];
this.setElement(propvals, entry, p*v1 + (1-p)*v2);
} else if (!direct) {
this.setElement(propvals, entry, values[ncol*value + j]);
} else {
this.setElement(propvals, entry, value[j]);
}
}
putPropvals(propvals);
needsBinding = [];
for (j=0; j < entries.length; j++) {
if (properties[j] === "values" &&
needsBinding.indexOf(objids[j]) === -1) {
needsBinding.push(objids[j]);
}
}
for (j=0; j < needsBinding.length; j++) {
gl = this.gl || this.initGL();
obj = this.getObj(needsBinding[j]);
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertices
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The vertext setter control data.
*/
rglwidgetClass.prototype.vertexSetter = function(el, control)  {
var svals = [].concat(control.param),
j, k, p, a, propvals, stride, ofs, obj, entry,
attrib,
ofss    = {x:"vofs", y:"vofs", z:"vofs",
red:"cofs", green:"cofs", blue:"cofs",
alpha:"cofs", radii:"radofs",
nx:"nofs", ny:"nofs", nz:"nofs",
ox:"oofs", oy:"oofs", oz:"oofs",
ts:"tofs", tt:"tofs"},
pos     = {x:0, y:1, z:2,
red:0, green:1, blue:2,
alpha:3,radii:0,
nx:0, ny:1, nz:2,
ox:0, oy:1, oz:2,
ts:0, tt:1},
values = control.values,
direct = values === null,
ncol,
interp = control.interp,
vertices = [].concat(control.vertices),
attributes = [].concat(control.attributes),
value = control.value, newval, aliases, alias;
ncol = Math.max(vertices.length, attributes.length);
if (!ncol)
return;
vertices = this.repeatToLen(vertices, ncol);
attributes = this.repeatToLen(attributes, ncol);
if (direct)
interp = false;
/* JSON doesn't pass Infinity */
svals[0] = -Infinity;
svals[svals.length - 1] = Infinity;
for (j = 1; j < svals.length; j++) {
if (value <= svals[j]) {
if (interp) {
if (svals[j] === Infinity)
p = 1;
else
p = (svals[j] - value)/(svals[j] - svals[j-1]);
} else {
if (svals[j] - value > value - svals[j-1])
j = j - 1;
}
break;
}
}
obj = this.getObj(control.objid);
// First, make sure color attributes vary in original
if (typeof obj.vOffsets !== "undefined") {
varies = true;
for (k = 0; k < ncol; k++) {
attrib = attributes[k];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0) {
switch(attrib) {
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(control.objid);
}
propvals = obj.values;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
for (k=0; k<ncol; k++) {
if (direct) {
newval = value;
} else if (interp) {
newval = p*values[j-1][k] + (1-p)*values[j][k];
} else {
newval = values[j][k];
}      	
attrib = attributes[k];
vertex = vertices[k];
alias = aliases[vertex];
if (obj.type === "planes" || obj.type === "clipplanes") {
ofs = ["nx", "ny", "nz", "offset"].indexOf(attrib);
if (ofs >= 0) {
if (ofs < 3) {
if (obj.normals[vertex][ofs] != newval) {  // Assume no aliases here...
obj.normals[vertex][ofs] = newval;
obj.initialized = false;
}
} else {
if (obj.offsets[vertex][0] != newval) {
obj.offsets[vertex][0] = newval;
obj.initialized = false;
}
}
continue;
}
}
// Not a plane setting...
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0)
this.alertOnce("Attribute '"+attrib+"' not found in object "+control.objid);
else {
stride = obj.vOffsets.stride;
ofs = ofs + pos[attrib];
entry = vertex*stride + ofs;
propvals[entry] = newval;
if (typeof alias !== "undefined")
for (a = 0; a < alias.length; a++)
propvals[alias[a]*stride + ofs] = newval;
}
}
if (typeof obj.buf !== "undefined") {
var gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, propvals, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertex properties by age
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The age setter control data.
*/
rglwidgetClass.prototype.ageSetter = function(el, control) {
var objids = [].concat(control.objids),
nobjs = objids.length,
time = control.value,
births = [].concat(control.births),
ages = [].concat(control.ages),
steps = births.length,
j = Array(steps),
p = Array(steps),
i, k, age, j0, propvals, stride, ofs, objid, obj,
attrib, dim, varies, alias, aliases, a, d,
attribs = ["colors", "alpha", "radii", "vertices",
"normals", "origins", "texcoords",
"x", "y", "z",
"red", "green", "blue"],
ofss    = ["cofs", "cofs", "radofs", "vofs",
"nofs", "oofs", "tofs",
"vofs", "vofs", "vofs",
"cofs", "cofs", "cofs"],
dims    = [3,1,1,3,
3,2,2,
1,1,1,
1,1,1],
pos     = [0,3,0,0,
0,0,0,
0,1,2,
0,1,2];
/* Infinity doesn't make it through JSON */
ages[0] = -Infinity;
ages[ages.length-1] = Infinity;
for (i = 0; i < steps; i++) {
if (births[i] !== null) {  // NA in R becomes null
age = time - births[i];
for (j0 = 1; age > ages[j0]; j0++);
if (ages[j0] == Infinity)
p[i] = 1;
else if (ages[j0] > ages[j0-1])
p[i] = (ages[j0] - age)/(ages[j0] - ages[j0-1]);
else
p[i] = 0;
j[i] = j0;
}
}
// First, make sure color attributes vary in original
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
varies = true;
if (typeof obj.vOffsets === "undefined")
continue;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs < 0) {
switch(attribs[k]) {
case "colors":
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(objid);
}
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
if (typeof obj.vOffsets === "undefined")
continue;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
propvals = obj.values;
stride = obj.vOffsets.stride;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs >= 0) {
dim = dims[k];
ofs = ofs + pos[k];
for (i = 0; i < steps; i++) {
alias = aliases[i];
if (births[i] !== null) {
for (d=0; d < dim; d++) {
propvals[i*stride + ofs + d] = p[i]*attrib[dim*(j[i]-1) + d] + (1-p[i])*attrib[dim*j[i] + d];
if (typeof alias !== "undefined")
for (a=0; a < alias.length; a++)
propvals[alias[a]*stride + ofs + d] = propvals[i*stride + ofs + d];
}
}
}
} else
this.alertOnce("\'"+attribs[k]+"\' property not found in object "+objid);
}
}
obj.values = propvals;
if (typeof obj.buf !== "undefined") {
gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
}
};
/**
* Bridge to old style control
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The bridge control data.
*/
rglwidgetClass.prototype.oldBridge = function(el, control) {
var attrname, global = window[control.prefix + "rgl"];
if (global)
for (attrname in global)
this[attrname] = global[attrname];
window[control.prefix + "rgl"] = this;
};
/**
* Set up a player control
* @param { Object } el - The player control element
* @param { Object } control - The player data.
*/
rglwidgetClass.prototype.Player = function(el, control) {
var
self = this,
components = [].concat(control.components),
buttonLabels = [].concat(control.buttonLabels),
Tick = function() { /* "this" will be a timer */
var i,
nominal = this.value,
slider = this.Slider,
labels = this.outputLabels,
output = this.Output,
step;
if (typeof slider !== "undefined" && nominal != slider.value)
slider.value = nominal;
if (typeof output !== "undefined") {
step = Math.round((nominal - output.sliderMin)/output.sliderStep);
if (labels !== null) {
output.innerHTML = labels[step];
} else {
step = step*output.sliderStep + output.sliderMin;
output.innerHTML = step.toPrecision(output.outputPrecision);
}
}
for (i=0; i < this.actions.length; i++) {
this.actions[i].value = nominal;
}
self.applyControls(el, this.actions, false);
self.drawScene();
},
OnSliderInput = function() { /* "this" will be the slider */
this.rgltimer.value = Number(this.value);
this.rgltimer.Tick();
},
addSlider = function(min, max, step, value) {
var slider = document.createElement("input");
slider.type = "range";
slider.min = min;
slider.max = max;
slider.step = step;
slider.value = value;
slider.oninput = OnSliderInput;
slider.sliderActions = control.actions;
slider.sliderScene = this;
slider.className = "rgl-slider";
slider.id = el.id + "-slider";
el.rgltimer.Slider = slider;
slider.rgltimer = el.rgltimer;
el.appendChild(slider);
},
addLabel = function(labels, min, step, precision) {
var output = document.createElement("output");
output.sliderMin = min;
output.sliderStep = step;
output.outputPrecision = precision;
output.className = "rgl-label";
output.id = el.id + "-label";
el.rgltimer.Output = output;
el.rgltimer.outputLabels = labels;
el.appendChild(output);
},
addButton = function(which, label, active) {
var button = document.createElement("input"),
onclicks = {Reverse: function() { this.rgltimer.reverse();},
Play: function() { this.rgltimer.play();
this.value = this.rgltimer.enabled ? this.inactiveValue : this.activeValue; },
Slower: function() { this.rgltimer.slower(); },
Faster: function() { this.rgltimer.faster(); },
Reset: function() { this.rgltimer.reset(); },
Step:  function() { this.rgltimer.step(); }
};
button.rgltimer = el.rgltimer;
button.type = "button";
button.value = label;
button.activeValue = label;
button.inactiveValue = active;
if (which === "Play")
button.rgltimer.PlayButton = button;
button.onclick = onclicks[which];
button.className = "rgl-button";
button.id = el.id + "-" + which;
el.appendChild(button);
};
if (typeof control.reinit !== "undefined" && control.reinit !== null) {
control.actions.reinit = control.reinit;
}
el.rgltimer = new rgltimerClass(Tick, control.start, control.interval, control.stop,
control.step, control.value, control.rate, control.loop, control.actions);
for (var i=0; i < components.length; i++) {
switch(components[i]) {
case "Slider": addSlider(control.start, control.stop,
control.step, control.value);
break;
case "Label": addLabel(control.labels, control.start,
control.step, control.precision);
break;
default:
addButton(components[i], buttonLabels[i], control.pause);
}
}
el.rgltimer.Tick();
};
/**
* Apply all registered controls
* @param { Object } el - DOM element of the control
* @param { Object } x - List of actions to apply
* @param { boolean } [draw=true] - Whether to redraw after applying
*/
rglwidgetClass.prototype.applyControls = function(el, x, draw) {
var self = this, reinit = x.reinit, i, control, type;
for (i = 0; i < x.length; i++) {
control = x[i];
type = control.type;
self[type](el, control);
}
if (typeof reinit !== "undefined" && reinit !== null) {
reinit = [].concat(reinit);
for (i = 0; i < reinit.length; i++)
self.getObj(reinit[i]).initialized = false;
}
if (typeof draw === "undefined" || draw)
self.drawScene();
};
/**
* Handler for scene change
* @param { Object } message - What sort of scene change to do?
*/
rglwidgetClass.prototype.sceneChangeHandler = function(message) {
var self = document.getElementById(message.elementId).rglinstance,
objs = message.objects, mat = message.material,
root = message.rootSubscene,
initSubs = message.initSubscenes,
redraw = message.redrawScene,
skipRedraw = message.skipRedraw,
deletes, subs, allsubs = [], i,j;
if (typeof message.delete !== "undefined") {
deletes = [].concat(message.delete);
if (typeof message.delfromSubscenes !== "undefined")
subs = [].concat(message.delfromSubscenes);
else
subs = [];
for (i = 0; i < deletes.length; i++) {
for (j = 0; j < subs.length; j++) {
self.delFromSubscene(deletes[i], subs[j]);
}
delete self.scene.objects[deletes[i]];
}
}
if (typeof objs !== "undefined") {
Object.keys(objs).forEach(function(key){
key = parseInt(key, 10);
self.scene.objects[key] = objs[key];
self.initObj(key);
var obj = self.getObj(key),
subs = [].concat(obj.inSubscenes), k;
allsubs = allsubs.concat(subs);
for (k = 0; k < subs.length; k++)
self.addToSubscene(key, subs[k]);
});
}
if (typeof mat !== "undefined") {
self.scene.material = mat;
}
if (typeof root !== "undefined") {
self.scene.rootSubscene = root;
}
if (typeof initSubs !== "undefined")
allsubs = allsubs.concat(initSubs);
allsubs = self.unique(allsubs);
for (i = 0; i < allsubs.length; i++) {
self.initSubscene(allsubs[i]);
}
if (typeof skipRedraw !== "undefined") {
root = self.getObj(self.scene.rootSubscene);
root.par3d.skipRedraw = skipRedraw;
}
if (redraw)
self.drawScene();
};
/**
* Set mouse mode for a subscene
* @param { string } mode - name of mode
* @param { number } button - button number (1 to 3)
* @param { number } subscene - subscene id number
* @param { number } stayActive - if truthy, don't clear brush
*/
rglwidgetClass.prototype.setMouseMode = function(mode, button, subscene, stayActive) {
var sub = this.getObj(subscene),
which = ["left", "right", "middle"][button - 1];
if (!stayActive && sub.par3d.mouseMode[which] === "selecting")
this.clearBrush(null);
sub.par3d.mouseMode[which] = mode;
};
/**
* The class of an rgl timer object
* @class
*/
/**
* Construct an rgltimerClass object
* @constructor
* @param { function } Tick - action when timer fires
* @param { number } startTime - nominal start time in seconds
* @param { number } interval - seconds between updates
* @param { number } stopTime - nominal stop time in seconds
* @param { number } stepSize - nominal step size
* @param { number } value - current nominal time
* @param { number } rate - nominal units per second
* @param { string } loop - "none", "cycle" or "oscillate"
* @param { Object } actions - list of actions
*/
rgltimerClass = function(Tick, startTime, interval, stopTime, stepSize, value, rate, loop, actions) {
this.enabled = false;
this.timerId = 0;
/** nominal start time in seconds */
this.startTime = startTime;   
/** current nominal time */      
this.value = value;
/** seconds between updates */                 
this.interval = interval;
/** nominal stop time */           
this.stopTime = stopTime;
/** nominal step size */           
this.stepSize = stepSize;
/** nominal units per second */           
this.rate = rate;
/** "none", "cycle", or "oscillate" */                   
this.loop = loop;
/** real world start time */                   
this.realStart = undefined;
/** multiplier for fast-forward or reverse */         
this.multiplier = 1;                
this.actions = actions;
this.Tick = Tick;
};
/**
* Start playing timer object
*/
rgltimerClass.prototype.play = function() {
if (this.enabled) {
this.enabled = false;
window.clearInterval(this.timerId);
this.timerId = 0;
return;
}
var tick = function(self) {
var now = new Date();
self.value = self.multiplier*self.rate*(now - self.realStart)/1000 + self.startTime;
self.forceToRange();
if (typeof self.Tick !== "undefined") {
self.Tick(self.value);
}
};
this.realStart = new Date() - 1000*(this.value - this.startTime)/this.rate/this.multiplier;
this.timerId = window.setInterval(tick, 1000*this.interval, this);
this.enabled = true;
};
/**
* Force value into legal range
*/
rgltimerClass.prototype.forceToRange = function() {
if (this.value > this.stopTime + this.stepSize/2 || this.value < this.startTime - this.stepSize/2) {
if (!this.loop) {
this.reset();
} else {
var cycle = this.stopTime - this.startTime + this.stepSize,
newval = (this.value - this.startTime) % cycle + this.startTime;
if (newval < this.startTime) {
newval += cycle;
}
this.realStart += (this.value - newval)*1000/this.multiplier/this.rate;
this.value = newval;
}
}
};
/**
* Reset to start values
*/
rgltimerClass.prototype.reset = function() {
this.value = this.startTime;
this.newmultiplier(1);
if (typeof this.Tick !== "undefined") {
this.Tick(this.value);
}
if (this.enabled)
this.play();  /* really pause... */
if (typeof this.PlayButton !== "undefined")
this.PlayButton.value = "Play";
};
/**
* Increase the multiplier to play faster
*/
rgltimerClass.prototype.faster = function() {
this.newmultiplier(Math.SQRT2*this.multiplier);
};
/**
* Decrease the multiplier to play slower
*/
rgltimerClass.prototype.slower = function() {
this.newmultiplier(this.multiplier/Math.SQRT2);
};
/**
* Change sign of multiplier to reverse direction
*/
rgltimerClass.prototype.reverse = function() {
this.newmultiplier(-this.multiplier);
};
/**
* Set multiplier for play speed
* @param { number } newmult - new value
*/
rgltimerClass.prototype.newmultiplier = function(newmult) {
if (newmult != this.multiplier) {
this.realStart += 1000*(this.value - this.startTime)/this.rate*(1/this.multiplier - 1/newmult);
this.multiplier = newmult;
}
};
/**
* Take one step
*/
rgltimerClass.prototype.step = function() {
this.value += this.rate*this.multiplier;
this.forceToRange();
if (typeof this.Tick !== "undefined")
this.Tick(this.value);
};</script>
<div id="test_rgldiv" class="rglWebGL">

</div>
<script type="text/javascript">
var test_rgldiv = document.getElementById("test_rgldiv"),
test_rglrgl = new rglwidgetClass();
test_rgldiv.width = 673;
test_rgldiv.height = 481;
test_rglrgl.initialize(test_rgldiv,
{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0]},"rootSubscene":6,"objects":{"12":{"id":12,"type":"points","material":{"lit":false},"vertices":[[-3.430266,-0.06208087,-1.367599],[-2.965313,-0.2400698,-2.44689],[-2.81333,-1.680751,-1.867579],[-2.678034,-1.040702,-2.535108],[-2.59313,0.4120148,-2.790212],[-2.465379,-0.2159984,-1.571351],[-2.421834,0.6742376,-2.094495],[-2.420993,-0.208324,-3.053931],[-2.353649,0.2584596,-1.458603],[-2.314175,0.8924786,-2.887731],[-2.256985,0.523297,-2.5806],[-2.243011,-0.5658222,-2.235968],[-2.161623,1.727293,-2.694949],[-2.133198,0.1005037,-1.985752],[-2.091546,-0.1079827,-4.398158],[-2.074866,-0.141675,-1.656878],[-2.051368,-0.721173,-2.077949],[-2.02614,0.5328711,-1.820963],[-2.024508,1.719168,-0.5681292],[-2.013053,0.2047552,-1.071949],[-1.972895,0.7482236,-1.520122],[-1.95924,-1.755636,-1.459585],[-1.949688,-0.6125081,-1.872316],[-1.94447,-1.322155,-0.6218983],[-1.943324,-0.7169053,-3.554135],[-1.942334,0.5032384,-0.6958483],[-1.934815,-0.8552863,-2.678356],[-1.92661,0.2746427,-2.118984],[-1.925087,-0.2368197,-0.4901222],[-1.923534,0.5737676,-2.205272],[-1.905419,-0.9167286,-1.951153],[-1.903023,1.072333,0.6828278],[-1.891686,2.521243,0.3038288],[-1.881131,0.6617372,0.148056],[-1.877331,-1.329935,-3.27756],[-1.86937,-0.8583601,-2.269953],[-1.856699,0.1519904,-0.9788154],[-1.848188,1.9647,-0.6474549],[-1.826992,-0.2727906,-0.7022043],[-1.823783,-0.5889589,-0.9523736],[-1.818643,0.5138894,-3.62577],[-1.818282,0.2704024,-0.5826997],[-1.815092,1.13061,0.01253385],[-1.810286,-0.8421708,-2.723847],[-1.798523,0.1570448,-2.740855],[-1.773178,2.898828,-0.3761543],[-1.757164,0.8916828,-0.6241761],[-1.72019,-0.08708315,-2.226645],[-1.695932,-0.3513213,-3.083985],[-1.691137,0.7183257,1.275954],[-1.665217,1.386814,-0.5434195],[-1.652469,0.2040517,-0.857475],[-1.648079,-1.975414,-3.494568],[-1.646918,-0.3767506,-1.517274],[-1.633991,-0.4796956,-3.587699],[-1.63092,1.104289,0.1072571],[-1.602237,1.264652,-2.003805],[-1.575046,-0.7297022,-2.570374],[-1.573269,0.6589597,-0.3417276],[-1.527913,1.498371,-0.1785654],[-1.517846,1.561548,1.120368],[-1.517563,-0.1210821,-2.006527],[-1.503656,-1.936386,-3.245119],[-1.496259,0.9046678,0.5868097],[-1.494243,-0.4592916,-1.154459],[-1.49254,1.432491,0.3826298],[-1.459884,-0.8505951,-2.719808],[-1.452943,1.694987,0.8020452],[-1.451248,-1.806844,-1.562634],[-1.433535,-0.9960054,-2.107917],[-1.426742,-0.7484679,-2.729467],[-1.419372,0.5871084,-1.314632],[-1.417716,0.8916292,-2.337762],[-1.415827,-1.535379,-2.070408],[-1.398575,0.6936552,0.4344941],[-1.398317,0.4669322,-0.9908715],[-1.383106,-0.2613102,-1.164848],[-1.380512,1.73158,-1.163733],[-1.379814,0.5391936,0.2877702],[-1.371156,-0.5377445,-0.5331261],[-1.37114,1.205453,-1.574611],[-1.365206,-0.8536597,-4.176567],[-1.358279,0.5901666,-1.199869],[-1.350651,1.243408,-1.736168],[-1.350572,1.158061,-2.837159],[-1.346473,-0.6486847,-1.024904],[-1.339271,0.9393293,-0.02090497],[-1.335818,-0.8315604,-0.6534641],[-1.330665,-1.33753,-3.184951],[-1.323939,0.5572384,-2.076559],[-1.308067,-0.8935457,-3.334425],[-1.306105,0.325996,-0.3544344],[-1.30151,-0.575056,-2.548134],[-1.296353,-1.82346,-2.473866],[-1.293398,0.01388549,-1.151876],[-1.282541,0.6225333,0.1973933],[-1.277446,0.5918726,0.4392659],[-1.256911,0.3441363,-1.413595],[-1.24736,1.212749,-1.111649],[-1.245067,1.286909,-1.142314],[-1.239672,-0.1417689,-0.8835487],[-1.238535,0.5923117,-1.944285],[-1.237037,0.7197886,-3.136255],[-1.23683,-1.075444,-3.156616],[-1.228815,1.624723,-0.6662614],[-1.212616,-0.6580726,-2.57329],[-1.208192,-0.1004098,-0.876932],[-1.206498,0.9284155,0.3479398],[-1.191216,-1.131158,-2.657994],[-1.181986,-0.08584738,-1.9426],[-1.181674,1.09306,-1.18735],[-1.178912,-1.879634,-2.410755],[-1.17548,-0.2895422,-2.364648],[-1.17394,0.9693495,-2.606023],[-1.16915,0.2000881,-0.9407827],[-1.16911,0.1594325,-2.182078],[-1.166215,1.436011,-1.414653],[-1.166096,1.387758,-1.307391],[-1.161214,1.211669,0.1087584],[-1.158397,0.4888137,-2.207022],[-1.155079,0.2835923,-1.092256],[-1.154621,-1.303757,-2.831529],[-1.147364,-0.1425894,-1.201009],[-1.141221,-0.09902874,0.3126068],[-1.140667,-0.7771702,-0.9637602],[-1.140462,0.6725708,0.1177827],[-1.12088,-1.333164,-1.035761],[-1.10682,-0.1378368,-1.344273],[-1.103898,0.772235,-1.631145],[-1.099963,0.889708,-1.665512],[-1.097027,2.115566,-1.620258],[-1.096767,-0.5435697,-0.7281437],[-1.096009,-0.4978397,-1.942901],[-1.094213,-0.04380738,-2.665719],[-1.08344,-0.8891439,-1.026355],[-1.068978,0.9148883,-1.941738],[-1.067184,-0.8085398,-3.012697],[-1.055101,-1.146504,-3.647723],[-1.051911,2.116014,-0.8324749],[-1.050387,-0.6036924,-2.294699],[-1.047895,-0.1953209,-0.8618653],[-1.046684,-0.5698146,-2.724695],[-1.046108,0.7120529,-1.947096],[-1.041827,-1.220868,-2.488542],[-1.040553,0.9303113,1.21676],[-1.040101,0.1550755,-1.451934],[-1.033562,1.564617,-2.208314],[-1.027779,0.1034637,-1.700704],[-1.025817,-0.1022732,-0.9821081],[-1.01444,0.6321303,-1.292112],[-1.013064,0.03205326,-1.221352],[-1.005146,0.7200023,-0.7171908],[-1.004594,1.055012,-0.6569414],[-1.004325,-1.147257,-1.692877],[-1.002402,1.262697,1.090286],[-1.001993,-0.09215532,-0.7402938],[-1.000761,0.7033727,0.1065474],[-0.9929116,0.1551075,-1.970783],[-0.988663,0.4482353,-1.591928],[-0.9834996,-1.168343,-2.938586],[-0.9816212,1.258592,0.7492694],[-0.9773625,-0.584657,-1.231832],[-0.9764533,-2.015844,-2.335765],[-0.9755627,0.1694585,-2.852984],[-0.9754102,1.913462,0.5043523],[-0.974592,-0.04271764,-2.165049],[-0.9697078,1.173818,-1.875201],[-0.9650027,0.3868665,1.055961],[-0.9626284,-0.7597101,-0.4540013],[-0.957845,0.4590524,-1.568138],[-0.9572635,0.5387421,-2.326384],[-0.9550359,-0.1614573,-1.053738],[-0.9541495,-1.766468,-3.720844],[-0.952315,-0.6269928,-1.609388],[-0.9506255,-0.5884481,-2.181035],[-0.9504598,-0.4050855,-2.328032],[-0.9168113,1.023878,-0.01529007],[-0.9159968,1.662852,-3.352121],[-0.903281,-0.7306993,-1.420994],[-0.8945284,0.3553716,-3.308629],[-0.8936105,0.1469491,-2.046373],[-0.8925446,-1.149492,-3.527181],[-0.8844228,-0.1038833,0.2689202],[-0.8826213,0.9189862,-0.4573929],[-0.8823706,-1.195835,-1.525376],[-0.8821354,-0.1613239,-1.538044],[-0.8797454,-0.295604,-2.217002],[-0.878584,-0.5193238,-1.898284],[-0.874139,0.6006062,-3.023104],[-0.8728682,-0.06473826,-0.7973449],[-0.8701146,0.4628576,-1.269212],[-0.8696138,0.06441593,0.3977431],[-0.8627803,0.2706268,-0.2254025],[-0.8611564,-1.056678,-2.670703],[-0.8603305,0.4176492,-0.9981925],[-0.8538814,-1.664255,-2.193958],[-0.8427652,0.2782963,-1.963209],[-0.8413599,0.3971571,-2.269428],[-0.8397132,1.842826,-0.9428912],[-0.8386379,-0.3624752,-1.84015],[-0.8293734,-1.530667,-3.803658],[-0.8273323,-1.205858,-2.281495],[-0.8238564,-1.480042,-3.293898],[-0.8195233,-0.174458,-0.7646892],[-0.8113319,0.3923138,-1.830981],[-0.8069111,0.5263323,-1.010667],[-0.8058372,0.8383406,-1.035268],[-0.8039763,-1.149278,-2.67463],[-0.7984005,1.184164,-0.3308493],[-0.7960255,0.4031757,-0.5911524],[-0.7957205,0.2528179,-1.831555],[-0.7944168,1.686758,-1.404288],[-0.790801,1.49846,-0.516062],[-0.7902594,0.56782,0.2033143],[-0.784587,-0.2525012,-2.222166],[-0.7815914,0.05557635,-0.9193875],[-0.771381,0.8619779,-0.9383897],[-0.7706022,-0.2117444,-0.6756939],[-0.77041,-0.07893794,-1.662876],[-0.7684408,-0.3292137,-2.669175],[-0.7658461,-0.2177359,-2.64916],[-0.7623037,1.221819,-0.4020347],[-0.7599059,0.6972113,-1.048984],[-0.7543738,0.5728906,-0.9940112],[-0.753679,-1.74577,-3.265171],[-0.753221,-0.2539601,-3.32867],[-0.7502,0.9491156,-2.30862],[-0.7484325,-0.8889467,-3.041666],[-0.7471387,1.72019,-0.05237993],[-0.7440474,0.3224938,-1.537137],[-0.7366607,0.04832927,-1.79029],[-0.7350253,-2.228298,-2.962203],[-0.7337605,-0.6307892,-1.623056],[-0.7335055,0.623126,0.03328534],[-0.7265296,1.458328,0.3757586],[-0.7258289,-1.670985,-3.450368],[-0.7147773,-0.07166079,-0.2750503],[-0.7136001,1.909625,-0.3716336],[-0.7088855,-0.4074726,-3.471782],[-0.7083501,0.1889762,-1.841349],[-0.7059327,-0.3761328,-2.421081],[-0.705726,-0.3488126,-2.609745],[-0.6978529,-0.2078413,-2.496171],[-0.6964902,1.421375,0.3014753],[-0.6955284,0.742105,-2.023517],[-0.6954817,-0.7494026,-2.323404],[-0.6940888,0.4639053,-2.510407],[-0.6917174,1.620435,-1.116132],[-0.6800228,0.5172206,-0.8557283],[-0.6775395,0.06411681,-3.623726],[-0.6746665,-0.5281012,-2.237156],[-0.6729486,0.07214002,-0.6366047],[-0.672317,0.7637438,-0.551743],[-0.6694363,0.1366228,-3.646103],[-0.6687784,-1.094223,-2.583916],[-0.666711,-0.3550499,-2.895789],[-0.6566425,-0.01485349,-3.632627],[-0.6549761,-0.6069052,-3.343289],[-0.6548411,0.002604696,-0.3552433],[-0.6540896,0.2919414,-1.703528],[-0.6510729,-0.7219803,-3.37613],[-0.648957,0.3743511,-0.8088003],[-0.6474634,-1.843716,-2.194952],[-0.6454484,2.803949,1.756962],[-0.6452881,0.8140532,0.1843648],[-0.6402779,-1.295576,-2.150549],[-0.6374859,0.3023479,-1.122058],[-0.6342519,0.09037763,-2.2183],[-0.6313758,0.1316174,-0.2383467],[-0.6268631,0.7330947,-0.825496],[-0.6202136,-0.7257982,-2.253073],[-0.6186931,-0.06473324,-1.282213],[-0.6186898,0.9757673,-0.4244943],[-0.6184608,-0.7774969,-3.421691],[-0.6167386,0.1584104,-2.824488],[-0.6103962,0.3537945,-2.508452],[-0.6080205,-0.1382768,-1.428533],[-0.6039968,2.260974,0.2440929],[-0.6036725,0.304364,-2.676794],[-0.601129,-0.02152495,-0.5611544],[-0.5949549,1.956114,-0.3178346],[-0.5922746,1.722074,0.2759354],[-0.5918425,0.4889716,-0.05941261],[-0.5910187,0.198333,-3.113183],[-0.5895868,-0.08304691,-0.08158311],[-0.588039,0.3849654,-0.9249447],[-0.5878878,3.103662,-0.4676295],[-0.5878578,1.639263,-0.6493829],[-0.5859952,-0.5040535,-2.749205],[-0.5740461,0.07648262,-0.2930773],[-0.5718399,-0.9667246,-1.641168],[-0.5716906,-1.325239,-2.328049],[-0.5694991,1.639271,0.8742266],[-0.5688646,-0.4112628,-1.641333],[-0.5684208,-0.3311903,-3.284049],[-0.5682326,-0.9470888,-4.218898],[-0.5665176,-0.9163972,-2.772768],[-0.5642351,0.9684892,-1.830277],[-0.5642132,-0.842895,-0.5157227],[-0.5612002,-0.5301639,-2.848215],[-0.5606887,-0.4086809,-0.6768146],[-0.5594237,0.9924819,-0.6382696],[-0.5527692,-0.5633311,-2.004621],[-0.5527585,-0.7137995,-3.093591],[-0.5519165,1.445966,0.4217893],[-0.55186,-1.31714,-2.460649],[-0.5506748,0.5345651,-1.466757],[-0.5503614,0.8246318,-0.06919362],[-0.5460765,0.3144429,-1.06059],[-0.5414662,-0.7278218,-2.24093],[-0.5395633,0.693276,-1.302357],[-0.5360637,-0.2373747,-1.629815],[-0.5353168,-0.9933812,-3.774341],[-0.5341086,-0.6596985,-0.970637],[-0.5316961,-0.6933125,-3.007642],[-0.5312359,-0.03698394,-2.02283],[-0.5261211,-0.009833041,-2.701671],[-0.5241584,0.7968829,-0.227144],[-0.5177234,-0.5083842,-4.248968],[-0.5128207,1.314098,-0.3486445],[-0.5124614,-2.925297,-3.163824],[-0.509342,0.003915304,-2.083642],[-0.5062361,0.09751733,-1.758136],[-0.5052918,0.7886764,-1.513908],[-0.5033786,-0.2725985,-2.605887],[-0.4980309,-0.1876334,-3.178236],[-0.4959854,0.8159986,0.6157683],[-0.4943052,0.01220305,-3.206109],[-0.4928288,-1.121657,-3.138516],[-0.4861276,-1.602605,-2.510879],[-0.4820528,0.1491391,-2.962063],[-0.4765006,0.8114458,-1.832971],[-0.4748203,0.1655305,-0.341352],[-0.4678332,0.3859219,0.6179838],[-0.4677048,-1.546666,-2.76788],[-0.4668493,0.409974,-1.212793],[-0.4656619,-0.2955124,-1.836399],[-0.4632095,0.8326523,-2.009941],[-0.4628891,0.6962999,-2.121995],[-0.4614094,1.08018,-0.7304242],[-0.4587147,0.4191531,-0.5357405],[-0.4581185,-0.6339457,-3.010324],[-0.4574916,-0.8668846,-3.335918],[-0.4563054,0.6652006,-0.6223998],[-0.4446505,1.939872,-0.3182269],[-0.4444736,-1.371324,-1.46219],[-0.4389357,1.250948,-1.839776],[-0.4386396,1.275002,-1.308923],[-0.4351263,-0.9074901,-1.542326],[-0.4345822,-1.536064,-3.714015],[-0.4252658,1.269127,-0.531578],[-0.4200301,0.3419257,-1.151402],[-0.4125266,1.222009,0.8024089],[-0.411279,1.052826,-2.61209],[-0.4073955,-0.6360655,-2.711872],[-0.4054509,1.496886,0.7982383],[-0.4022615,0.1956737,-1.323375],[-0.401341,-0.8087542,-2.960673],[-0.4002971,0.2006165,-1.893871],[-0.3947568,2.486854,-1.88092],[-0.3909384,0.05181213,-2.474942],[-0.3850096,-0.3015475,-2.237618],[-0.3845039,-0.730149,-2.023491],[-0.3769771,1.175248,0.4963773],[-0.3740873,1.448973,-0.6258604],[-0.3740826,0.3672451,-0.725526],[-0.3656657,-0.4297356,-2.03742],[-0.3587406,-0.2456293,-2.242097],[-0.3537839,-0.2247003,-1.78295],[-0.3528889,1.008612,-0.3012984],[-0.3506142,-0.003014438,-0.6800546],[-0.3473161,-1.081952,-1.924284],[-0.3434919,-1.268584,-3.212729],[-0.3416292,-2.540504,-1.869317],[-0.340194,0.6413335,-1.513047],[-0.3358719,-0.3415599,-1.937504],[-0.3358027,0.4900296,-0.9468794],[-0.334796,0.9103344,-2.712511],[-0.3322056,2.13786,0.5902542],[-0.328509,1.187783,-0.7811227],[-0.3190792,-0.654352,-2.636674],[-0.3176073,-0.4896755,-4.146187],[-0.3174753,-0.007530609,-1.430999],[-0.3153859,0.6962882,0.8348392],[-0.3148918,0.4402868,-0.792386],[-0.3111715,-1.21341,-2.64282],[-0.3093434,0.5374351,0.8034161],[-0.3091631,-1.24479,-2.466709],[-0.3051369,-1.206432,-1.726702],[-0.3042652,0.4292181,0.7461908],[-0.3015267,2.148962,1.923155],[-0.2950801,-1.303485,-4.631298],[-0.2928111,0.3387792,-0.4061856],[-0.2903627,0.1788777,0.01007354],[-0.2889952,-2.314348,-1.083452],[-0.2881359,0.5178228,0.9623772],[-0.2855092,0.4544616,0.7117652],[-0.2801378,-1.386719,-2.030464],[-0.2800028,0.128439,-1.787363],[-0.2773931,0.58812,-0.9240071],[-0.2735021,0.0643152,0.5632451],[-0.2729017,0.5028672,-1.32728],[-0.2715191,-1.133503,-4.25919],[-0.2698835,-0.609953,-2.015647],[-0.2644694,-0.7051808,-2.038082],[-0.2585016,-0.01877365,-1.794898],[-0.2576067,-0.2325624,-1.075759],[-0.252229,-0.2142215,-2.452765],[-0.2522216,1.447165,-2.242254],[-0.2493297,-0.1005597,-1.984515],[-0.2486236,-0.8059807,-2.274063],[-0.2479392,-0.36827,-1.619665],[-0.2437172,-0.9366058,-1.662548],[-0.2429892,1.409937,-2.309394],[-0.2410239,1.366523,-1.294323],[-0.2403878,-0.7038575,-3.770184],[-0.239145,0.1785506,0.597448],[-0.2349001,-1.178378,-0.4331521],[-0.2322931,-0.6300119,-2.372942],[-0.2238641,0.405842,1.935438],[-0.223517,-0.3092742,-1.714227],[-0.221639,1.071941,-1.039615],[-0.219652,0.3479766,2.375196],[-0.2196357,1.004444,-1.979066],[-0.2189065,1.030488,-1.043434],[-0.2142391,0.8751574,-1.34646],[-0.2124936,0.02485366,-1.625316],[-0.2099908,0.7829719,1.432187],[-0.2089089,-0.3327002,-2.469647],[-0.2079275,-0.1060576,-3.719195],[-0.2055983,-0.01708823,-0.3988008],[-0.2042099,0.6828275,0.7974436],[-0.2038526,-0.8083296,-2.417032],[-0.2025199,0.2028022,-0.6708514],[-0.2021614,1.614124,0.7407615],[-0.1989468,-0.9988651,-2.919979],[-0.1963927,0.06602219,-1.551218],[-0.194645,0.6250163,-0.9894196],[-0.192576,0.6921297,0.4774087],[-0.1910858,-0.1705846,-2.116623],[-0.1906553,-0.06672458,-2.632374],[-0.1890392,-0.2893114,-2.49276],[-0.185334,-0.1195784,-1.670697],[-0.1816814,1.667338,0.6319709],[-0.1800644,0.6040888,-1.991832],[-0.179839,-0.6934605,-4.075515],[-0.1760055,-1.582543,-4.676388],[-0.1748661,-1.053803,-1.981602],[-0.1736452,-1.215094,-0.4825405],[-0.1724582,-0.1468649,-3.606677],[-0.1720935,-0.4040823,-3.934415],[-0.1714553,-0.4781603,-2.993188],[-0.1677132,-0.1514182,-0.9650946],[-0.1579672,-0.209794,-3.369425],[-0.1574252,1.006846,-1.11271],[-0.1571319,-0.6289902,-2.448042],[-0.1560094,0.01278148,-0.4771135],[-0.1537635,0.1087775,0.09425288],[-0.1430617,-0.2990657,-0.6549532],[-0.1401787,-1.670301,-2.97586],[-0.1396181,0.1038655,-0.509684],[-0.1377426,-1.094112,-3.694582],[-0.1358579,0.1156225,0.6311448],[-0.13451,0.3121611,-0.5426739],[-0.1330732,-0.9670658,-2.8271],[-0.1277657,1.137751,-0.5203407],[-0.1255133,-0.2635553,-2.354475],[-0.1232467,0.104546,-1.419751],[-0.1174543,0.7075523,2.533155],[-0.1136206,0.6691267,-0.6865494],[-0.1132832,-0.5042155,-2.436143],[-0.11142,0.05248046,-1.010777],[-0.1077885,0.3412353,-0.6440372],[-0.1068169,-0.653293,-2.968642],[-0.1027878,0.3396051,0.4620987],[-0.09960935,-1.711499,-1.624738],[-0.09673197,0.823669,1.194021],[-0.09493424,-1.976377,-2.537573],[-0.09200352,-0.05396417,-2.695805],[-0.08805396,-1.796418,-2.574766],[-0.08798315,0.6774786,0.7789865],[-0.0867155,0.3418036,0.06093908],[-0.08199269,0.146508,-2.383236],[-0.08180112,-1.31459,-2.802478],[-0.08170763,0.3268913,-2.284367],[-0.08121398,2.238406,0.2294811],[-0.07625585,0.9933434,0.8286999],[-0.07604507,-0.1577198,-5.23838],[-0.07140767,-0.2456566,-3.119783],[-0.0704199,1.496543,-0.9118824],[-0.06976946,0.4698281,-0.2945938],[-0.06748924,1.198769,-0.8771542],[-0.06746098,-0.7663106,-3.193804],[-0.06724953,-0.06121274,-2.068562],[-0.06566603,-0.0969739,-3.010874],[-0.06475075,0.03747734,-2.240826],[-0.06406893,-0.9353258,-2.348583],[-0.06267726,-1.55319,-2.343854],[-0.05945646,-0.4482551,-2.633554],[-0.05535819,0.9142553,-0.09389652],[-0.04991045,0.736325,0.6124374],[-0.04805349,1.874342,-1.43618],[-0.04417768,0.8023437,0.9093336],[-0.03884257,-0.1091575,-2.731261],[-0.03311035,-0.5543477,-2.794361],[-0.03228591,1.520618,-0.5213931],[-0.03190583,0.5544455,0.6669514],[-0.03153875,0.8255929,-0.5629947],[-0.03148077,0.6192452,-0.6488079],[-0.02941097,0.8663306,0.4055608],[-0.02823553,0.116844,0.007806055],[-0.0243708,-0.1122262,-2.62043],[-0.01800991,0.8214522,1.410606],[-0.01646608,2.012103,0.7467295],[-0.01516046,-1.080328,-3.713778],[-0.01128615,-0.9325967,-1.432196],[-0.003149398,-0.6420618,-3.968605],[-0.00149423,-0.4785102,-2.819244],[0.006827426,0.6672336,0.266915],[0.008473998,0.5412562,0.0321281],[0.009888482,-0.01313371,2.189278],[0.01063581,0.1385048,0.1195143],[0.01249648,0.0223479,-0.0529018],[0.01267634,-0.5888854,2.115286],[0.01513833,1.380245,-0.9853012],[0.02025563,0.08174855,-0.1168125],[0.02193361,-0.5293702,0.932822],[0.03062946,-0.2174884,2.622383],[0.03139034,-0.1388178,1.600153],[0.0319917,-0.5092899,1.766877],[0.03313202,-0.3983775,2.608201],[0.03379167,-0.42616,2.552446],[0.03552095,0.4952091,-1.596389],[0.03660252,0.6710069,-0.1777451],[0.0399432,0.1776091,0.1034053],[0.04229085,-1.173695,3.709227],[0.04649585,-1.146996,0.9437875],[0.04781209,-1.146054,3.075826],[0.05029725,-0.2617847,2.071712],[0.0520993,0.5722958,0.7010817],[0.05841039,1.538236,0.6979063],[0.06233424,-1.550083,3.754189],[0.06247605,-0.2974037,2.946611],[0.06626097,0.4014599,0.07472286],[0.0694616,-1.503848,1.210832],[0.07002768,-1.698748,3.69288],[0.0720766,-1.182664,4.085686],[0.07452999,-0.1764201,3.76736],[0.07520809,-2.024065,2.312454],[0.07864664,0.1166825,1.775927],[0.08054062,-0.652904,2.996625],[0.08223568,0.106668,-0.7036827],[0.08226781,0.1350483,1.195508],[0.08253415,0.3483532,-0.9684842],[0.08443217,0.08974735,0.3258187],[0.08988303,1.366149,-1.233164],[0.09056038,-0.8565867,1.285907],[0.09296627,-0.1548162,1.710879],[0.09330047,-1.599599,2.912462],[0.09645657,0.3383542,1.609382],[0.09743035,-1.356396,1.642196],[0.1006623,-0.8462107,2.564183],[0.1032336,1.421398,-0.6684071],[0.1075693,-0.2217123,2.623508],[0.1127763,1.353922,-0.3288769],[0.1128159,0.1860119,0.1908803],[0.1131843,1.007092,1.077798],[0.1153584,-0.4497807,2.487831],[0.1158735,0.9995368,0.953062],[0.1165367,-1.342688,2.404952],[0.122074,1.200469,1.479066],[0.1230011,-0.1338416,2.858217],[0.1278708,-0.4656257,3.878862],[0.1319293,0.7286666,0.108001],[0.1337394,1.050504,0.174198],[0.1345109,-0.1613803,1.280053],[0.1347924,0.7778521,-0.2130738],[0.1396866,-0.03449942,2.509565],[0.1430803,-2.117127,3.229611],[0.1473662,0.9596918,0.0001214175],[0.1492129,0.9818644,0.3451586],[0.1523053,-1.133652,2.308748],[0.1626777,1.279994,0.9288715],[0.1725165,-1.1914,2.193072],[0.1737457,-1.370453,2.659897],[0.1750803,1.081112,0.570251],[0.1766661,-0.1500287,1.454911],[0.1787426,0.6649355,0.2033902],[0.1788443,2.067155,-1.62152],[0.1789144,1.13235,-0.5439209],[0.1815079,1.515999,0.9952847],[0.1815284,0.5499438,1.066263],[0.1830228,0.8570198,-0.9507496],[0.1835567,1.863263,1.538586],[0.1876998,-1.805754,3.984128],[0.1899263,-0.4939836,2.304983],[0.1928041,-0.007366986,1.746463],[0.2000726,1.441008,-2.079096],[0.2036594,-0.9763479,2.812958],[0.2110087,0.8266068,0.7603397],[0.2119434,1.061304,1.128921],[0.2126235,-0.07816298,1.643099],[0.2160528,2.012263,-0.942973],[0.2227708,0.3284715,0.8892276],[0.2238826,-0.7592114,4.437776],[0.2242158,0.153631,0.14649],[0.2253417,2.882386,0.5500785],[0.2334551,0.06758313,1.857441],[0.2348191,-2.216815,2.163787],[0.2351768,-1.041771,3.213814],[0.2368425,-0.6132454,3.94585],[0.2396551,-1.101504,3.471947],[0.2410707,-1.17143,3.213699],[0.2411938,0.8127118,0.5091293],[0.2420337,-1.059701,3.693218],[0.2425112,0.4462846,0.3169352],[0.2432398,-2.77241,3.404158],[0.243683,0.5067416,1.85204],[0.248153,-0.8767046,3.867245],[0.2527593,-0.07253909,1.739399],[0.2589411,-0.3477653,0.3446407],[0.2606219,-0.4899484,2.559835],[0.261734,1.506526,1.003645],[0.2656366,0.05608952,2.801244],[0.2748773,0.497283,-1.136451],[0.2793262,-0.8915093,2.647768],[0.2884228,1.662304,-0.1050545],[0.2889444,-1.187653,3.741319],[0.2995535,-0.2539399,1.632059],[0.3024145,0.2668342,0.2360478],[0.3151344,1.510399,1.095489],[0.3166898,0.3702813,0.385507],[0.3168157,-0.7409312,2.782765],[0.3200834,-1.651427,1.376502],[0.3225709,1.106523,0.5057447],[0.3226523,-0.1721255,1.28304],[0.3233976,0.8104631,1.431712],[0.3235866,0.9749462,0.6173211],[0.3286749,0.4643942,0.8105513],[0.3289162,-0.3043135,2.844264],[0.3312175,1.463534,-0.8301763],[0.3332443,0.1627131,1.852985],[0.3360664,0.6220362,0.5424738],[0.3374374,-1.81866,3.878933],[0.3377022,-0.5670134,2.781746],[0.3379823,0.3132719,1.704674],[0.3422684,-1.13747,1.88527],[0.3424715,-0.933201,1.804175],[0.3439874,0.4868895,1.302039],[0.3551738,0.4680077,0.7526403],[0.3600636,0.02849813,0.8788456],[0.3609925,-1.453246,2.987059],[0.3615133,-0.6405774,2.647264],[0.3700261,1.31734,0.08053455],[0.3705011,1.976718,-0.1776901],[0.3719158,0.5059171,0.7501435],[0.3740197,-0.3267063,3.455528],[0.3780777,0.7100343,0.28483],[0.3786327,-0.3952789,1.944148],[0.3795094,0.2343618,1.399955],[0.3801517,-0.8030277,2.691845],[0.3808093,1.889055,1.356929],[0.387206,-0.03142021,2.243541],[0.3937359,2.243813,-0.1951223],[0.3962667,-0.6026197,2.853893],[0.3962718,-0.06142782,2.162777],[0.3976056,0.7655652,0.6966414],[0.4057743,-0.7751123,3.404876],[0.4114834,-0.4654181,2.736432],[0.411502,0.8806795,-1.148977],[0.4181887,1.416042,0.000349885],[0.4201821,-0.1981424,3.117025],[0.4241619,-0.0172708,2.948697],[0.4266952,0.7071372,0.6311548],[0.4282067,-0.6310399,3.494996],[0.4320581,-0.7810132,3.331922],[0.4325489,0.5582695,2.687428],[0.4328216,-1.722093,3.666633],[0.4359596,0.4797246,1.932378],[0.4376372,-1.905223,0.8117976],[0.4384452,-1.022361,1.235359],[0.4431027,0.435971,0.3884442],[0.4436415,-0.545859,2.453298],[0.4451795,1.398747,2.024466],[0.4487985,-0.7675027,4.110855],[0.4508762,-0.8248122,3.666399],[0.4603885,0.3285792,-0.4246856],[0.4606157,-1.223349,3.239428],[0.4609788,-1.382776,2.369236],[0.4624778,0.2711449,1.918943],[0.4627277,0.4359025,1.822241],[0.463897,0.2137662,1.114224],[0.4641786,0.4374901,2.138841],[0.4710271,0.2592365,1.508318],[0.4779215,0.974049,0.1754041],[0.4830838,-0.4326708,2.218012],[0.4853568,-0.9686957,1.911112],[0.4942718,-1.805563,1.615579],[0.4945547,-0.4892878,4.478043],[0.4954009,0.1945782,1.540497],[0.4971487,1.205345,1.69917],[0.4995697,1.395993,1.043703],[0.5000066,-0.2628614,1.967492],[0.5026942,-0.7221063,3.111398],[0.5093024,-0.06829438,2.41384],[0.513834,-0.5079234,3.430927],[0.5198789,3.245267,0.8537966],[0.520256,-1.692691,1.740074],[0.5214225,0.2729191,2.657267],[0.5277786,-1.680609,1.857611],[0.5297205,0.3943833,-0.1663658],[0.5379191,-0.1703212,2.380933],[0.5400298,0.1560329,1.340541],[0.5401537,0.6512736,-0.03198026],[0.5437012,0.9875979,1.608889],[0.545517,1.708186,-1.557542],[0.5517418,1.106694,0.3033873],[0.5521603,0.2068988,0.4654556],[0.555272,-0.140886,2.724774],[0.5552737,-1.697809,1.985451],[0.5572217,-0.5349567,2.257818],[0.5589973,-0.932143,3.628907],[0.5603966,-0.8373314,2.681431],[0.5644156,0.4664415,0.9877619],[0.5646884,0.06399992,1.261121],[0.5760453,0.857134,0.7963274],[0.5779908,-0.1171875,1.69184],[0.5809137,1.330868,0.9230492],[0.5823154,0.6480892,1.149893],[0.5830634,-0.1454929,3.219177],[0.5852167,-0.7463663,1.828395],[0.5871943,0.3735091,2.651537],[0.5884489,-0.8417689,2.981113],[0.5925131,1.503799,-1.232857],[0.5971642,1.562265,1.163672],[0.5982954,-0.9150296,2.167591],[0.5989614,-2.056856,3.285443],[0.5996484,0.7989349,1.40625],[0.5999615,0.8911638,0.1952752],[0.6010513,0.1820024,-0.3442453],[0.6024558,0.6804361,0.2967384],[0.6027642,-1.563284,4.012374],[0.6054304,0.2598115,1.443685],[0.6123897,0.3488096,1.942253],[0.6136559,0.3972707,1.342707],[0.6197824,1.668451,1.160346],[0.6239954,-0.6737487,0.2249852],[0.6377494,0.8999559,0.1655974],[0.6402541,0.02632717,1.97535],[0.6426758,-0.3051963,2.800416],[0.6431116,1.764861,0.551028],[0.6495633,0.3557404,0.3291159],[0.6577637,-0.6752538,3.081458],[0.6593841,-0.3246848,1.860661],[0.6601861,-0.4931428,1.135561],[0.6616521,1.18839,1.644331],[0.6620438,1.074962,-1.384987],[0.6821615,-0.000678002,2.636683],[0.6839614,-0.04055013,1.725941],[0.6894476,0.2149427,-0.01192862],[0.6949404,0.5229678,2.497046],[0.6986848,-0.4980376,2.825442],[0.6990259,-0.5643375,2.012592],[0.6991893,0.6202146,1.46107],[0.6993843,1.544663,0.8127785],[0.7005457,-0.4277453,2.573062],[0.7017965,-0.05072716,2.005739],[0.7059688,0.1958601,-0.5498515],[0.7063074,0.3483331,1.531156],[0.7063686,-0.401193,1.481672],[0.7103107,0.6155592,-0.08602598],[0.7149282,-0.3669503,1.950617],[0.7190644,-1.239995,1.898843],[0.7191675,0.879049,0.7793949],[0.7194116,0.7379259,0.1561265],[0.7217926,0.5441824,0.285165],[0.7228826,-0.09558261,2.632174],[0.7257633,0.2328128,1.352542],[0.7258689,-0.7180513,2.608454],[0.7265937,-0.727482,1.286657],[0.7330509,1.237069,0.6069199],[0.7333179,1.212949,1.072331],[0.7346393,-0.1016208,0.04196617],[0.7349942,-0.973181,4.279972],[0.7447948,-0.6682532,4.47421],[0.7474535,0.6221689,2.029777],[0.750101,0.03349687,1.29739],[0.7566806,1.51636,0.4575816],[0.762942,-0.218723,3.013749],[0.7657378,2.233111,0.9336308],[0.7663633,0.520906,3.336464],[0.7730812,1.037943,-0.1042973],[0.7756775,1.141181,0.7322435],[0.7794299,2.073365,1.234751],[0.7796202,-0.5780759,2.099144],[0.7816036,-0.7435136,3.899716],[0.7837616,-1.134009,4.247684],[0.794677,-1.73237,2.740359],[0.795813,0.1868927,2.712033],[0.7984712,0.204423,1.169865],[0.8088055,1.69869,1.599823],[0.8102605,0.9114573,0.2768875],[0.8125783,0.8396067,0.5344508],[0.8137961,-1.05725,3.94931],[0.8154704,-0.6849446,0.5145255],[0.8165911,-0.2895471,4.691998],[0.8181116,0.06720286,1.296348],[0.8192981,-0.3252729,2.056689],[0.8227955,0.03979221,1.083273],[0.8307799,-0.1627385,3.608315],[0.8332883,-1.214122,1.372455],[0.842678,0.2784941,2.043195],[0.8440117,1.048427,0.9087468],[0.8443754,-1.693075,3.541551],[0.8444175,-0.09421245,1.267051],[0.8540797,0.3679321,0.9170827],[0.8559347,-1.252325,2.649883],[0.858266,-0.6465485,3.280253],[0.858866,-0.1883112,2.555876],[0.8595388,-0.499197,2.512358],[0.8646113,0.411231,2.469294],[0.8718986,-0.6249118,2.629755],[0.874024,-0.5526579,0.9170651],[0.8762172,0.529792,0.9365227],[0.8793926,0.643692,0.6337548],[0.8817564,0.1395839,1.955048],[0.8863775,0.8972046,0.6590617],[0.8891587,1.215711,1.609231],[0.900728,0.9324763,0.4250135],[0.9057149,0.6823142,0.4885824],[0.9076964,-0.416317,2.014719],[0.9084537,0.6949429,-0.9178451],[0.9140912,-0.9093025,0.1973086],[0.924262,1.927673,0.4606992],[0.9268938,-0.6383561,1.896396],[0.9334897,-0.007077299,0.1664834],[0.938363,0.3645695,0.07093816],[0.9437817,-0.3435735,2.058323],[0.9560228,-0.8847381,1.627543],[0.9639966,-1.017035,0.7572004],[0.9681695,0.5263082,2.139032],[0.9740786,-1.549197,1.976239],[0.9761423,-1.00434,1.825596],[0.9779809,-0.2271872,2.132746],[0.9789228,0.05775052,1.864802],[0.9794235,0.2117296,0.9722829],[0.9841865,0.05842241,2.426779],[0.9852782,0.07966991,1.436332],[0.9858218,0.07910407,-0.03805859],[0.9861898,0.9826269,-0.5232254],[0.9885514,0.4031209,2.643696],[0.9911962,-1.205658,2.761322],[0.9934408,0.3609228,1.121786],[0.9963931,-0.4229334,2.13603],[0.9971988,-0.5663555,2.22789],[0.9985017,1.297845,-0.3544792],[1.002193,0.3562833,1.334909],[1.00391,-0.6578346,2.74446],[1.007932,0.08744075,0.3190172],[1.010066,0.5759991,-0.2179764],[1.013829,0.3318128,1.467036],[1.021658,-0.703763,1.840066],[1.031087,1.438196,2.066553],[1.041873,1.449591,1.464494],[1.044733,-1.699895,3.605109],[1.048975,1.681664,-0.1074733],[1.069495,-0.9347531,3.457362],[1.074361,0.1537946,2.29396],[1.076649,-0.2637312,2.250388],[1.078127,1.99223,-0.5661792],[1.087526,0.5529187,0.02005426],[1.08757,1.245944,-1.118657],[1.089034,0.07774102,1.577018],[1.0987,0.486713,1.899926],[1.100147,-0.4186091,2.626689],[1.116977,-0.8863001,1.881104],[1.120511,0.351116,1.464136],[1.128842,-0.376826,1.137028],[1.130004,-0.3363326,1.597128],[1.130258,0.5543347,0.3791499],[1.13147,-0.7529835,2.808019],[1.131528,0.5197964,0.05156839],[1.146145,-0.02977601,0.03377859],[1.163723,-0.3794269,0.163025],[1.17386,-0.8180157,2.62623],[1.176636,1.200487,-0.7424931],[1.181342,0.4598598,1.243918],[1.184757,-0.5914834,1.923916],[1.184834,-0.9920701,2.029325],[1.205275,-0.1352185,0.928704],[1.205574,0.1586086,2.259396],[1.214449,-0.9179542,2.657125],[1.219097,0.9224253,1.326799],[1.220672,-2.00829,3.321877],[1.223345,-1.206553,2.896635],[1.227066,-1.546939,2.364464],[1.230947,-0.8231011,1.605003],[1.241294,0.4430236,0.6151944],[1.247645,-0.2323574,1.28825],[1.249679,-0.454832,2.186074],[1.253387,-1.760337,2.976147],[1.275546,-0.7000777,2.500336],[1.285474,-1.309284,1.575415],[1.296499,0.2106036,1.304769],[1.299641,1.063733,0.9743221],[1.301635,-0.7583558,1.010439],[1.30557,0.09157401,0.8926269],[1.307852,0.1737596,1.932164],[1.319598,1.552153,1.462643],[1.320976,-0.2364612,2.530191],[1.323102,0.9477182,-0.3581478],[1.324327,-0.4006545,1.665983],[1.326436,-2.580664,-0.4456485],[1.328339,0.6078832,1.220048],[1.337576,1.520377,1.427764],[1.345859,0.4513947,0.3469234],[1.361212,-1.576674,1.590492],[1.365214,0.6730922,0.2837078],[1.368117,1.435469,-0.6861998],[1.36885,-0.29513,0.4974988],[1.37469,0.07462943,1.34262],[1.379665,-0.673241,0.2190945],[1.392312,-1.542966,2.47523],[1.39308,1.774254,-0.4472481],[1.397174,1.220663,1.099823],[1.398609,0.2275815,1.325873],[1.402159,0.6766292,0.18456],[1.402425,-0.8071942,2.102335],[1.413906,0.7526874,-1.02076],[1.417356,0.3393172,1.806903],[1.420605,-1.17539,2.507397],[1.426093,0.2282334,2.299762],[1.431935,0.8353042,0.3439463],[1.435679,-0.1236904,3.117777],[1.442483,1.366589,0.8080252],[1.44294,2.049919,0.7551465],[1.450304,0.5675641,-0.2822984],[1.463976,-1.545916,2.400643],[1.471993,0.2982809,2.915203],[1.477642,0.4024252,0.4488475],[1.484537,-0.2049467,0.5813603],[1.499662,-0.00978148,1.677493],[1.505337,-0.2615486,4.093421],[1.506724,2.055504,2.025491],[1.510263,-1.263216,2.680819],[1.515752,2.258628,1.710589],[1.5279,-0.06133037,1.503782],[1.528424,0.7285649,1.605777],[1.534743,-0.3468552,1.33644],[1.536497,0.5874644,2.328785],[1.567394,0.24921,2.580673],[1.579781,0.9426413,-0.657424],[1.579987,1.118817,0.8972411],[1.581302,0.2363111,1.578807],[1.58247,1.171854,1.858174],[1.609455,0.3880485,2.145264],[1.622459,-0.8689609,3.370993],[1.669838,-0.4627823,-0.4372628],[1.676781,0.02682001,0.6149575],[1.680963,2.012253,-0.12099],[1.681605,1.428012,-1.963375],[1.691578,-0.7770993,1.490536],[1.695398,0.02128843,2.34397],[1.705581,-0.4731601,1.845363],[1.707118,-1.200699,1.121987],[1.7139,0.5729265,4.074151],[1.731521,0.3723077,0.285108],[1.75641,0.606628,0.007890453],[1.766621,1.212579,-1.459454],[1.769599,0.4952146,0.8196507],[1.806026,-0.1915311,-0.07749169],[1.870063,-1.892338,2.148801],[1.880209,0.8265071,1.226135],[1.883507,0.606953,0.4516484],[1.917922,0.4017197,1.584561],[1.937931,1.008319,1.34243],[1.949833,2.639617,0.4026026],[1.954552,-0.9346215,4.157657],[1.998433,1.817571,0.6064554],[2.038341,0.4313566,0.0961144],[2.058909,-0.7519738,2.116267],[2.069897,0.79133,-0.4593246],[2.093863,-1.697546,4.024817],[2.094185,0.1458611,2.47914],[2.113875,0.1347257,2.205594],[2.114576,0.7351252,2.477311],[2.168595,-0.4846854,1.779793],[2.179374,0.08042205,0.5476915],[2.233453,0.6651535,0.6415965],[2.248417,-0.9087933,1.4082],[2.269225,0.5280784,0.8786044],[2.291413,1.498748,0.6363081],[2.347203,-0.6988326,1.618544],[2.46253,-1.337191,2.406801],[2.497741,-1.198027,2.40464],[2.552787,-0.9233572,0.9710835],[2.807748,0.3829763,2.296128],[3.006632,0.7127066,0.7914879],[3.106901,0.6854224,-0.247434],[3.613092,-1.131205,3.422336]],"colors":[[1,0,0,1],[1,0.007843138,0,1],[1,0.01176471,0,1],[1,0.01960784,0,1],[1,0.02352941,0,1],[1,0.03137255,0,1],[1,0.03529412,0,1],[1,0.04313726,0,1],[1,0.04705882,0,1],[1,0.05490196,0,1],[1,0.05882353,0,1],[1,0.06666667,0,1],[1,0.07058824,0,1],[1,0.07843138,0,1],[1,0.08235294,0,1],[1,0.09019608,0,1],[1,0.09411765,0,1],[1,0.1019608,0,1],[1,0.1098039,0,1],[1,0.1137255,0,1],[1,0.1215686,0,1],[1,0.1254902,0,1],[1,0.1333333,0,1],[1,0.1372549,0,1],[1,0.145098,0,1],[1,0.1490196,0,1],[1,0.1568628,0,1],[1,0.1607843,0,1],[1,0.1686275,0,1],[1,0.172549,0,1],[1,0.1803922,0,1],[1,0.1843137,0,1],[1,0.1921569,0,1],[1,0.1960784,0,1],[1,0.2039216,0,1],[1,0.2117647,0,1],[1,0.2156863,0,1],[1,0.2235294,0,1],[1,0.227451,0,1],[1,0.2352941,0,1],[1,0.2392157,0,1],[1,0.2470588,0,1],[1,0.2509804,0,1],[1,0.2588235,0,1],[1,0.2627451,0,1],[1,0.2705882,0,1],[1,0.2745098,0,1],[1,0.282353,0,1],[1,0.2862745,0,1],[1,0.2941177,0,1],[1,0.3019608,0,1],[1,0.3058824,0,1],[1,0.3137255,0,1],[1,0.3176471,0,1],[1,0.3254902,0,1],[1,0.3294118,0,1],[1,0.3372549,0,1],[1,0.3411765,0,1],[1,0.3490196,0,1],[1,0.3529412,0,1],[1,0.3607843,0,1],[1,0.3647059,0,1],[1,0.372549,0,1],[1,0.3764706,0,1],[1,0.3843137,0,1],[1,0.3882353,0,1],[1,0.3960784,0,1],[1,0.4039216,0,1],[1,0.4078431,0,1],[1,0.4156863,0,1],[1,0.4196078,0,1],[1,0.427451,0,1],[1,0.4313726,0,1],[1,0.4392157,0,1],[1,0.4431373,0,1],[1,0.4509804,0,1],[1,0.454902,0,1],[1,0.4627451,0,1],[1,0.4666667,0,1],[1,0.4745098,0,1],[1,0.4784314,0,1],[1,0.4862745,0,1],[1,0.4901961,0,1],[1,0.4980392,0,1],[1,0.5058824,0,1],[1,0.509804,0,1],[1,0.5176471,0,1],[1,0.5215687,0,1],[1,0.5294118,0,1],[1,0.5333334,0,1],[1,0.5411765,0,1],[1,0.5450981,0,1],[1,0.5529412,0,1],[1,0.5568628,0,1],[1,0.5647059,0,1],[1,0.5686275,0,1],[1,0.5764706,0,1],[1,0.5803922,0,1],[1,0.5882353,0,1],[1,0.5921569,0,1],[1,0.6,0,1],[1,0.6078432,0,1],[1,0.6117647,0,1],[1,0.6196079,0,1],[1,0.6235294,0,1],[1,0.6313726,0,1],[1,0.6352941,0,1],[1,0.6431373,0,1],[1,0.6470588,0,1],[1,0.654902,0,1],[1,0.6588235,0,1],[1,0.6666667,0,1],[1,0.6705883,0,1],[1,0.6784314,0,1],[1,0.682353,0,1],[1,0.6901961,0,1],[1,0.6941177,0,1],[1,0.7019608,0,1],[1,0.7098039,0,1],[1,0.7137255,0,1],[1,0.7215686,0,1],[1,0.7254902,0,1],[1,0.7333333,0,1],[1,0.7372549,0,1],[1,0.7450981,0,1],[1,0.7490196,0,1],[1,0.7568628,0,1],[1,0.7607843,0,1],[1,0.7686275,0,1],[1,0.772549,0,1],[1,0.7803922,0,1],[1,0.7843137,0,1],[1,0.7921569,0,1],[1,0.7960784,0,1],[1,0.8039216,0,1],[1,0.8117647,0,1],[1,0.8156863,0,1],[1,0.8235294,0,1],[1,0.827451,0,1],[1,0.8352941,0,1],[1,0.8392157,0,1],[1,0.8470588,0,1],[1,0.8509804,0,1],[1,0.8588235,0,1],[1,0.8627451,0,1],[1,0.8705882,0,1],[1,0.8745098,0,1],[1,0.8823529,0,1],[1,0.8862745,0,1],[1,0.8941177,0,1],[1,0.8980392,0,1],[1,0.9058824,0,1],[1,0.9137255,0,1],[1,0.9176471,0,1],[1,0.9254902,0,1],[1,0.9294118,0,1],[1,0.9372549,0,1],[1,0.9411765,0,1],[1,0.9490196,0,1],[1,0.9529412,0,1],[1,0.9607843,0,1],[1,0.9647059,0,1],[1,0.972549,0,1],[1,0.9764706,0,1],[1,0.9843137,0,1],[1,0.9882353,0,1],[1,0.9960784,0,1],[0.9960784,1,0,1],[0.9921569,1,0,1],[0.9843137,1,0,1],[0.9803922,1,0,1],[0.972549,1,0,1],[0.9686275,1,0,1],[0.9607843,1,0,1],[0.9568627,1,0,1],[0.9490196,1,0,1],[0.945098,1,0,1],[0.9372549,1,0,1],[0.9333333,1,0,1],[0.9254902,1,0,1],[0.9215686,1,0,1],[0.9137255,1,0,1],[0.9098039,1,0,1],[0.9019608,1,0,1],[0.8941177,1,0,1],[0.8901961,1,0,1],[0.8823529,1,0,1],[0.8784314,1,0,1],[0.8705882,1,0,1],[0.8666667,1,0,1],[0.8588235,1,0,1],[0.854902,1,0,1],[0.8470588,1,0,1],[0.8431373,1,0,1],[0.8352941,1,0,1],[0.8313726,1,0,1],[0.8235294,1,0,1],[0.8196079,1,0,1],[0.8117647,1,0,1],[0.8078431,1,0,1],[0.8,1,0,1],[0.7921569,1,0,1],[0.7882353,1,0,1],[0.7803922,1,0,1],[0.7764706,1,0,1],[0.7686275,1,0,1],[0.7647059,1,0,1],[0.7568628,1,0,1],[0.7529412,1,0,1],[0.7450981,1,0,1],[0.7411765,1,0,1],[0.7333333,1,0,1],[0.7294118,1,0,1],[0.7215686,1,0,1],[0.7176471,1,0,1],[0.7098039,1,0,1],[0.7058824,1,0,1],[0.6980392,1,0,1],[0.6901961,1,0,1],[0.6862745,1,0,1],[0.6784314,1,0,1],[0.6745098,1,0,1],[0.6666667,1,0,1],[0.6627451,1,0,1],[0.654902,1,0,1],[0.6509804,1,0,1],[0.6431373,1,0,1],[0.6392157,1,0,1],[0.6313726,1,0,1],[0.627451,1,0,1],[0.6196079,1,0,1],[0.6156863,1,0,1],[0.6078432,1,0,1],[0.6039216,1,0,1],[0.5960785,1,0,1],[0.5882353,1,0,1],[0.5843138,1,0,1],[0.5764706,1,0,1],[0.572549,1,0,1],[0.5647059,1,0,1],[0.5607843,1,0,1],[0.5529412,1,0,1],[0.5490196,1,0,1],[0.5411765,1,0,1],[0.5372549,1,0,1],[0.5294118,1,0,1],[0.5254902,1,0,1],[0.5176471,1,0,1],[0.5137255,1,0,1],[0.5058824,1,0,1],[0.5019608,1,0,1],[0.4941176,1,0,1],[0.4862745,1,0,1],[0.4823529,1,0,1],[0.4745098,1,0,1],[0.4705882,1,0,1],[0.4627451,1,0,1],[0.4588235,1,0,1],[0.4509804,1,0,1],[0.4470588,1,0,1],[0.4392157,1,0,1],[0.4352941,1,0,1],[0.427451,1,0,1],[0.4235294,1,0,1],[0.4156863,1,0,1],[0.4117647,1,0,1],[0.4039216,1,0,1],[0.3960784,1,0,1],[0.3921569,1,0,1],[0.3843137,1,0,1],[0.3803922,1,0,1],[0.372549,1,0,1],[0.3686275,1,0,1],[0.3607843,1,0,1],[0.3568628,1,0,1],[0.3490196,1,0,1],[0.345098,1,0,1],[0.3372549,1,0,1],[0.3333333,1,0,1],[0.3254902,1,0,1],[0.3215686,1,0,1],[0.3137255,1,0,1],[0.3098039,1,0,1],[0.3019608,1,0,1],[0.2941177,1,0,1],[0.2901961,1,0,1],[0.282353,1,0,1],[0.2784314,1,0,1],[0.2705882,1,0,1],[0.2666667,1,0,1],[0.2588235,1,0,1],[0.254902,1,0,1],[0.2470588,1,0,1],[0.2431373,1,0,1],[0.2352941,1,0,1],[0.2313726,1,0,1],[0.2235294,1,0,1],[0.2196078,1,0,1],[0.2117647,1,0,1],[0.2078431,1,0,1],[0.2,1,0,1],[0.1921569,1,0,1],[0.1882353,1,0,1],[0.1803922,1,0,1],[0.1764706,1,0,1],[0.1686275,1,0,1],[0.1647059,1,0,1],[0.1568628,1,0,1],[0.1529412,1,0,1],[0.145098,1,0,1],[0.1411765,1,0,1],[0.1333333,1,0,1],[0.1294118,1,0,1],[0.1215686,1,0,1],[0.1176471,1,0,1],[0.1098039,1,0,1],[0.1058824,1,0,1],[0.09803922,1,0,1],[0.09019608,1,0,1],[0.08627451,1,0,1],[0.07843138,1,0,1],[0.07450981,1,0,1],[0.06666667,1,0,1],[0.0627451,1,0,1],[0.05490196,1,0,1],[0.05098039,1,0,1],[0.04313726,1,0,1],[0.03921569,1,0,1],[0.03137255,1,0,1],[0.02745098,1,0,1],[0.01960784,1,0,1],[0.01568628,1,0,1],[0.007843138,1,0,1],[0.003921569,1,0,1],[0,1,0.003921569,1],[0,1,0.01176471,1],[0,1,0.01568628,1],[0,1,0.02352941,1],[0,1,0.02745098,1],[0,1,0.03529412,1],[0,1,0.03921569,1],[0,1,0.04705882,1],[0,1,0.05098039,1],[0,1,0.05882353,1],[0,1,0.0627451,1],[0,1,0.07058824,1],[0,1,0.07450981,1],[0,1,0.08235294,1],[0,1,0.08627451,1],[0,1,0.09411765,1],[0,1,0.1019608,1],[0,1,0.1058824,1],[0,1,0.1137255,1],[0,1,0.1176471,1],[0,1,0.1254902,1],[0,1,0.1294118,1],[0,1,0.1372549,1],[0,1,0.1411765,1],[0,1,0.1490196,1],[0,1,0.1529412,1],[0,1,0.1607843,1],[0,1,0.1647059,1],[0,1,0.172549,1],[0,1,0.1764706,1],[0,1,0.1843137,1],[0,1,0.1882353,1],[0,1,0.1960784,1],[0,1,0.2039216,1],[0,1,0.2078431,1],[0,1,0.2156863,1],[0,1,0.2196078,1],[0,1,0.227451,1],[0,1,0.2313726,1],[0,1,0.2392157,1],[0,1,0.2431373,1],[0,1,0.2509804,1],[0,1,0.254902,1],[0,1,0.2627451,1],[0,1,0.2666667,1],[0,1,0.2745098,1],[0,1,0.2784314,1],[0,1,0.2862745,1],[0,1,0.2901961,1],[0,1,0.2980392,1],[0,1,0.3058824,1],[0,1,0.3098039,1],[0,1,0.3176471,1],[0,1,0.3215686,1],[0,1,0.3294118,1],[0,1,0.3333333,1],[0,1,0.3411765,1],[0,1,0.345098,1],[0,1,0.3529412,1],[0,1,0.3568628,1],[0,1,0.3647059,1],[0,1,0.3686275,1],[0,1,0.3764706,1],[0,1,0.3803922,1],[0,1,0.3882353,1],[0,1,0.3921569,1],[0,1,0.4,1],[0,1,0.4078431,1],[0,1,0.4117647,1],[0,1,0.4196078,1],[0,1,0.4235294,1],[0,1,0.4313726,1],[0,1,0.4352941,1],[0,1,0.4431373,1],[0,1,0.4470588,1],[0,1,0.454902,1],[0,1,0.4588235,1],[0,1,0.4666667,1],[0,1,0.4705882,1],[0,1,0.4784314,1],[0,1,0.4823529,1],[0,1,0.4901961,1],[0,1,0.4941176,1],[0,1,0.5019608,1],[0,1,0.509804,1],[0,1,0.5137255,1],[0,1,0.5215687,1],[0,1,0.5254902,1],[0,1,0.5333334,1],[0,1,0.5372549,1],[0,1,0.5450981,1],[0,1,0.5490196,1],[0,1,0.5568628,1],[0,1,0.5607843,1],[0,1,0.5686275,1],[0,1,0.572549,1],[0,1,0.5803922,1],[0,1,0.5843138,1],[0,1,0.5921569,1],[0,1,0.5960785,1],[0,1,0.6039216,1],[0,1,0.6117647,1],[0,1,0.6156863,1],[0,1,0.6235294,1],[0,1,0.627451,1],[0,1,0.6352941,1],[0,1,0.6392157,1],[0,1,0.6470588,1],[0,1,0.6509804,1],[0,1,0.6588235,1],[0,1,0.6627451,1],[0,1,0.6705883,1],[0,1,0.6745098,1],[0,1,0.682353,1],[0,1,0.6862745,1],[0,1,0.6941177,1],[0,1,0.7019608,1],[0,1,0.7058824,1],[0,1,0.7137255,1],[0,1,0.7176471,1],[0,1,0.7254902,1],[0,1,0.7294118,1],[0,1,0.7372549,1],[0,1,0.7411765,1],[0,1,0.7490196,1],[0,1,0.7529412,1],[0,1,0.7607843,1],[0,1,0.7647059,1],[0,1,0.772549,1],[0,1,0.7764706,1],[0,1,0.7843137,1],[0,1,0.7882353,1],[0,1,0.7960784,1],[0,1,0.8039216,1],[0,1,0.8078431,1],[0,1,0.8156863,1],[0,1,0.8196079,1],[0,1,0.827451,1],[0,1,0.8313726,1],[0,1,0.8392157,1],[0,1,0.8431373,1],[0,1,0.8509804,1],[0,1,0.854902,1],[0,1,0.8627451,1],[0,1,0.8666667,1],[0,1,0.8745098,1],[0,1,0.8784314,1],[0,1,0.8862745,1],[0,1,0.8901961,1],[0,1,0.8980392,1],[0,1,0.9058824,1],[0,1,0.9098039,1],[0,1,0.9176471,1],[0,1,0.9215686,1],[0,1,0.9294118,1],[0,1,0.9333333,1],[0,1,0.9411765,1],[0,1,0.945098,1],[0,1,0.9529412,1],[0,1,0.9568627,1],[0,1,0.9647059,1],[0,1,0.9686275,1],[0,1,0.9764706,1],[0,1,0.9803922,1],[0,1,0.9882353,1],[0,1,0.9921569,1],[0,1,1,1],[0,0.9921569,1,1],[0,0.9882353,1,1],[0,0.9803922,1,1],[0,0.9764706,1,1],[0,0.9686275,1,1],[0,0.9647059,1,1],[0,0.9568627,1,1],[0,0.9529412,1,1],[0,0.945098,1,1],[0,0.9411765,1,1],[0,0.9333333,1,1],[0,0.9294118,1,1],[0,0.9215686,1,1],[0,0.9176471,1,1],[0,0.9098039,1,1],[0,0.9058824,1,1],[0,0.8980392,1,1],[0,0.8901961,1,1],[0,0.8862745,1,1],[0,0.8784314,1,1],[0,0.8745098,1,1],[0,0.8666667,1,1],[0,0.8627451,1,1],[0,0.854902,1,1],[0,0.8509804,1,1],[0,0.8431373,1,1],[0,0.8392157,1,1],[0,0.8313726,1,1],[0,0.827451,1,1],[0,0.8196079,1,1],[0,0.8156863,1,1],[0,0.8078431,1,1],[0,0.8039216,1,1],[0,0.7960784,1,1],[0,0.7882353,1,1],[0,0.7843137,1,1],[0,0.7764706,1,1],[0,0.772549,1,1],[0,0.7647059,1,1],[0,0.7607843,1,1],[0,0.7529412,1,1],[0,0.7490196,1,1],[0,0.7411765,1,1],[0,0.7372549,1,1],[0,0.7294118,1,1],[0,0.7254902,1,1],[0,0.7176471,1,1],[0,0.7137255,1,1],[0,0.7058824,1,1],[0,0.6980392,1,1],[0,0.6941177,1,1],[0,0.6862745,1,1],[0,0.682353,1,1],[0,0.6745098,1,1],[0,0.6705883,1,1],[0,0.6627451,1,1],[0,0.6588235,1,1],[0,0.6509804,1,1],[0,0.6470588,1,1],[0,0.6392157,1,1],[0,0.6352941,1,1],[0,0.627451,1,1],[0,0.6235294,1,1],[0,0.6156863,1,1],[0,0.6117647,1,1],[0,0.6039216,1,1],[0,0.5960785,1,1],[0,0.5921569,1,1],[0,0.5843138,1,1],[0,0.5803922,1,1],[0,0.572549,1,1],[0,0.5686275,1,1],[0,0.5607843,1,1],[0,0.5568628,1,1],[0,0.5490196,1,1],[0,0.5450981,1,1],[0,0.5372549,1,1],[0,0.5333334,1,1],[0,0.5254902,1,1],[0,0.5215687,1,1],[0,0.5137255,1,1],[0,0.509804,1,1],[0,0.5019608,1,1],[0,0.4941176,1,1],[0,0.4901961,1,1],[0,0.4823529,1,1],[0,0.4784314,1,1],[0,0.4705882,1,1],[0,0.4666667,1,1],[0,0.4588235,1,1],[0,0.454902,1,1],[0,0.4470588,1,1],[0,0.4431373,1,1],[0,0.4352941,1,1],[0,0.4313726,1,1],[0,0.4235294,1,1],[0,0.4196078,1,1],[0,0.4117647,1,1],[0,0.4078431,1,1],[0,0.4,1,1],[0,0.3921569,1,1],[0,0.3882353,1,1],[0,0.3803922,1,1],[0,0.3764706,1,1],[0,0.3686275,1,1],[0,0.3647059,1,1],[0,0.3568628,1,1],[0,0.3529412,1,1],[0,0.345098,1,1],[0,0.3411765,1,1],[0,0.3333333,1,1],[0,0.3294118,1,1],[0,0.3215686,1,1],[0,0.3176471,1,1],[0,0.3098039,1,1],[0,0.3058824,1,1],[0,0.2980392,1,1],[0,0.2901961,1,1],[0,0.2862745,1,1],[0,0.2784314,1,1],[0,0.2745098,1,1],[0,0.2666667,1,1],[0,0.2627451,1,1],[0,0.254902,1,1],[0,0.2509804,1,1],[0,0.2431373,1,1],[0,0.2392157,1,1],[0,0.2313726,1,1],[0,0.227451,1,1],[0,0.2196078,1,1],[0,0.2156863,1,1],[0,0.2078431,1,1],[0,0.2039216,1,1],[0,0.1960784,1,1],[0,0.1882353,1,1],[0,0.1843137,1,1],[0,0.1764706,1,1],[0,0.172549,1,1],[0,0.1647059,1,1],[0,0.1607843,1,1],[0,0.1529412,1,1],[0,0.1490196,1,1],[0,0.1411765,1,1],[0,0.1372549,1,1],[0,0.1294118,1,1],[0,0.1254902,1,1],[0,0.1176471,1,1],[0,0.1137255,1,1],[0,0.1058824,1,1],[0,0.09803922,1,1],[0,0.09411765,1,1],[0,0.08627451,1,1],[0,0.08235294,1,1],[0,0.07450981,1,1],[0,0.07058824,1,1],[0,0.0627451,1,1],[0,0.05882353,1,1],[0,0.05098039,1,1],[0,0.04705882,1,1],[0,0.03921569,1,1],[0,0.03529412,1,1],[0,0.02745098,1,1],[0,0.02352941,1,1],[0,0.01568628,1,1],[0,0.01176471,1,1],[0,0.003921569,1,1],[0.003921569,0,1,1],[0.007843138,0,1,1],[0.01568628,0,1,1],[0.01960784,0,1,1],[0.02745098,0,1,1],[0.03137255,0,1,1],[0.03921569,0,1,1],[0.04313726,0,1,1],[0.05098039,0,1,1],[0.05490196,0,1,1],[0.0627451,0,1,1],[0.06666667,0,1,1],[0.07450981,0,1,1],[0.07843138,0,1,1],[0.08627451,0,1,1],[0.09019608,0,1,1],[0.09803922,0,1,1],[0.1058824,0,1,1],[0.1098039,0,1,1],[0.1176471,0,1,1],[0.1215686,0,1,1],[0.1294118,0,1,1],[0.1333333,0,1,1],[0.1411765,0,1,1],[0.145098,0,1,1],[0.1529412,0,1,1],[0.1568628,0,1,1],[0.1647059,0,1,1],[0.1686275,0,1,1],[0.1764706,0,1,1],[0.1803922,0,1,1],[0.1882353,0,1,1],[0.1921569,0,1,1],[0.2,0,1,1],[0.2078431,0,1,1],[0.2117647,0,1,1],[0.2196078,0,1,1],[0.2235294,0,1,1],[0.2313726,0,1,1],[0.2352941,0,1,1],[0.2431373,0,1,1],[0.2470588,0,1,1],[0.254902,0,1,1],[0.2588235,0,1,1],[0.2666667,0,1,1],[0.2705882,0,1,1],[0.2784314,0,1,1],[0.282353,0,1,1],[0.2901961,0,1,1],[0.2941177,0,1,1],[0.3019608,0,1,1],[0.3098039,0,1,1],[0.3137255,0,1,1],[0.3215686,0,1,1],[0.3254902,0,1,1],[0.3333333,0,1,1],[0.3372549,0,1,1],[0.345098,0,1,1],[0.3490196,0,1,1],[0.3568628,0,1,1],[0.3607843,0,1,1],[0.3686275,0,1,1],[0.372549,0,1,1],[0.3803922,0,1,1],[0.3843137,0,1,1],[0.3921569,0,1,1],[0.3960784,0,1,1],[0.4039216,0,1,1],[0.4117647,0,1,1],[0.4156863,0,1,1],[0.4235294,0,1,1],[0.427451,0,1,1],[0.4352941,0,1,1],[0.4392157,0,1,1],[0.4470588,0,1,1],[0.4509804,0,1,1],[0.4588235,0,1,1],[0.4627451,0,1,1],[0.4705882,0,1,1],[0.4745098,0,1,1],[0.4823529,0,1,1],[0.4862745,0,1,1],[0.4941176,0,1,1],[0.5019608,0,1,1],[0.5058824,0,1,1],[0.5137255,0,1,1],[0.5176471,0,1,1],[0.5254902,0,1,1],[0.5294118,0,1,1],[0.5372549,0,1,1],[0.5411765,0,1,1],[0.5490196,0,1,1],[0.5529412,0,1,1],[0.5607843,0,1,1],[0.5647059,0,1,1],[0.572549,0,1,1],[0.5764706,0,1,1],[0.5843138,0,1,1],[0.5882353,0,1,1],[0.5960785,0,1,1],[0.6039216,0,1,1],[0.6078432,0,1,1],[0.6156863,0,1,1],[0.6196079,0,1,1],[0.627451,0,1,1],[0.6313726,0,1,1],[0.6392157,0,1,1],[0.6431373,0,1,1],[0.6509804,0,1,1],[0.654902,0,1,1],[0.6627451,0,1,1],[0.6666667,0,1,1],[0.6745098,0,1,1],[0.6784314,0,1,1],[0.6862745,0,1,1],[0.6901961,0,1,1],[0.6980392,0,1,1],[0.7058824,0,1,1],[0.7098039,0,1,1],[0.7176471,0,1,1],[0.7215686,0,1,1],[0.7294118,0,1,1],[0.7333333,0,1,1],[0.7411765,0,1,1],[0.7450981,0,1,1],[0.7529412,0,1,1],[0.7568628,0,1,1],[0.7647059,0,1,1],[0.7686275,0,1,1],[0.7764706,0,1,1],[0.7803922,0,1,1],[0.7882353,0,1,1],[0.7921569,0,1,1],[0.8,0,1,1],[0.8078431,0,1,1],[0.8117647,0,1,1],[0.8196079,0,1,1],[0.8235294,0,1,1],[0.8313726,0,1,1],[0.8352941,0,1,1],[0.8431373,0,1,1],[0.8470588,0,1,1],[0.854902,0,1,1],[0.8588235,0,1,1],[0.8666667,0,1,1],[0.8705882,0,1,1],[0.8784314,0,1,1],[0.8823529,0,1,1],[0.8901961,0,1,1],[0.8941177,0,1,1],[0.9019608,0,1,1],[0.9098039,0,1,1],[0.9137255,0,1,1],[0.9215686,0,1,1],[0.9254902,0,1,1],[0.9333333,0,1,1],[0.9372549,0,1,1],[0.945098,0,1,1],[0.9490196,0,1,1],[0.9568627,0,1,1],[0.9607843,0,1,1],[0.9686275,0,1,1],[0.972549,0,1,1],[0.9803922,0,1,1],[0.9843137,0,1,1],[0.9921569,0,1,1],[0.9960784,0,1,1],[1,0,0.9960784,1],[1,0,0.9882353,1],[1,0,0.9843137,1],[1,0,0.9764706,1],[1,0,0.972549,1],[1,0,0.9647059,1],[1,0,0.9607843,1],[1,0,0.9529412,1],[1,0,0.9490196,1],[1,0,0.9411765,1],[1,0,0.9372549,1],[1,0,0.9294118,1],[1,0,0.9254902,1],[1,0,0.9176471,1],[1,0,0.9137255,1],[1,0,0.9058824,1],[1,0,0.9019608,1],[1,0,0.8941177,1],[1,0,0.8862745,1],[1,0,0.8823529,1],[1,0,0.8745098,1],[1,0,0.8705882,1],[1,0,0.8627451,1],[1,0,0.8588235,1],[1,0,0.8509804,1],[1,0,0.8470588,1],[1,0,0.8392157,1],[1,0,0.8352941,1],[1,0,0.827451,1],[1,0,0.8235294,1],[1,0,0.8156863,1],[1,0,0.8117647,1],[1,0,0.8039216,1],[1,0,0.7960784,1],[1,0,0.7921569,1],[1,0,0.7843137,1],[1,0,0.7803922,1],[1,0,0.772549,1],[1,0,0.7686275,1],[1,0,0.7607843,1],[1,0,0.7568628,1],[1,0,0.7490196,1],[1,0,0.7450981,1],[1,0,0.7372549,1],[1,0,0.7333333,1],[1,0,0.7254902,1],[1,0,0.7215686,1],[1,0,0.7137255,1],[1,0,0.7098039,1],[1,0,0.7019608,1],[1,0,0.6941177,1],[1,0,0.6901961,1],[1,0,0.682353,1],[1,0,0.6784314,1],[1,0,0.6705883,1],[1,0,0.6666667,1],[1,0,0.6588235,1],[1,0,0.654902,1],[1,0,0.6470588,1],[1,0,0.6431373,1],[1,0,0.6352941,1],[1,0,0.6313726,1],[1,0,0.6235294,1],[1,0,0.6196079,1],[1,0,0.6117647,1],[1,0,0.6078432,1],[1,0,0.6,1],[1,0,0.5921569,1],[1,0,0.5882353,1],[1,0,0.5803922,1],[1,0,0.5764706,1],[1,0,0.5686275,1],[1,0,0.5647059,1],[1,0,0.5568628,1],[1,0,0.5529412,1],[1,0,0.5450981,1],[1,0,0.5411765,1],[1,0,0.5333334,1],[1,0,0.5294118,1],[1,0,0.5215687,1],[1,0,0.5176471,1],[1,0,0.509804,1],[1,0,0.5058824,1],[1,0,0.4980392,1],[1,0,0.4901961,1],[1,0,0.4862745,1],[1,0,0.4784314,1],[1,0,0.4745098,1],[1,0,0.4666667,1],[1,0,0.4627451,1],[1,0,0.454902,1],[1,0,0.4509804,1],[1,0,0.4431373,1],[1,0,0.4392157,1],[1,0,0.4313726,1],[1,0,0.427451,1],[1,0,0.4196078,1],[1,0,0.4156863,1],[1,0,0.4078431,1],[1,0,0.4039216,1],[1,0,0.3960784,1],[1,0,0.3882353,1],[1,0,0.3843137,1],[1,0,0.3764706,1],[1,0,0.372549,1],[1,0,0.3647059,1],[1,0,0.3607843,1],[1,0,0.3529412,1],[1,0,0.3490196,1],[1,0,0.3411765,1],[1,0,0.3372549,1],[1,0,0.3294118,1],[1,0,0.3254902,1],[1,0,0.3176471,1],[1,0,0.3137255,1],[1,0,0.3058824,1],[1,0,0.2980392,1],[1,0,0.2941177,1],[1,0,0.2862745,1],[1,0,0.282353,1],[1,0,0.2745098,1],[1,0,0.2705882,1],[1,0,0.2627451,1],[1,0,0.2588235,1],[1,0,0.2509804,1],[1,0,0.2470588,1],[1,0,0.2392157,1],[1,0,0.2352941,1],[1,0,0.227451,1],[1,0,0.2235294,1],[1,0,0.2156863,1],[1,0,0.2117647,1],[1,0,0.2039216,1],[1,0,0.1960784,1],[1,0,0.1921569,1],[1,0,0.1843137,1],[1,0,0.1803922,1],[1,0,0.172549,1],[1,0,0.1686275,1],[1,0,0.1607843,1],[1,0,0.1568628,1],[1,0,0.1490196,1],[1,0,0.145098,1],[1,0,0.1372549,1],[1,0,0.1333333,1],[1,0,0.1254902,1],[1,0,0.1215686,1],[1,0,0.1137255,1],[1,0,0.1098039,1],[1,0,0.1019608,1],[1,0,0.09411765,1],[1,0,0.09019608,1],[1,0,0.08235294,1],[1,0,0.07843138,1],[1,0,0.07058824,1],[1,0,0.06666667,1],[1,0,0.05882353,1],[1,0,0.05490196,1],[1,0,0.04705882,1],[1,0,0.04313726,1],[1,0,0.03529412,1],[1,0,0.03137255,1],[1,0,0.02352941,1],[1,0,0.01960784,1],[1,0,0.01176471,1],[1,0,0.007843138,1]],"centers":[[-3.430266,-0.06208087,-1.367599],[-2.965313,-0.2400698,-2.44689],[-2.81333,-1.680751,-1.867579],[-2.678034,-1.040702,-2.535108],[-2.59313,0.4120148,-2.790212],[-2.465379,-0.2159984,-1.571351],[-2.421834,0.6742376,-2.094495],[-2.420993,-0.208324,-3.053931],[-2.353649,0.2584596,-1.458603],[-2.314175,0.8924786,-2.887731],[-2.256985,0.523297,-2.5806],[-2.243011,-0.5658222,-2.235968],[-2.161623,1.727293,-2.694949],[-2.133198,0.1005037,-1.985752],[-2.091546,-0.1079827,-4.398158],[-2.074866,-0.141675,-1.656878],[-2.051368,-0.721173,-2.077949],[-2.02614,0.5328711,-1.820963],[-2.024508,1.719168,-0.5681292],[-2.013053,0.2047552,-1.071949],[-1.972895,0.7482236,-1.520122],[-1.95924,-1.755636,-1.459585],[-1.949688,-0.6125081,-1.872316],[-1.94447,-1.322155,-0.6218983],[-1.943324,-0.7169053,-3.554135],[-1.942334,0.5032384,-0.6958483],[-1.934815,-0.8552863,-2.678356],[-1.92661,0.2746427,-2.118984],[-1.925087,-0.2368197,-0.4901222],[-1.923534,0.5737676,-2.205272],[-1.905419,-0.9167286,-1.951153],[-1.903023,1.072333,0.6828278],[-1.891686,2.521243,0.3038288],[-1.881131,0.6617372,0.148056],[-1.877331,-1.329935,-3.27756],[-1.86937,-0.8583601,-2.269953],[-1.856699,0.1519904,-0.9788154],[-1.848188,1.9647,-0.6474549],[-1.826992,-0.2727906,-0.7022043],[-1.823783,-0.5889589,-0.9523736],[-1.818643,0.5138894,-3.62577],[-1.818282,0.2704024,-0.5826997],[-1.815092,1.13061,0.01253385],[-1.810286,-0.8421708,-2.723847],[-1.798523,0.1570448,-2.740855],[-1.773178,2.898828,-0.3761543],[-1.757164,0.8916828,-0.6241761],[-1.72019,-0.08708315,-2.226645],[-1.695932,-0.3513213,-3.083985],[-1.691137,0.7183257,1.275954],[-1.665217,1.386814,-0.5434195],[-1.652469,0.2040517,-0.857475],[-1.648079,-1.975414,-3.494568],[-1.646918,-0.3767506,-1.517274],[-1.633991,-0.4796956,-3.587699],[-1.63092,1.104289,0.1072571],[-1.602237,1.264652,-2.003805],[-1.575046,-0.7297022,-2.570374],[-1.573269,0.6589597,-0.3417276],[-1.527913,1.498371,-0.1785654],[-1.517846,1.561548,1.120368],[-1.517563,-0.1210821,-2.006527],[-1.503656,-1.936386,-3.245119],[-1.496259,0.9046678,0.5868097],[-1.494243,-0.4592916,-1.154459],[-1.49254,1.432491,0.3826298],[-1.459884,-0.8505951,-2.719808],[-1.452943,1.694987,0.8020452],[-1.451248,-1.806844,-1.562634],[-1.433535,-0.9960054,-2.107917],[-1.426742,-0.7484679,-2.729467],[-1.419372,0.5871084,-1.314632],[-1.417716,0.8916292,-2.337762],[-1.415827,-1.535379,-2.070408],[-1.398575,0.6936552,0.4344941],[-1.398317,0.4669322,-0.9908715],[-1.383106,-0.2613102,-1.164848],[-1.380512,1.73158,-1.163733],[-1.379814,0.5391936,0.2877702],[-1.371156,-0.5377445,-0.5331261],[-1.37114,1.205453,-1.574611],[-1.365206,-0.8536597,-4.176567],[-1.358279,0.5901666,-1.199869],[-1.350651,1.243408,-1.736168],[-1.350572,1.158061,-2.837159],[-1.346473,-0.6486847,-1.024904],[-1.339271,0.9393293,-0.02090497],[-1.335818,-0.8315604,-0.6534641],[-1.330665,-1.33753,-3.184951],[-1.323939,0.5572384,-2.076559],[-1.308067,-0.8935457,-3.334425],[-1.306105,0.325996,-0.3544344],[-1.30151,-0.575056,-2.548134],[-1.296353,-1.82346,-2.473866],[-1.293398,0.01388549,-1.151876],[-1.282541,0.6225333,0.1973933],[-1.277446,0.5918726,0.4392659],[-1.256911,0.3441363,-1.413595],[-1.24736,1.212749,-1.111649],[-1.245067,1.286909,-1.142314],[-1.239672,-0.1417689,-0.8835487],[-1.238535,0.5923117,-1.944285],[-1.237037,0.7197886,-3.136255],[-1.23683,-1.075444,-3.156616],[-1.228815,1.624723,-0.6662614],[-1.212616,-0.6580726,-2.57329],[-1.208192,-0.1004098,-0.876932],[-1.206498,0.9284155,0.3479398],[-1.191216,-1.131158,-2.657994],[-1.181986,-0.08584738,-1.9426],[-1.181674,1.09306,-1.18735],[-1.178912,-1.879634,-2.410755],[-1.17548,-0.2895422,-2.364648],[-1.17394,0.9693495,-2.606023],[-1.16915,0.2000881,-0.9407827],[-1.16911,0.1594325,-2.182078],[-1.166215,1.436011,-1.414653],[-1.166096,1.387758,-1.307391],[-1.161214,1.211669,0.1087584],[-1.158397,0.4888137,-2.207022],[-1.155079,0.2835923,-1.092256],[-1.154621,-1.303757,-2.831529],[-1.147364,-0.1425894,-1.201009],[-1.141221,-0.09902874,0.3126068],[-1.140667,-0.7771702,-0.9637602],[-1.140462,0.6725708,0.1177827],[-1.12088,-1.333164,-1.035761],[-1.10682,-0.1378368,-1.344273],[-1.103898,0.772235,-1.631145],[-1.099963,0.889708,-1.665512],[-1.097027,2.115566,-1.620258],[-1.096767,-0.5435697,-0.7281437],[-1.096009,-0.4978397,-1.942901],[-1.094213,-0.04380738,-2.665719],[-1.08344,-0.8891439,-1.026355],[-1.068978,0.9148883,-1.941738],[-1.067184,-0.8085398,-3.012697],[-1.055101,-1.146504,-3.647723],[-1.051911,2.116014,-0.8324749],[-1.050387,-0.6036924,-2.294699],[-1.047895,-0.1953209,-0.8618653],[-1.046684,-0.5698146,-2.724695],[-1.046108,0.7120529,-1.947096],[-1.041827,-1.220868,-2.488542],[-1.040553,0.9303113,1.21676],[-1.040101,0.1550755,-1.451934],[-1.033562,1.564617,-2.208314],[-1.027779,0.1034637,-1.700704],[-1.025817,-0.1022732,-0.9821081],[-1.01444,0.6321303,-1.292112],[-1.013064,0.03205326,-1.221352],[-1.005146,0.7200023,-0.7171908],[-1.004594,1.055012,-0.6569414],[-1.004325,-1.147257,-1.692877],[-1.002402,1.262697,1.090286],[-1.001993,-0.09215532,-0.7402938],[-1.000761,0.7033727,0.1065474],[-0.9929116,0.1551075,-1.970783],[-0.988663,0.4482353,-1.591928],[-0.9834996,-1.168343,-2.938586],[-0.9816212,1.258592,0.7492694],[-0.9773625,-0.584657,-1.231832],[-0.9764533,-2.015844,-2.335765],[-0.9755627,0.1694585,-2.852984],[-0.9754102,1.913462,0.5043523],[-0.974592,-0.04271764,-2.165049],[-0.9697078,1.173818,-1.875201],[-0.9650027,0.3868665,1.055961],[-0.9626284,-0.7597101,-0.4540013],[-0.957845,0.4590524,-1.568138],[-0.9572635,0.5387421,-2.326384],[-0.9550359,-0.1614573,-1.053738],[-0.9541495,-1.766468,-3.720844],[-0.952315,-0.6269928,-1.609388],[-0.9506255,-0.5884481,-2.181035],[-0.9504598,-0.4050855,-2.328032],[-0.9168113,1.023878,-0.01529007],[-0.9159968,1.662852,-3.352121],[-0.903281,-0.7306993,-1.420994],[-0.8945284,0.3553716,-3.308629],[-0.8936105,0.1469491,-2.046373],[-0.8925446,-1.149492,-3.527181],[-0.8844228,-0.1038833,0.2689202],[-0.8826213,0.9189862,-0.4573929],[-0.8823706,-1.195835,-1.525376],[-0.8821354,-0.1613239,-1.538044],[-0.8797454,-0.295604,-2.217002],[-0.878584,-0.5193238,-1.898284],[-0.874139,0.6006062,-3.023104],[-0.8728682,-0.06473826,-0.7973449],[-0.8701146,0.4628576,-1.269212],[-0.8696138,0.06441593,0.3977431],[-0.8627803,0.2706268,-0.2254025],[-0.8611564,-1.056678,-2.670703],[-0.8603305,0.4176492,-0.9981925],[-0.8538814,-1.664255,-2.193958],[-0.8427652,0.2782963,-1.963209],[-0.8413599,0.3971571,-2.269428],[-0.8397132,1.842826,-0.9428912],[-0.8386379,-0.3624752,-1.84015],[-0.8293734,-1.530667,-3.803658],[-0.8273323,-1.205858,-2.281495],[-0.8238564,-1.480042,-3.293898],[-0.8195233,-0.174458,-0.7646892],[-0.8113319,0.3923138,-1.830981],[-0.8069111,0.5263323,-1.010667],[-0.8058372,0.8383406,-1.035268],[-0.8039763,-1.149278,-2.67463],[-0.7984005,1.184164,-0.3308493],[-0.7960255,0.4031757,-0.5911524],[-0.7957205,0.2528179,-1.831555],[-0.7944168,1.686758,-1.404288],[-0.790801,1.49846,-0.516062],[-0.7902594,0.56782,0.2033143],[-0.784587,-0.2525012,-2.222166],[-0.7815914,0.05557635,-0.9193875],[-0.771381,0.8619779,-0.9383897],[-0.7706022,-0.2117444,-0.6756939],[-0.77041,-0.07893794,-1.662876],[-0.7684408,-0.3292137,-2.669175],[-0.7658461,-0.2177359,-2.64916],[-0.7623037,1.221819,-0.4020347],[-0.7599059,0.6972113,-1.048984],[-0.7543738,0.5728906,-0.9940112],[-0.753679,-1.74577,-3.265171],[-0.753221,-0.2539601,-3.32867],[-0.7502,0.9491156,-2.30862],[-0.7484325,-0.8889467,-3.041666],[-0.7471387,1.72019,-0.05237993],[-0.7440474,0.3224938,-1.537137],[-0.7366607,0.04832927,-1.79029],[-0.7350253,-2.228298,-2.962203],[-0.7337605,-0.6307892,-1.623056],[-0.7335055,0.623126,0.03328534],[-0.7265296,1.458328,0.3757586],[-0.7258289,-1.670985,-3.450368],[-0.7147773,-0.07166079,-0.2750503],[-0.7136001,1.909625,-0.3716336],[-0.7088855,-0.4074726,-3.471782],[-0.7083501,0.1889762,-1.841349],[-0.7059327,-0.3761328,-2.421081],[-0.705726,-0.3488126,-2.609745],[-0.6978529,-0.2078413,-2.496171],[-0.6964902,1.421375,0.3014753],[-0.6955284,0.742105,-2.023517],[-0.6954817,-0.7494026,-2.323404],[-0.6940888,0.4639053,-2.510407],[-0.6917174,1.620435,-1.116132],[-0.6800228,0.5172206,-0.8557283],[-0.6775395,0.06411681,-3.623726],[-0.6746665,-0.5281012,-2.237156],[-0.6729486,0.07214002,-0.6366047],[-0.672317,0.7637438,-0.551743],[-0.6694363,0.1366228,-3.646103],[-0.6687784,-1.094223,-2.583916],[-0.666711,-0.3550499,-2.895789],[-0.6566425,-0.01485349,-3.632627],[-0.6549761,-0.6069052,-3.343289],[-0.6548411,0.002604696,-0.3552433],[-0.6540896,0.2919414,-1.703528],[-0.6510729,-0.7219803,-3.37613],[-0.648957,0.3743511,-0.8088003],[-0.6474634,-1.843716,-2.194952],[-0.6454484,2.803949,1.756962],[-0.6452881,0.8140532,0.1843648],[-0.6402779,-1.295576,-2.150549],[-0.6374859,0.3023479,-1.122058],[-0.6342519,0.09037763,-2.2183],[-0.6313758,0.1316174,-0.2383467],[-0.6268631,0.7330947,-0.825496],[-0.6202136,-0.7257982,-2.253073],[-0.6186931,-0.06473324,-1.282213],[-0.6186898,0.9757673,-0.4244943],[-0.6184608,-0.7774969,-3.421691],[-0.6167386,0.1584104,-2.824488],[-0.6103962,0.3537945,-2.508452],[-0.6080205,-0.1382768,-1.428533],[-0.6039968,2.260974,0.2440929],[-0.6036725,0.304364,-2.676794],[-0.601129,-0.02152495,-0.5611544],[-0.5949549,1.956114,-0.3178346],[-0.5922746,1.722074,0.2759354],[-0.5918425,0.4889716,-0.05941261],[-0.5910187,0.198333,-3.113183],[-0.5895868,-0.08304691,-0.08158311],[-0.588039,0.3849654,-0.9249447],[-0.5878878,3.103662,-0.4676295],[-0.5878578,1.639263,-0.6493829],[-0.5859952,-0.5040535,-2.749205],[-0.5740461,0.07648262,-0.2930773],[-0.5718399,-0.9667246,-1.641168],[-0.5716906,-1.325239,-2.328049],[-0.5694991,1.639271,0.8742266],[-0.5688646,-0.4112628,-1.641333],[-0.5684208,-0.3311903,-3.284049],[-0.5682326,-0.9470888,-4.218898],[-0.5665176,-0.9163972,-2.772768],[-0.5642351,0.9684892,-1.830277],[-0.5642132,-0.842895,-0.5157227],[-0.5612002,-0.5301639,-2.848215],[-0.5606887,-0.4086809,-0.6768146],[-0.5594237,0.9924819,-0.6382696],[-0.5527692,-0.5633311,-2.004621],[-0.5527585,-0.7137995,-3.093591],[-0.5519165,1.445966,0.4217893],[-0.55186,-1.31714,-2.460649],[-0.5506748,0.5345651,-1.466757],[-0.5503614,0.8246318,-0.06919362],[-0.5460765,0.3144429,-1.06059],[-0.5414662,-0.7278218,-2.24093],[-0.5395633,0.693276,-1.302357],[-0.5360637,-0.2373747,-1.629815],[-0.5353168,-0.9933812,-3.774341],[-0.5341086,-0.6596985,-0.970637],[-0.5316961,-0.6933125,-3.007642],[-0.5312359,-0.03698394,-2.02283],[-0.5261211,-0.009833041,-2.701671],[-0.5241584,0.7968829,-0.227144],[-0.5177234,-0.5083842,-4.248968],[-0.5128207,1.314098,-0.3486445],[-0.5124614,-2.925297,-3.163824],[-0.509342,0.003915304,-2.083642],[-0.5062361,0.09751733,-1.758136],[-0.5052918,0.7886764,-1.513908],[-0.5033786,-0.2725985,-2.605887],[-0.4980309,-0.1876334,-3.178236],[-0.4959854,0.8159986,0.6157683],[-0.4943052,0.01220305,-3.206109],[-0.4928288,-1.121657,-3.138516],[-0.4861276,-1.602605,-2.510879],[-0.4820528,0.1491391,-2.962063],[-0.4765006,0.8114458,-1.832971],[-0.4748203,0.1655305,-0.341352],[-0.4678332,0.3859219,0.6179838],[-0.4677048,-1.546666,-2.76788],[-0.4668493,0.409974,-1.212793],[-0.4656619,-0.2955124,-1.836399],[-0.4632095,0.8326523,-2.009941],[-0.4628891,0.6962999,-2.121995],[-0.4614094,1.08018,-0.7304242],[-0.4587147,0.4191531,-0.5357405],[-0.4581185,-0.6339457,-3.010324],[-0.4574916,-0.8668846,-3.335918],[-0.4563054,0.6652006,-0.6223998],[-0.4446505,1.939872,-0.3182269],[-0.4444736,-1.371324,-1.46219],[-0.4389357,1.250948,-1.839776],[-0.4386396,1.275002,-1.308923],[-0.4351263,-0.9074901,-1.542326],[-0.4345822,-1.536064,-3.714015],[-0.4252658,1.269127,-0.531578],[-0.4200301,0.3419257,-1.151402],[-0.4125266,1.222009,0.8024089],[-0.411279,1.052826,-2.61209],[-0.4073955,-0.6360655,-2.711872],[-0.4054509,1.496886,0.7982383],[-0.4022615,0.1956737,-1.323375],[-0.401341,-0.8087542,-2.960673],[-0.4002971,0.2006165,-1.893871],[-0.3947568,2.486854,-1.88092],[-0.3909384,0.05181213,-2.474942],[-0.3850096,-0.3015475,-2.237618],[-0.3845039,-0.730149,-2.023491],[-0.3769771,1.175248,0.4963773],[-0.3740873,1.448973,-0.6258604],[-0.3740826,0.3672451,-0.725526],[-0.3656657,-0.4297356,-2.03742],[-0.3587406,-0.2456293,-2.242097],[-0.3537839,-0.2247003,-1.78295],[-0.3528889,1.008612,-0.3012984],[-0.3506142,-0.003014438,-0.6800546],[-0.3473161,-1.081952,-1.924284],[-0.3434919,-1.268584,-3.212729],[-0.3416292,-2.540504,-1.869317],[-0.340194,0.6413335,-1.513047],[-0.3358719,-0.3415599,-1.937504],[-0.3358027,0.4900296,-0.9468794],[-0.334796,0.9103344,-2.712511],[-0.3322056,2.13786,0.5902542],[-0.328509,1.187783,-0.7811227],[-0.3190792,-0.654352,-2.636674],[-0.3176073,-0.4896755,-4.146187],[-0.3174753,-0.007530609,-1.430999],[-0.3153859,0.6962882,0.8348392],[-0.3148918,0.4402868,-0.792386],[-0.3111715,-1.21341,-2.64282],[-0.3093434,0.5374351,0.8034161],[-0.3091631,-1.24479,-2.466709],[-0.3051369,-1.206432,-1.726702],[-0.3042652,0.4292181,0.7461908],[-0.3015267,2.148962,1.923155],[-0.2950801,-1.303485,-4.631298],[-0.2928111,0.3387792,-0.4061856],[-0.2903627,0.1788777,0.01007354],[-0.2889952,-2.314348,-1.083452],[-0.2881359,0.5178228,0.9623772],[-0.2855092,0.4544616,0.7117652],[-0.2801378,-1.386719,-2.030464],[-0.2800028,0.128439,-1.787363],[-0.2773931,0.58812,-0.9240071],[-0.2735021,0.0643152,0.5632451],[-0.2729017,0.5028672,-1.32728],[-0.2715191,-1.133503,-4.25919],[-0.2698835,-0.609953,-2.015647],[-0.2644694,-0.7051808,-2.038082],[-0.2585016,-0.01877365,-1.794898],[-0.2576067,-0.2325624,-1.075759],[-0.252229,-0.2142215,-2.452765],[-0.2522216,1.447165,-2.242254],[-0.2493297,-0.1005597,-1.984515],[-0.2486236,-0.8059807,-2.274063],[-0.2479392,-0.36827,-1.619665],[-0.2437172,-0.9366058,-1.662548],[-0.2429892,1.409937,-2.309394],[-0.2410239,1.366523,-1.294323],[-0.2403878,-0.7038575,-3.770184],[-0.239145,0.1785506,0.597448],[-0.2349001,-1.178378,-0.4331521],[-0.2322931,-0.6300119,-2.372942],[-0.2238641,0.405842,1.935438],[-0.223517,-0.3092742,-1.714227],[-0.221639,1.071941,-1.039615],[-0.219652,0.3479766,2.375196],[-0.2196357,1.004444,-1.979066],[-0.2189065,1.030488,-1.043434],[-0.2142391,0.8751574,-1.34646],[-0.2124936,0.02485366,-1.625316],[-0.2099908,0.7829719,1.432187],[-0.2089089,-0.3327002,-2.469647],[-0.2079275,-0.1060576,-3.719195],[-0.2055983,-0.01708823,-0.3988008],[-0.2042099,0.6828275,0.7974436],[-0.2038526,-0.8083296,-2.417032],[-0.2025199,0.2028022,-0.6708514],[-0.2021614,1.614124,0.7407615],[-0.1989468,-0.9988651,-2.919979],[-0.1963927,0.06602219,-1.551218],[-0.194645,0.6250163,-0.9894196],[-0.192576,0.6921297,0.4774087],[-0.1910858,-0.1705846,-2.116623],[-0.1906553,-0.06672458,-2.632374],[-0.1890392,-0.2893114,-2.49276],[-0.185334,-0.1195784,-1.670697],[-0.1816814,1.667338,0.6319709],[-0.1800644,0.6040888,-1.991832],[-0.179839,-0.6934605,-4.075515],[-0.1760055,-1.582543,-4.676388],[-0.1748661,-1.053803,-1.981602],[-0.1736452,-1.215094,-0.4825405],[-0.1724582,-0.1468649,-3.606677],[-0.1720935,-0.4040823,-3.934415],[-0.1714553,-0.4781603,-2.993188],[-0.1677132,-0.1514182,-0.9650946],[-0.1579672,-0.209794,-3.369425],[-0.1574252,1.006846,-1.11271],[-0.1571319,-0.6289902,-2.448042],[-0.1560094,0.01278148,-0.4771135],[-0.1537635,0.1087775,0.09425288],[-0.1430617,-0.2990657,-0.6549532],[-0.1401787,-1.670301,-2.97586],[-0.1396181,0.1038655,-0.509684],[-0.1377426,-1.094112,-3.694582],[-0.1358579,0.1156225,0.6311448],[-0.13451,0.3121611,-0.5426739],[-0.1330732,-0.9670658,-2.8271],[-0.1277657,1.137751,-0.5203407],[-0.1255133,-0.2635553,-2.354475],[-0.1232467,0.104546,-1.419751],[-0.1174543,0.7075523,2.533155],[-0.1136206,0.6691267,-0.6865494],[-0.1132832,-0.5042155,-2.436143],[-0.11142,0.05248046,-1.010777],[-0.1077885,0.3412353,-0.6440372],[-0.1068169,-0.653293,-2.968642],[-0.1027878,0.3396051,0.4620987],[-0.09960935,-1.711499,-1.624738],[-0.09673197,0.823669,1.194021],[-0.09493424,-1.976377,-2.537573],[-0.09200352,-0.05396417,-2.695805],[-0.08805396,-1.796418,-2.574766],[-0.08798315,0.6774786,0.7789865],[-0.0867155,0.3418036,0.06093908],[-0.08199269,0.146508,-2.383236],[-0.08180112,-1.31459,-2.802478],[-0.08170763,0.3268913,-2.284367],[-0.08121398,2.238406,0.2294811],[-0.07625585,0.9933434,0.8286999],[-0.07604507,-0.1577198,-5.23838],[-0.07140767,-0.2456566,-3.119783],[-0.0704199,1.496543,-0.9118824],[-0.06976946,0.4698281,-0.2945938],[-0.06748924,1.198769,-0.8771542],[-0.06746098,-0.7663106,-3.193804],[-0.06724953,-0.06121274,-2.068562],[-0.06566603,-0.0969739,-3.010874],[-0.06475075,0.03747734,-2.240826],[-0.06406893,-0.9353258,-2.348583],[-0.06267726,-1.55319,-2.343854],[-0.05945646,-0.4482551,-2.633554],[-0.05535819,0.9142553,-0.09389652],[-0.04991045,0.736325,0.6124374],[-0.04805349,1.874342,-1.43618],[-0.04417768,0.8023437,0.9093336],[-0.03884257,-0.1091575,-2.731261],[-0.03311035,-0.5543477,-2.794361],[-0.03228591,1.520618,-0.5213931],[-0.03190583,0.5544455,0.6669514],[-0.03153875,0.8255929,-0.5629947],[-0.03148077,0.6192452,-0.6488079],[-0.02941097,0.8663306,0.4055608],[-0.02823553,0.116844,0.007806055],[-0.0243708,-0.1122262,-2.62043],[-0.01800991,0.8214522,1.410606],[-0.01646608,2.012103,0.7467295],[-0.01516046,-1.080328,-3.713778],[-0.01128615,-0.9325967,-1.432196],[-0.003149398,-0.6420618,-3.968605],[-0.00149423,-0.4785102,-2.819244],[0.006827426,0.6672336,0.266915],[0.008473998,0.5412562,0.0321281],[0.009888482,-0.01313371,2.189278],[0.01063581,0.1385048,0.1195143],[0.01249648,0.0223479,-0.0529018],[0.01267634,-0.5888854,2.115286],[0.01513833,1.380245,-0.9853012],[0.02025563,0.08174855,-0.1168125],[0.02193361,-0.5293702,0.932822],[0.03062946,-0.2174884,2.622383],[0.03139034,-0.1388178,1.600153],[0.0319917,-0.5092899,1.766877],[0.03313202,-0.3983775,2.608201],[0.03379167,-0.42616,2.552446],[0.03552095,0.4952091,-1.596389],[0.03660252,0.6710069,-0.1777451],[0.0399432,0.1776091,0.1034053],[0.04229085,-1.173695,3.709227],[0.04649585,-1.146996,0.9437875],[0.04781209,-1.146054,3.075826],[0.05029725,-0.2617847,2.071712],[0.0520993,0.5722958,0.7010817],[0.05841039,1.538236,0.6979063],[0.06233424,-1.550083,3.754189],[0.06247605,-0.2974037,2.946611],[0.06626097,0.4014599,0.07472286],[0.0694616,-1.503848,1.210832],[0.07002768,-1.698748,3.69288],[0.0720766,-1.182664,4.085686],[0.07452999,-0.1764201,3.76736],[0.07520809,-2.024065,2.312454],[0.07864664,0.1166825,1.775927],[0.08054062,-0.652904,2.996625],[0.08223568,0.106668,-0.7036827],[0.08226781,0.1350483,1.195508],[0.08253415,0.3483532,-0.9684842],[0.08443217,0.08974735,0.3258187],[0.08988303,1.366149,-1.233164],[0.09056038,-0.8565867,1.285907],[0.09296627,-0.1548162,1.710879],[0.09330047,-1.599599,2.912462],[0.09645657,0.3383542,1.609382],[0.09743035,-1.356396,1.642196],[0.1006623,-0.8462107,2.564183],[0.1032336,1.421398,-0.6684071],[0.1075693,-0.2217123,2.623508],[0.1127763,1.353922,-0.3288769],[0.1128159,0.1860119,0.1908803],[0.1131843,1.007092,1.077798],[0.1153584,-0.4497807,2.487831],[0.1158735,0.9995368,0.953062],[0.1165367,-1.342688,2.404952],[0.122074,1.200469,1.479066],[0.1230011,-0.1338416,2.858217],[0.1278708,-0.4656257,3.878862],[0.1319293,0.7286666,0.108001],[0.1337394,1.050504,0.174198],[0.1345109,-0.1613803,1.280053],[0.1347924,0.7778521,-0.2130738],[0.1396866,-0.03449942,2.509565],[0.1430803,-2.117127,3.229611],[0.1473662,0.9596918,0.0001214175],[0.1492129,0.9818644,0.3451586],[0.1523053,-1.133652,2.308748],[0.1626777,1.279994,0.9288715],[0.1725165,-1.1914,2.193072],[0.1737457,-1.370453,2.659897],[0.1750803,1.081112,0.570251],[0.1766661,-0.1500287,1.454911],[0.1787426,0.6649355,0.2033902],[0.1788443,2.067155,-1.62152],[0.1789144,1.13235,-0.5439209],[0.1815079,1.515999,0.9952847],[0.1815284,0.5499438,1.066263],[0.1830228,0.8570198,-0.9507496],[0.1835567,1.863263,1.538586],[0.1876998,-1.805754,3.984128],[0.1899263,-0.4939836,2.304983],[0.1928041,-0.007366986,1.746463],[0.2000726,1.441008,-2.079096],[0.2036594,-0.9763479,2.812958],[0.2110087,0.8266068,0.7603397],[0.2119434,1.061304,1.128921],[0.2126235,-0.07816298,1.643099],[0.2160528,2.012263,-0.942973],[0.2227708,0.3284715,0.8892276],[0.2238826,-0.7592114,4.437776],[0.2242158,0.153631,0.14649],[0.2253417,2.882386,0.5500785],[0.2334551,0.06758313,1.857441],[0.2348191,-2.216815,2.163787],[0.2351768,-1.041771,3.213814],[0.2368425,-0.6132454,3.94585],[0.2396551,-1.101504,3.471947],[0.2410707,-1.17143,3.213699],[0.2411938,0.8127118,0.5091293],[0.2420337,-1.059701,3.693218],[0.2425112,0.4462846,0.3169352],[0.2432398,-2.77241,3.404158],[0.243683,0.5067416,1.85204],[0.248153,-0.8767046,3.867245],[0.2527593,-0.07253909,1.739399],[0.2589411,-0.3477653,0.3446407],[0.2606219,-0.4899484,2.559835],[0.261734,1.506526,1.003645],[0.2656366,0.05608952,2.801244],[0.2748773,0.497283,-1.136451],[0.2793262,-0.8915093,2.647768],[0.2884228,1.662304,-0.1050545],[0.2889444,-1.187653,3.741319],[0.2995535,-0.2539399,1.632059],[0.3024145,0.2668342,0.2360478],[0.3151344,1.510399,1.095489],[0.3166898,0.3702813,0.385507],[0.3168157,-0.7409312,2.782765],[0.3200834,-1.651427,1.376502],[0.3225709,1.106523,0.5057447],[0.3226523,-0.1721255,1.28304],[0.3233976,0.8104631,1.431712],[0.3235866,0.9749462,0.6173211],[0.3286749,0.4643942,0.8105513],[0.3289162,-0.3043135,2.844264],[0.3312175,1.463534,-0.8301763],[0.3332443,0.1627131,1.852985],[0.3360664,0.6220362,0.5424738],[0.3374374,-1.81866,3.878933],[0.3377022,-0.5670134,2.781746],[0.3379823,0.3132719,1.704674],[0.3422684,-1.13747,1.88527],[0.3424715,-0.933201,1.804175],[0.3439874,0.4868895,1.302039],[0.3551738,0.4680077,0.7526403],[0.3600636,0.02849813,0.8788456],[0.3609925,-1.453246,2.987059],[0.3615133,-0.6405774,2.647264],[0.3700261,1.31734,0.08053455],[0.3705011,1.976718,-0.1776901],[0.3719158,0.5059171,0.7501435],[0.3740197,-0.3267063,3.455528],[0.3780777,0.7100343,0.28483],[0.3786327,-0.3952789,1.944148],[0.3795094,0.2343618,1.399955],[0.3801517,-0.8030277,2.691845],[0.3808093,1.889055,1.356929],[0.387206,-0.03142021,2.243541],[0.3937359,2.243813,-0.1951223],[0.3962667,-0.6026197,2.853893],[0.3962718,-0.06142782,2.162777],[0.3976056,0.7655652,0.6966414],[0.4057743,-0.7751123,3.404876],[0.4114834,-0.4654181,2.736432],[0.411502,0.8806795,-1.148977],[0.4181887,1.416042,0.000349885],[0.4201821,-0.1981424,3.117025],[0.4241619,-0.0172708,2.948697],[0.4266952,0.7071372,0.6311548],[0.4282067,-0.6310399,3.494996],[0.4320581,-0.7810132,3.331922],[0.4325489,0.5582695,2.687428],[0.4328216,-1.722093,3.666633],[0.4359596,0.4797246,1.932378],[0.4376372,-1.905223,0.8117976],[0.4384452,-1.022361,1.235359],[0.4431027,0.435971,0.3884442],[0.4436415,-0.545859,2.453298],[0.4451795,1.398747,2.024466],[0.4487985,-0.7675027,4.110855],[0.4508762,-0.8248122,3.666399],[0.4603885,0.3285792,-0.4246856],[0.4606157,-1.223349,3.239428],[0.4609788,-1.382776,2.369236],[0.4624778,0.2711449,1.918943],[0.4627277,0.4359025,1.822241],[0.463897,0.2137662,1.114224],[0.4641786,0.4374901,2.138841],[0.4710271,0.2592365,1.508318],[0.4779215,0.974049,0.1754041],[0.4830838,-0.4326708,2.218012],[0.4853568,-0.9686957,1.911112],[0.4942718,-1.805563,1.615579],[0.4945547,-0.4892878,4.478043],[0.4954009,0.1945782,1.540497],[0.4971487,1.205345,1.69917],[0.4995697,1.395993,1.043703],[0.5000066,-0.2628614,1.967492],[0.5026942,-0.7221063,3.111398],[0.5093024,-0.06829438,2.41384],[0.513834,-0.5079234,3.430927],[0.5198789,3.245267,0.8537966],[0.520256,-1.692691,1.740074],[0.5214225,0.2729191,2.657267],[0.5277786,-1.680609,1.857611],[0.5297205,0.3943833,-0.1663658],[0.5379191,-0.1703212,2.380933],[0.5400298,0.1560329,1.340541],[0.5401537,0.6512736,-0.03198026],[0.5437012,0.9875979,1.608889],[0.545517,1.708186,-1.557542],[0.5517418,1.106694,0.3033873],[0.5521603,0.2068988,0.4654556],[0.555272,-0.140886,2.724774],[0.5552737,-1.697809,1.985451],[0.5572217,-0.5349567,2.257818],[0.5589973,-0.932143,3.628907],[0.5603966,-0.8373314,2.681431],[0.5644156,0.4664415,0.9877619],[0.5646884,0.06399992,1.261121],[0.5760453,0.857134,0.7963274],[0.5779908,-0.1171875,1.69184],[0.5809137,1.330868,0.9230492],[0.5823154,0.6480892,1.149893],[0.5830634,-0.1454929,3.219177],[0.5852167,-0.7463663,1.828395],[0.5871943,0.3735091,2.651537],[0.5884489,-0.8417689,2.981113],[0.5925131,1.503799,-1.232857],[0.5971642,1.562265,1.163672],[0.5982954,-0.9150296,2.167591],[0.5989614,-2.056856,3.285443],[0.5996484,0.7989349,1.40625],[0.5999615,0.8911638,0.1952752],[0.6010513,0.1820024,-0.3442453],[0.6024558,0.6804361,0.2967384],[0.6027642,-1.563284,4.012374],[0.6054304,0.2598115,1.443685],[0.6123897,0.3488096,1.942253],[0.6136559,0.3972707,1.342707],[0.6197824,1.668451,1.160346],[0.6239954,-0.6737487,0.2249852],[0.6377494,0.8999559,0.1655974],[0.6402541,0.02632717,1.97535],[0.6426758,-0.3051963,2.800416],[0.6431116,1.764861,0.551028],[0.6495633,0.3557404,0.3291159],[0.6577637,-0.6752538,3.081458],[0.6593841,-0.3246848,1.860661],[0.6601861,-0.4931428,1.135561],[0.6616521,1.18839,1.644331],[0.6620438,1.074962,-1.384987],[0.6821615,-0.000678002,2.636683],[0.6839614,-0.04055013,1.725941],[0.6894476,0.2149427,-0.01192862],[0.6949404,0.5229678,2.497046],[0.6986848,-0.4980376,2.825442],[0.6990259,-0.5643375,2.012592],[0.6991893,0.6202146,1.46107],[0.6993843,1.544663,0.8127785],[0.7005457,-0.4277453,2.573062],[0.7017965,-0.05072716,2.005739],[0.7059688,0.1958601,-0.5498515],[0.7063074,0.3483331,1.531156],[0.7063686,-0.401193,1.481672],[0.7103107,0.6155592,-0.08602598],[0.7149282,-0.3669503,1.950617],[0.7190644,-1.239995,1.898843],[0.7191675,0.879049,0.7793949],[0.7194116,0.7379259,0.1561265],[0.7217926,0.5441824,0.285165],[0.7228826,-0.09558261,2.632174],[0.7257633,0.2328128,1.352542],[0.7258689,-0.7180513,2.608454],[0.7265937,-0.727482,1.286657],[0.7330509,1.237069,0.6069199],[0.7333179,1.212949,1.072331],[0.7346393,-0.1016208,0.04196617],[0.7349942,-0.973181,4.279972],[0.7447948,-0.6682532,4.47421],[0.7474535,0.6221689,2.029777],[0.750101,0.03349687,1.29739],[0.7566806,1.51636,0.4575816],[0.762942,-0.218723,3.013749],[0.7657378,2.233111,0.9336308],[0.7663633,0.520906,3.336464],[0.7730812,1.037943,-0.1042973],[0.7756775,1.141181,0.7322435],[0.7794299,2.073365,1.234751],[0.7796202,-0.5780759,2.099144],[0.7816036,-0.7435136,3.899716],[0.7837616,-1.134009,4.247684],[0.794677,-1.73237,2.740359],[0.795813,0.1868927,2.712033],[0.7984712,0.204423,1.169865],[0.8088055,1.69869,1.599823],[0.8102605,0.9114573,0.2768875],[0.8125783,0.8396067,0.5344508],[0.8137961,-1.05725,3.94931],[0.8154704,-0.6849446,0.5145255],[0.8165911,-0.2895471,4.691998],[0.8181116,0.06720286,1.296348],[0.8192981,-0.3252729,2.056689],[0.8227955,0.03979221,1.083273],[0.8307799,-0.1627385,3.608315],[0.8332883,-1.214122,1.372455],[0.842678,0.2784941,2.043195],[0.8440117,1.048427,0.9087468],[0.8443754,-1.693075,3.541551],[0.8444175,-0.09421245,1.267051],[0.8540797,0.3679321,0.9170827],[0.8559347,-1.252325,2.649883],[0.858266,-0.6465485,3.280253],[0.858866,-0.1883112,2.555876],[0.8595388,-0.499197,2.512358],[0.8646113,0.411231,2.469294],[0.8718986,-0.6249118,2.629755],[0.874024,-0.5526579,0.9170651],[0.8762172,0.529792,0.9365227],[0.8793926,0.643692,0.6337548],[0.8817564,0.1395839,1.955048],[0.8863775,0.8972046,0.6590617],[0.8891587,1.215711,1.609231],[0.900728,0.9324763,0.4250135],[0.9057149,0.6823142,0.4885824],[0.9076964,-0.416317,2.014719],[0.9084537,0.6949429,-0.9178451],[0.9140912,-0.9093025,0.1973086],[0.924262,1.927673,0.4606992],[0.9268938,-0.6383561,1.896396],[0.9334897,-0.007077299,0.1664834],[0.938363,0.3645695,0.07093816],[0.9437817,-0.3435735,2.058323],[0.9560228,-0.8847381,1.627543],[0.9639966,-1.017035,0.7572004],[0.9681695,0.5263082,2.139032],[0.9740786,-1.549197,1.976239],[0.9761423,-1.00434,1.825596],[0.9779809,-0.2271872,2.132746],[0.9789228,0.05775052,1.864802],[0.9794235,0.2117296,0.9722829],[0.9841865,0.05842241,2.426779],[0.9852782,0.07966991,1.436332],[0.9858218,0.07910407,-0.03805859],[0.9861898,0.9826269,-0.5232254],[0.9885514,0.4031209,2.643696],[0.9911962,-1.205658,2.761322],[0.9934408,0.3609228,1.121786],[0.9963931,-0.4229334,2.13603],[0.9971988,-0.5663555,2.22789],[0.9985017,1.297845,-0.3544792],[1.002193,0.3562833,1.334909],[1.00391,-0.6578346,2.74446],[1.007932,0.08744075,0.3190172],[1.010066,0.5759991,-0.2179764],[1.013829,0.3318128,1.467036],[1.021658,-0.703763,1.840066],[1.031087,1.438196,2.066553],[1.041873,1.449591,1.464494],[1.044733,-1.699895,3.605109],[1.048975,1.681664,-0.1074733],[1.069495,-0.9347531,3.457362],[1.074361,0.1537946,2.29396],[1.076649,-0.2637312,2.250388],[1.078127,1.99223,-0.5661792],[1.087526,0.5529187,0.02005426],[1.08757,1.245944,-1.118657],[1.089034,0.07774102,1.577018],[1.0987,0.486713,1.899926],[1.100147,-0.4186091,2.626689],[1.116977,-0.8863001,1.881104],[1.120511,0.351116,1.464136],[1.128842,-0.376826,1.137028],[1.130004,-0.3363326,1.597128],[1.130258,0.5543347,0.3791499],[1.13147,-0.7529835,2.808019],[1.131528,0.5197964,0.05156839],[1.146145,-0.02977601,0.03377859],[1.163723,-0.3794269,0.163025],[1.17386,-0.8180157,2.62623],[1.176636,1.200487,-0.7424931],[1.181342,0.4598598,1.243918],[1.184757,-0.5914834,1.923916],[1.184834,-0.9920701,2.029325],[1.205275,-0.1352185,0.928704],[1.205574,0.1586086,2.259396],[1.214449,-0.9179542,2.657125],[1.219097,0.9224253,1.326799],[1.220672,-2.00829,3.321877],[1.223345,-1.206553,2.896635],[1.227066,-1.546939,2.364464],[1.230947,-0.8231011,1.605003],[1.241294,0.4430236,0.6151944],[1.247645,-0.2323574,1.28825],[1.249679,-0.454832,2.186074],[1.253387,-1.760337,2.976147],[1.275546,-0.7000777,2.500336],[1.285474,-1.309284,1.575415],[1.296499,0.2106036,1.304769],[1.299641,1.063733,0.9743221],[1.301635,-0.7583558,1.010439],[1.30557,0.09157401,0.8926269],[1.307852,0.1737596,1.932164],[1.319598,1.552153,1.462643],[1.320976,-0.2364612,2.530191],[1.323102,0.9477182,-0.3581478],[1.324327,-0.4006545,1.665983],[1.326436,-2.580664,-0.4456485],[1.328339,0.6078832,1.220048],[1.337576,1.520377,1.427764],[1.345859,0.4513947,0.3469234],[1.361212,-1.576674,1.590492],[1.365214,0.6730922,0.2837078],[1.368117,1.435469,-0.6861998],[1.36885,-0.29513,0.4974988],[1.37469,0.07462943,1.34262],[1.379665,-0.673241,0.2190945],[1.392312,-1.542966,2.47523],[1.39308,1.774254,-0.4472481],[1.397174,1.220663,1.099823],[1.398609,0.2275815,1.325873],[1.402159,0.6766292,0.18456],[1.402425,-0.8071942,2.102335],[1.413906,0.7526874,-1.02076],[1.417356,0.3393172,1.806903],[1.420605,-1.17539,2.507397],[1.426093,0.2282334,2.299762],[1.431935,0.8353042,0.3439463],[1.435679,-0.1236904,3.117777],[1.442483,1.366589,0.8080252],[1.44294,2.049919,0.7551465],[1.450304,0.5675641,-0.2822984],[1.463976,-1.545916,2.400643],[1.471993,0.2982809,2.915203],[1.477642,0.4024252,0.4488475],[1.484537,-0.2049467,0.5813603],[1.499662,-0.00978148,1.677493],[1.505337,-0.2615486,4.093421],[1.506724,2.055504,2.025491],[1.510263,-1.263216,2.680819],[1.515752,2.258628,1.710589],[1.5279,-0.06133037,1.503782],[1.528424,0.7285649,1.605777],[1.534743,-0.3468552,1.33644],[1.536497,0.5874644,2.328785],[1.567394,0.24921,2.580673],[1.579781,0.9426413,-0.657424],[1.579987,1.118817,0.8972411],[1.581302,0.2363111,1.578807],[1.58247,1.171854,1.858174],[1.609455,0.3880485,2.145264],[1.622459,-0.8689609,3.370993],[1.669838,-0.4627823,-0.4372628],[1.676781,0.02682001,0.6149575],[1.680963,2.012253,-0.12099],[1.681605,1.428012,-1.963375],[1.691578,-0.7770993,1.490536],[1.695398,0.02128843,2.34397],[1.705581,-0.4731601,1.845363],[1.707118,-1.200699,1.121987],[1.7139,0.5729265,4.074151],[1.731521,0.3723077,0.285108],[1.75641,0.606628,0.007890453],[1.766621,1.212579,-1.459454],[1.769599,0.4952146,0.8196507],[1.806026,-0.1915311,-0.07749169],[1.870063,-1.892338,2.148801],[1.880209,0.8265071,1.226135],[1.883507,0.606953,0.4516484],[1.917922,0.4017197,1.584561],[1.937931,1.008319,1.34243],[1.949833,2.639617,0.4026026],[1.954552,-0.9346215,4.157657],[1.998433,1.817571,0.6064554],[2.038341,0.4313566,0.0961144],[2.058909,-0.7519738,2.116267],[2.069897,0.79133,-0.4593246],[2.093863,-1.697546,4.024817],[2.094185,0.1458611,2.47914],[2.113875,0.1347257,2.205594],[2.114576,0.7351252,2.477311],[2.168595,-0.4846854,1.779793],[2.179374,0.08042205,0.5476915],[2.233453,0.6651535,0.6415965],[2.248417,-0.9087933,1.4082],[2.269225,0.5280784,0.8786044],[2.291413,1.498748,0.6363081],[2.347203,-0.6988326,1.618544],[2.46253,-1.337191,2.406801],[2.497741,-1.198027,2.40464],[2.552787,-0.9233572,0.9710835],[2.807748,0.3829763,2.296128],[3.006632,0.7127066,0.7914879],[3.106901,0.6854224,-0.247434],[3.613092,-1.131205,3.422336]],"ignoreExtent":false,"flags":4096},"14":{"id":14,"type":"text","material":{"lit":false},"vertices":[[0.0914129,-3.971207,-6.92158]],"colors":[[0,0,0,1]],"texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0.0914129,-3.971207,-6.92158]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"15":{"id":15,"type":"text","material":{"lit":false},"vertices":[[-4.624115,0.1599851,-6.92158]],"colors":[[0,0,0,1]],"texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-4.624115,0.1599851,-6.92158]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"16":{"id":16,"type":"text","material":{"lit":false},"vertices":[[-4.624115,-3.971207,-0.273191]],"colors":[[0,0,0,1]],"texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-4.624115,-3.971207,-0.273191]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"10":{"id":10,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"9":{"id":9,"type":"background","material":{"fog":true},"colors":[[0.2980392,0.2980392,0.2980392,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"11":{"id":11,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"13":{"id":13,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[-2,"NA","NA"],[0,"NA","NA"],[2,"NA","NA"],["NA",-2,"NA"],["NA",-1,"NA"],["NA",0,"NA"],["NA",1,"NA"],["NA",2,"NA"],["NA",3,"NA"],["NA","NA",-4],["NA","NA",-2],["NA","NA",0],["NA","NA",2],["NA","NA",4]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[24,25,26,27,28,29,30]},"6":{"id":6,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":6,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,33.39945],"modelMatrix":[[1.118826,0,0,-0.1022753],[0,0.4367867,0.7456972,0.1338384],[0,-1.200061,0.2714116,-33.13331],[0,0,0,1]],"projMatrix":[[2.66575,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-120.4011],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1.118826,1.277079,0.7935544],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-3.430266,3.613092,-2.925297,3.245267,-5.23838,4.691998],"windowRect":[20,65,692,545],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rgl/fonts/FreeSans.ttf","maxClipPlanes":6,"glVersion":2.1,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[11,13,12,14,15,16,10,24,25,26,27,28,29,30],"subscenes":[],"flags":6736},"24":{"id":24,"type":"lines","material":{"lit":false},"vertices":[[-2,-3.017855,-5.387336],[2,-3.017855,-5.387336],[-2,-3.017855,-5.387336],[-2,-3.176747,-5.643044],[0,-3.017855,-5.387336],[0,-3.176747,-5.643044],[2,-3.017855,-5.387336],[2,-3.176747,-5.643044]],"colors":[[0,0,0,1]],"centers":[[0,-3.017855,-5.387336],[-2,-3.097301,-5.51519],[0,-3.097301,-5.51519],[2,-3.097301,-5.51519]],"ignoreExtent":true,"origId":13,"flags":64},"25":{"id":25,"type":"text","material":{"lit":false},"vertices":[[-2,-3.494531,-6.154458],[0,-3.494531,-6.154458],[2,-3.494531,-6.154458]],"colors":[[0,0,0,1]],"texts":[["-2"],["0"],["2"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-2,-3.494531,-6.154458],[0,-3.494531,-6.154458],[2,-3.494531,-6.154458]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":13,"flags":2064},"26":{"id":26,"type":"lines","material":{"lit":false},"vertices":[[-3.535917,-2,-5.387336],[-3.535917,3,-5.387336],[-3.535917,-2,-5.387336],[-3.717283,-2,-5.643044],[-3.535917,-1,-5.387336],[-3.717283,-1,-5.643044],[-3.535917,0,-5.387336],[-3.717283,0,-5.643044],[-3.535917,1,-5.387336],[-3.717283,1,-5.643044],[-3.535917,2,-5.387336],[-3.717283,2,-5.643044],[-3.535917,3,-5.387336],[-3.717283,3,-5.643044]],"colors":[[0,0,0,1]],"centers":[[-3.535917,0.5,-5.387336],[-3.6266,-2,-5.51519],[-3.6266,-1,-5.51519],[-3.6266,0,-5.51519],[-3.6266,1,-5.51519],[-3.6266,2,-5.51519],[-3.6266,3,-5.51519]],"ignoreExtent":true,"origId":13,"flags":64},"27":{"id":27,"type":"text","material":{"lit":false},"vertices":[[-4.080016,-2,-6.154458],[-4.080016,-1,-6.154458],[-4.080016,0,-6.154458],[-4.080016,1,-6.154458],[-4.080016,2,-6.154458],[-4.080016,3,-6.154458]],"colors":[[0,0,0,1]],"texts":[["-2"],["-1"],["0"],["1"],["2"],["3"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-4.080016,-2,-6.154458],[-4.080016,-1,-6.154458],[-4.080016,0,-6.154458],[-4.080016,1,-6.154458],[-4.080016,2,-6.154458],[-4.080016,3,-6.154458]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":13,"flags":2064},"28":{"id":28,"type":"lines","material":{"lit":false},"vertices":[[-3.535917,-3.017855,-4],[-3.535917,-3.017855,4],[-3.535917,-3.017855,-4],[-3.717283,-3.176747,-4],[-3.535917,-3.017855,-2],[-3.717283,-3.176747,-2],[-3.535917,-3.017855,0],[-3.717283,-3.176747,0],[-3.535917,-3.017855,2],[-3.717283,-3.176747,2],[-3.535917,-3.017855,4],[-3.717283,-3.176747,4]],"colors":[[0,0,0,1]],"centers":[[-3.535917,-3.017855,0],[-3.6266,-3.097301,-4],[-3.6266,-3.097301,-2],[-3.6266,-3.097301,0],[-3.6266,-3.097301,2],[-3.6266,-3.097301,4]],"ignoreExtent":true,"origId":13,"flags":64},"29":{"id":29,"type":"text","material":{"lit":false},"vertices":[[-4.080016,-3.494531,-4],[-4.080016,-3.494531,-2],[-4.080016,-3.494531,0],[-4.080016,-3.494531,2],[-4.080016,-3.494531,4]],"colors":[[0,0,0,1]],"texts":[["-4"],["-2"],["0"],["2"],["4"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-4.080016,-3.494531,-4],[-4.080016,-3.494531,-2],[-4.080016,-3.494531,0],[-4.080016,-3.494531,2],[-4.080016,-3.494531,4]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":13,"flags":2064},"30":{"id":30,"type":"lines","material":{"lit":false},"vertices":[[-3.535917,-3.017855,-5.387336],[-3.535917,3.337825,-5.387336],[-3.535917,-3.017855,4.840954],[-3.535917,3.337825,4.840954],[-3.535917,-3.017855,-5.387336],[-3.535917,-3.017855,4.840954],[-3.535917,3.337825,-5.387336],[-3.535917,3.337825,4.840954],[-3.535917,-3.017855,-5.387336],[3.718743,-3.017855,-5.387336],[-3.535917,-3.017855,4.840954],[3.718743,-3.017855,4.840954],[-3.535917,3.337825,-5.387336],[3.718743,3.337825,-5.387336],[-3.535917,3.337825,4.840954],[3.718743,3.337825,4.840954],[3.718743,-3.017855,-5.387336],[3.718743,3.337825,-5.387336],[3.718743,-3.017855,4.840954],[3.718743,3.337825,4.840954],[3.718743,-3.017855,-5.387336],[3.718743,-3.017855,4.840954],[3.718743,3.337825,-5.387336],[3.718743,3.337825,4.840954]],"colors":[[0,0,0,1]],"centers":[[-3.535917,0.1599851,-5.387336],[-3.535917,0.1599851,4.840954],[-3.535917,-3.017855,-0.273191],[-3.535917,3.337825,-0.273191],[0.0914129,-3.017855,-5.387336],[0.0914129,-3.017855,4.840954],[0.0914129,3.337825,-5.387336],[0.0914129,3.337825,4.840954],[3.718743,0.1599851,-5.387336],[3.718743,0.1599851,4.840954],[3.718743,-3.017855,-0.273191],[3.718743,3.337825,-0.273191]],"ignoreExtent":true,"origId":13,"flags":64}},"snapshot":"data:image/png;base64,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","width":673,"height":481,"sphereVerts":{"vb":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1],[0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0]],"it":[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288],[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271]],"material":[],"normals":null,"texcoords":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1]],"meshColor":"vertices"},"context":{"shiny":false,"rmarkdown":"bookdown::gitbook"},"crosstalk":{"key":[],"group":[],"id":[],"options":[]}});
test_rglrgl.prefix = "test_rgl";
</script>
<p id="test_rgldebug">
You must enable Javascript to view this page properly.
</p>
<script>test_rglrgl.start();</script>
</div>
<div id="monte-carlo" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Monte Carlo</h2>

<div class="exercise">
<span id="exr:unnamed-chunk-83" class="exercise"><strong>Problem 3.2  </strong></span>Use Monte Carlo to estimate the expected value of the exponential random variable with parameter <span class="math inline">\(\lambda= 4\)</span> using <span class="math inline">\(n=10\)</span>, <span class="math inline">\(n=1,000\)</span> and <span class="math inline">\(1,000,000\)</span> simulations. Compare to the exact value.
</div>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="pipeline.html#cb59-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rexp</span>(<span class="dv">10</span>, <span class="dt">rate =</span> <span class="dv">4</span>)</span>
<span id="cb59-2"><a href="pipeline.html#cb59-2" aria-hidden="true"></a><span class="kw">mean</span>(x)</span>
<span id="cb59-3"><a href="pipeline.html#cb59-3" aria-hidden="true"></a><span class="co">## [1] 0.1779768</span></span></code></pre></div>
<p>For an exponential random variable with parameter <span class="math inline">\(\lambda\)</span>, the expected value is
<span class="math inline">\(1/\lambda\)</span> (such information can be found in <a href="./dist.html">Appendix A</a>) which,
in this case, is <span class="math inline">\(0.25\)</span>. The error made was 0.072023 for <span class="math inline">\(n=10\)</span> simulations.
We increase the number of simulations to <span class="math inline">\(n=1000\)</span> and get a better result</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="pipeline.html#cb60-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rexp</span>(<span class="dv">1000</span>, <span class="dt">rate =</span> <span class="dv">4</span>)</span>
<span id="cb60-2"><a href="pipeline.html#cb60-2" aria-hidden="true"></a><span class="kw">mean</span>(x)</span>
<span id="cb60-3"><a href="pipeline.html#cb60-3" aria-hidden="true"></a><span class="co">## [1] 0.2564643</span></span></code></pre></div>
<p>with (smaller) error -0.0064643. Finally, lets try <span class="math inline">\(n=1,000,000\)</span>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="pipeline.html#cb61-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rexp</span>(<span class="fl">1e+06</span>, <span class="dt">rate =</span> <span class="dv">4</span>)</span>
<span id="cb61-2"><a href="pipeline.html#cb61-2" aria-hidden="true"></a><span class="kw">mean</span>(x)</span>
<span id="cb61-3"><a href="pipeline.html#cb61-3" aria-hidden="true"></a><span class="co">## [1] 0.250381</span></span></code></pre></div>
<p>The error is even smaller -0.00038101.</p>
<!-- This can be obtained quite easily by integration (by parts): -->
<!-- $$ \EE[X] = \int_{-\infty}^{\infty} x f(x)\, dx = \int_0^{\infty} x \ld e^{-\ld x}\, dx = \tfrac{1}{\ld}$$ -->
<p><strong>Comments:</strong></p>
<p><em>R.</em> The only new thing here is the command <code>mean</code> which computes the mean of vector.</p>
<p><em>Math.</em> There is a lot going on here conceptually. This is the first time we used the Monte Carlo method. It is an incredibly method, as you will keep being reminded throughout this class. The idea behind it is simple, and it is based on the <em>Law of large numbers</em>:</p>
<p><strong>Theorem</strong> Let <span class="math inline">\(X_1,X_2, \dots\)</span> be an independent sequence of random variables with the same distribution, for which the expected value can be computed. Then
<span class="math display">\[ \tfrac{1}{n} \Big( X_1+X_2+\dots+X_n\Big) \to {\mathbb{E}}[X_1] \text{ as } n\to\infty\]</span>
The idea behind Monte Carlo is to turn this theorem upside down. The goal is to compute <span class="math inline">\({\mathbb{E}}[X_1]\)</span>, and uses a supply of random numbers, each of which comes from the same distribution to accomplish that. The random number generator inside <code>rexp</code> gives us a supply of numbers (stored in the vector <code>x</code>) and all we have to do is compute their average. This gives us the left-hand side of the formula above, and, if <span class="math inline">\(n\)</span> is large enough, we hope that the this average does not differ too much from its theoretical limit. As <span class="math inline">\(n\)</span> gets larger, we expect better and better results. That is why your error above gets smaller as <span class="math inline">\(n\)</span> increases.</p>
<p>It looks like Monte Carlo can only be used to compute the expected value of a random variable, which does not seem like such a bit deal. It is! You will see in the sequel that almost anything can be written as the expected value of <em>some</em> random variable.</p>

<div class="exercise">
<span id="exr:unnamed-chunk-87" class="exercise"><strong>Problem 3.3  </strong></span>Use Monte Carlo to estimate <span class="math inline">\({\mathbb{E}}[X^2]\)</span>, where <span class="math inline">\(X\)</span> is a standard normal random variable. Do the same thing when <span class="math inline">\(X\)</span> is geometrically distributed with parameter <span class="math inline">\(p=0.5\)</span>.
</div>
<p><strong>Solution.</strong>
When <span class="math inline">\(X\)</span> is standard normal <span class="math inline">\(Y=X^2\)</span> has a <span class="math inline">\(\chi^2\)</span> distribution with one degree of freedom:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="pipeline.html#cb62-1" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">rchisq</span>(<span class="fl">1e+05</span>, <span class="dt">df =</span> <span class="dv">1</span>)</span>
<span id="cb62-2"><a href="pipeline.html#cb62-2" aria-hidden="true"></a><span class="kw">mean</span>(x)</span>
<span id="cb62-3"><a href="pipeline.html#cb62-3" aria-hidden="true"></a><span class="co">## [1] 0.250381</span></span></code></pre></div>
<p>In the second case, we do not know the distribution of <span class="math inline">\(X^2\)</span>, but can still do the following:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="pipeline.html#cb63-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rgeom</span>(<span class="fl">1e+05</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-2"><a href="pipeline.html#cb63-2" aria-hidden="true"></a>y =<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span></span>
<span id="cb63-3"><a href="pipeline.html#cb63-3" aria-hidden="true"></a><span class="kw">mean</span>(y)</span>
<span id="cb63-4"><a href="pipeline.html#cb63-4" aria-hidden="true"></a><span class="co">## [1] 2.99152</span></span></code></pre></div>
<p><strong>Comments:</strong></p>
<p><em>Math+R.</em> We are asked to compute <span class="math inline">\({\mathbb{E}}[ X^2]\)</span>, which can be interpreted in two ways. First, we can think of <span class="math inline">\(Y=X^2\)</span> as a random variable in its own and try to take draws from the distribution of <span class="math inline">\(Y\)</span>. In the case of the normal distribution, the distribution of <span class="math inline">\(Y\)</span> is known - it happens to be a <span class="math inline">\(\chi^2\)</span>-distribution with a single degree of freedom (dont worry if you never heard of it). We can simulate it in R by using its R name <code>chisq</code> and
get a number close to the exact value of <span class="math inline">\(1\)</span>.</p>
<p>The case of a geometric distribution is seemingly more difficult, because we do not know what the distribution of <span class="math inline">\(Y=X^2\)</span> is and there is no corresponding R name to put the prefix <code>r</code> in front of. What makes the simulation possible is the fact that <span class="math inline">\(Y\)</span> is a <em>transformation</em> of
a random variable we know how to simulate. In that case, we simply simulate the required number of draws <code>x</code> from the geometric distribution (using <code>rgeom</code>) and then apply the transformation <span class="math inline">\(x \mapsto x^2\)</span> to the result. The transformed vector <code>y</code> is then nothing but the sequence of draws from the distribution of <span class="math inline">\(X^2\)</span>. Btw, we could have done the same thing in the case of the normal random variable, too - there was no need to recognize its square as a <span class="math inline">\(\chi^2\)</span> random variable:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="pipeline.html#cb64-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e+05</span>)</span>
<span id="cb64-2"><a href="pipeline.html#cb64-2" aria-hidden="true"></a>y =<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span></span>
<span id="cb64-3"><a href="pipeline.html#cb64-3" aria-hidden="true"></a><span class="kw">mean</span>(y)</span>
<span id="cb64-4"><a href="pipeline.html#cb64-4" aria-hidden="true"></a><span class="co">## [1] 1.008819</span></span></code></pre></div>
<p>The idea described above is one of main advantages of the Monte Carlo technique: if you know how to simulated a random variable, you also know how to simulated any (deterministic) function of it. That fact will come into its own a bit later when we start working with several random variables and stochastic processes, but it can be very helpful even in the case of a single random variable, as you will see in the next problem.</p>

<div class="exercise">
<span id="exr:unnamed-chunk-91" class="exercise"><strong>Problem 3.4  </strong></span>Let <span class="math inline">\(X\)</span> be a standard normal random variable. Use Monte Carlo to estimate the probability <span class="math inline">\({\mathbb{P}}[ X &gt; 1 ]\)</span>. Compare to the exact value.
</div>
<p><strong>Solution:</strong>
The estimated probability:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="pipeline.html#cb65-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e+05</span>)</span>
<span id="cb65-2"><a href="pipeline.html#cb65-2" aria-hidden="true"></a>y =<span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb65-3"><a href="pipeline.html#cb65-3" aria-hidden="true"></a>(<span class="dt">p_est =</span> <span class="kw">mean</span>(y))</span>
<span id="cb65-4"><a href="pipeline.html#cb65-4" aria-hidden="true"></a><span class="co">## [1] 0.15732</span></span></code></pre></div>
<p>The exact probability:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="pipeline.html#cb66-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="dv">1</span>)</span>
<span id="cb66-2"><a href="pipeline.html#cb66-2" aria-hidden="true"></a><span class="co">## [1] 0.1586553</span></span></code></pre></div>
<p>The error is -0.0013353.</p>
<p><strong>Comments:</strong></p>
<p><em>R.</em> In R, the symbol <code>&gt;</code> is an operation, which returns a Boolean (<code>TRUE</code> or <code>FALSE</code>) value. For example:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="pipeline.html#cb67-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb67-2"><a href="pipeline.html#cb67-2" aria-hidden="true"></a><span class="co">## [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="pipeline.html#cb68-1" aria-hidden="true"></a><span class="dv">5</span><span class="op">^</span><span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb68-2"><a href="pipeline.html#cb68-2" aria-hidden="true"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>It works with vectors, too, but now the output is a vector of Boolean values:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="pipeline.html#cb69-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb69-2"><a href="pipeline.html#cb69-2" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">-4</span>, <span class="dv">3</span>)</span>
<span id="cb69-3"><a href="pipeline.html#cb69-3" aria-hidden="true"></a>x <span class="op">&gt;</span><span class="st"> </span>y</span>
<span id="cb69-4"><a href="pipeline.html#cb69-4" aria-hidden="true"></a><span class="co">## [1] FALSE  TRUE  TRUE</span></span></code></pre></div>
<p>You can even compare a vector and a scalar:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="pipeline.html#cb70-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb70-2"><a href="pipeline.html#cb70-2" aria-hidden="true"></a>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span></span>
<span id="cb70-3"><a href="pipeline.html#cb70-3" aria-hidden="true"></a><span class="co">##  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span></code></pre></div>
Therefore, the vector <code>y</code> in the solution is a vector of length <span class="math inline">\(100000\)</span> whose elements are either <code>TRUE</code> or <code>FALSE</code>; here are the first 5 rows of the spreadsheet (called a <strong>data frame</strong> or a <strong>tibble</strong> in R) with columns <code>x</code> and <code>y</code> from our solution:
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
x
</th>
<th style="text-align:left;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1.9493
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.1015
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0448
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.1384
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.2573
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
<p>Finally, <code>z</code> contains the <code>mean</code> of <code>y</code>. How do you compute a mean of Boolean values? In R (and many other languages) <code>TRUE</code> and <code>FALSE</code> have default numerical values, usually <span class="math inline">\(1\)</span> and <span class="math inline">\(0\)</span>. This way, when <span class="math inline">\(R\)</span> is asked to compute the <code>sum</code> of a Boolean vector it will effectively count the number of values which are <code>TRUE</code>. Similarly, the <code>mean</code> is the relative proportion of <code>TRUE</code> values.</p>
<em>Math.</em>
We computed the <strong>proportion</strong> of the times <span class="math inline">\(X&gt;1\)</span> (among many simulations of <span class="math inline">\(X\)</span>) and used it to approximate the <strong>probability</strong> <span class="math inline">\({\mathbb{P}}[ X&gt;1]\)</span>. More formally,
we started from a random variable <span class="math inline">\(X\)</span> with a normal distribution and then transformed it into another random variable, <span class="math inline">\(Y\)</span>, by setting <span class="math inline">\(Y=1\)</span> whenever <span class="math inline">\(X&gt;1\)</span> and <span class="math inline">\(0\)</span> otherwise. This is often written as follows
<span class="math display">\[ Y = \begin{cases} 1, &amp; X&gt;1 \\ 0, &amp; X\leq 1.\end{cases}\]</span>
The random variable <span class="math inline">\(Y\)</span> is very special - it can only take values <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> (i.e., its support is <span class="math inline">\(\{0,1\}\)</span>). Such random variables are called <strong>indicator random variables</strong>, and their distribution, called the <strong>Bernoulli distribution</strong>, always looks like this:
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
0
</th>
<th style="text-align:left;">
1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1-p
</td>
<td style="text-align:left;">
p
</td>
</tr>
</tbody>
</table>
<p>for some <span class="math inline">\(p \in [0,1]\)</span>. The parameter <span class="math inline">\(p\)</span> is nothing but the probability <span class="math inline">\({\mathbb{P}}[Y=1]\)</span>.</p>
<p>So why did we decide to transform <span class="math inline">\(X\)</span> into <span class="math inline">\(Y\)</span>? Because of the following simple fact:
<span class="math display">\[ {\mathbb{E}}[ Y] = 1 \times p + 0 \times (1-p) = p.\]</span>
The expected value of an indicator is the probability <span class="math inline">\(p\)</span>, and we know that we can use Monte Carlo whenever we can express the quantity we are computing as an expected value of a random variable we know how to simulate.</p>

<div class="exercise">
<span id="exr:unnamed-chunk-100" class="exercise"><strong>Problem 3.5  </strong></span>Use Monte Carlo to Estimate the value of <span class="math inline">\(\pi\)</span> and compute the error.
</div>
<p><strong>Solution.</strong></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="pipeline.html#cb71-1" aria-hidden="true"></a>nsim =<span class="st"> </span><span class="fl">1e+06</span></span>
<span id="cb71-2"><a href="pipeline.html#cb71-2" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">runif</span>(nsim, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb71-3"><a href="pipeline.html#cb71-3" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">runif</span>(nsim, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb71-4"><a href="pipeline.html#cb71-4" aria-hidden="true"></a>z =<span class="st"> </span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb71-5"><a href="pipeline.html#cb71-5" aria-hidden="true"></a>(<span class="dt">pi_est =</span> <span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(z))</span>
<span id="cb71-6"><a href="pipeline.html#cb71-6" aria-hidden="true"></a><span class="co">## [1] 3.141728</span></span>
<span id="cb71-7"><a href="pipeline.html#cb71-7" aria-hidden="true"></a>(<span class="dt">err =</span> pi_est <span class="op">-</span><span class="st"> </span>pi)</span>
<span id="cb71-8"><a href="pipeline.html#cb71-8" aria-hidden="true"></a><span class="co">## [1] 0.0001353464</span></span></code></pre></div>
<p>Since we know the exact value of <span class="math inline">\(\pi\)</span>, we can compute the error <code>{r} format(err, digits=5)</code>.</p>
<p><strong>Comments.</strong>:</p>
<p><em>Math.</em>
<img src="pics/mc_pi.gif" width="50%" style="float:right; padding:10px" style="display: block; margin: auto;" />
As we learned in the previous problem, probabilities of events can be computed using Monte Carlo, as long as we know how to simulate the underlying indicator random variable. In this case, we want to compute <span class="math inline">\(\pi\)</span>, so we would need to find a situation in which the probability of something is <span class="math inline">\(\pi\)</span>. Of course, <span class="math inline">\(\pi&gt;1\)</span>, so it cannot be a probability of anything, but <span class="math inline">\(\pi/4\)</span> can, and computing <span class="math inline">\(\pi/4\)</span> is as useful as computing <span class="math inline">\(\pi\)</span>. To create the required probabilistic situation we think of the geometric meaning of <span class="math inline">\(\pi\)</span>, and come up with the following scheme. Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> be two independent uniform random variables each with values between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>. We can think of the pair <span class="math inline">\((X,Y)\)</span> as a random point in the square <span class="math inline">\([-1,1]\times [-1,1]\)</span>. This point will sometimes fall inside the unit circle, and sometimes it will not. What is the probability of hitting the circle? Well, since <span class="math inline">\((X,Y)\)</span> is uniformly distributed everywhere inside the square, this probability should be equal to the portion of the area of our square which belongs to the unit circle. The area of the square is <span class="math inline">\(4\)</span> and the area of the circle is <span class="math inline">\(\pi\)</span>, so the required probability is <span class="math inline">\(\pi/4\)</span>. Using the idea from the previous problem, we define the indicator random variable <span class="math inline">\(Z\)</span> as follows
<span class="math display">\[ Z = \begin{cases} 1 &amp; (X,Y) \text{ is inside the unit circle, } \\ 0 &amp; \text{ otherwise.}
\end{cases}
= \begin{cases} 1&amp; X^2+Y^2 &lt; 1, \\ 0 &amp; \text{ otherwise.} \end{cases}\]</span></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-103" class="exercise"><strong>Problem 3.6  </strong></span>1. Write an R function <code>cumavg</code> which computes the sequence of running averages of a vector, i.e., if the input is <span class="math inline">\(x=(x_1,x_2,x_3,\dots, x_n)\)</span>, the output should be
<span class="math display">\[ \Big(x_1, \frac{1}{2} (x_1+x_2), \frac{1}{3}(x_1+x_2+x_3), \dots, \frac{1}{n} (x_1+x_2+\dots+x_n)\Big).\]</span> Test it to check that it really works.</p>
<ol start="2" style="list-style-type: decimal">
<li>Apply <code>cumavg</code> to the vector <span class="math inline">\(4 z\)</span> from the previous problem and plot your results (use a smaller value for <code>nsim</code>. Maybe <span class="math inline">\(1000\)</span>.) Plot the values against their index. Add a read horizontal line at the level <span class="math inline">\(\pi\)</span>. Rerun the same code (including the simulation part) several times.
</div></li>
</ol>
<p><strong>Solution</strong></p>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="pipeline.html#cb72-1" aria-hidden="true"></a>cumavg =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb72-2"><a href="pipeline.html#cb72-2" aria-hidden="true"></a>    c =<span class="st"> </span><span class="kw">cumsum</span>(x)</span>
<span id="cb72-3"><a href="pipeline.html#cb72-3" aria-hidden="true"></a>    n =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)</span>
<span id="cb72-4"><a href="pipeline.html#cb72-4" aria-hidden="true"></a>    <span class="kw">return</span>(c<span class="op">/</span>n)</span>
<span id="cb72-5"><a href="pipeline.html#cb72-5" aria-hidden="true"></a>}</span>
<span id="cb72-6"><a href="pipeline.html#cb72-6" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">9</span>)</span>
<span id="cb72-7"><a href="pipeline.html#cb72-7" aria-hidden="true"></a><span class="kw">cumavg</span>(x)</span>
<span id="cb72-8"><a href="pipeline.html#cb72-8" aria-hidden="true"></a><span class="co">## [1] 1 2 3 3 3 4</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="pipeline.html#cb73-1" aria-hidden="true"></a>nsim =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb73-2"><a href="pipeline.html#cb73-2" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">runif</span>(nsim, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb73-3"><a href="pipeline.html#cb73-3" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">runif</span>(nsim, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb73-4"><a href="pipeline.html#cb73-4" aria-hidden="true"></a>z =<span class="st"> </span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb73-5"><a href="pipeline.html#cb73-5" aria-hidden="true"></a>pi_est =<span class="st"> </span><span class="kw">cumavg</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>z)</span>
<span id="cb73-6"><a href="pipeline.html#cb73-6" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span>nsim, pi_est, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;number of simulations&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;estimate of pi&quot;</span>, </span>
<span id="cb73-7"><a href="pipeline.html#cb73-7" aria-hidden="true"></a>    <span class="dt">main =</span> <span class="st">&quot;Computing pi by Monte Carlo&quot;</span>)</span>
<span id="cb73-8"><a href="pipeline.html#cb73-8" aria-hidden="true"></a><span class="kw">abline</span>(pi, <span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-105-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Comments:</strong></p>
<p><em>R.</em></p>
<p>Part 1: The function <code>cumavg</code> can be written in many ways; the one in the solution is sleek because it does not use any <code>for</code> loops. It is also faster than the other two implementations below. It relies on the fact that many natural operations in R are already vectorized. The builtin function <code>cumsum</code> performs most of the work - once we have partial sums, we simply need to divide each one of them by the index of its position in the vector. If you wanted to use <code>for</code> loops and not rely on the function <code>cumsum</code>, you could write something like this:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="pipeline.html#cb74-1" aria-hidden="true"></a>cumavg =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb74-2"><a href="pipeline.html#cb74-2" aria-hidden="true"></a>    out =<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(x))</span>
<span id="cb74-3"><a href="pipeline.html#cb74-3" aria-hidden="true"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)) {</span>
<span id="cb74-4"><a href="pipeline.html#cb74-4" aria-hidden="true"></a>        p =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb74-5"><a href="pipeline.html#cb74-5" aria-hidden="true"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>i) {</span>
<span id="cb74-6"><a href="pipeline.html#cb74-6" aria-hidden="true"></a>            p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span>x[j]</span>
<span id="cb74-7"><a href="pipeline.html#cb74-7" aria-hidden="true"></a>        }</span>
<span id="cb74-8"><a href="pipeline.html#cb74-8" aria-hidden="true"></a>        out[i] =<span class="st"> </span>p<span class="op">/</span>i</span>
<span id="cb74-9"><a href="pipeline.html#cb74-9" aria-hidden="true"></a>    }</span>
<span id="cb74-10"><a href="pipeline.html#cb74-10" aria-hidden="true"></a>    <span class="kw">return</span>(out)</span>
<span id="cb74-11"><a href="pipeline.html#cb74-11" aria-hidden="true"></a>}</span></code></pre></div>
<p>The statement <code>out = numeric(length(x))</code> is there to ask R to reserve enough room (memory) for a numeric vector the same size as <code>x</code>. It is not necessary, but it is a good idea to get into the habit of doing it because is makes your code both faster and easier to read.</p>
<p>Here is another way, using the <code>sum</code> function:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="pipeline.html#cb75-1" aria-hidden="true"></a>cumavg =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb75-2"><a href="pipeline.html#cb75-2" aria-hidden="true"></a>    out =<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb75-3"><a href="pipeline.html#cb75-3" aria-hidden="true"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)) {</span>
<span id="cb75-4"><a href="pipeline.html#cb75-4" aria-hidden="true"></a>        out =<span class="st"> </span><span class="kw">c</span>(out, <span class="kw">sum</span>(x[<span class="dv">1</span><span class="op">:</span>i])<span class="op">/</span>i)</span>
<span id="cb75-5"><a href="pipeline.html#cb75-5" aria-hidden="true"></a>    }</span>
<span id="cb75-6"><a href="pipeline.html#cb75-6" aria-hidden="true"></a>    <span class="kw">return</span>(out)</span>
<span id="cb75-7"><a href="pipeline.html#cb75-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>The line <code>out = c(out, sum(x[1:i]) / i)</code> appends the value <code>sum(x[1:i]) / i</code> to the end of the vector <code>out</code>. Note that <code>x[1:i]</code> is the vector <code>x</code> indexed by the sequence <code>1:i</code> (i.e., <code>1,2,...,i</code>), which is nothing other than the vector containing the first <code>i</code> elements of <code>x</code>. We also pre-declared the vector <code>out</code> in the statement `out = numeric(0). This time we only made sure that out is an empty numerical vector because of the way we build it incrementally. This is, in general, not a very efficient way of doing things, but it will do just fine for small vectors.</p>
<p>Part 2. This course is not about R graphics, but I think it is a good idea to teach you how to make basic plots in R. This is what the functions <code>plot</code> and <code>abline</code> (and some others) do. I have already mentioned the fact that R has a number of high-quality graphics packages (like <code>ggplot2</code>), but the builtin R graphics is certainly good enough for quick-and-dirty plots.</p>
<p>The main purpose of the function <code>plot</code> is to plot scatterplots:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="pipeline.html#cb76-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb76-2"><a href="pipeline.html#cb76-2" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb76-3"><a href="pipeline.html#cb76-3" aria-hidden="true"></a><span class="kw">plot</span>(x, y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="672" style="display: block; margin: auto;" />
The corresponding entries of vectors <code>x</code> and <code>y</code> are paired (into <span class="math inline">\((1,2)\)</span>, <span class="math inline">\((3,1)\)</span>, <span class="math inline">\((4,5)\)</span> and <span class="math inline">\((7,5)\)</span> in this case) and these pairs are used as coordinates of points. By default, each point is marked by a small circle, but this, and many other things, can be adjusted by numerous additional arguments. One of such arguments is <code>type</code> which determines the type of the plot. We used <code>type="l"</code> which tells R to join the points with straight lines:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="pipeline.html#cb77-1" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb77-2"><a href="pipeline.html#cb77-2" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb77-3"><a href="pipeline.html#cb77-3" aria-hidden="true"></a><span class="kw">plot</span>(x, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-109-1.png" width="672" style="display: block; margin: auto;" />
The other arguments, <code>xlab</code>, <code>ylab</code> and <code>main</code> determine labels for axes and the entire plot. The function <code>abline(a,b)</code> adds a line <span class="math inline">\(y = a x + b\)</span> to an already existing plot. It is very useful in statistics if one wants to show the regression line superimposed on the scatterplot of data. Finally, the argument <code>col</code>, of course, determines the color of the line. To learn about various graphical parameters, type <code>?par</code>.</p>
<p><em>Math.</em></p>
<p>The conceptual reason for this exercise is to explore (numerically) the kinds of errors we make when we use Monte Carlo. Unlike the deterministic numerical procedures, Monte Carlo has a strange property that no bound on the error can be made with absolute certainty. Let me give you an example. Suppose that you have a biased coin, with the probability <span class="math inline">\(0.6\)</span> of heads and <span class="math inline">\(0.4\)</span> of tails. You dont know this probability, and use a Monte Carlo technique to estimate it - you toss your coin <span class="math inline">\(1000\)</span> times and record the number of times you observe <span class="math inline">\(H\)</span>. The law of large numbers suggests that the relative frequency of heads is close to the true probability of <span class="math inline">\(H\)</span>. Indeed, you run a simulation</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="pipeline.html#cb78-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb78-2"><a href="pipeline.html#cb78-2" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;H&quot;</span>), <span class="dv">1000</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb78-3"><a href="pipeline.html#cb78-3" aria-hidden="true"></a>y =<span class="st"> </span>x <span class="op">==</span><span class="st"> &quot;H&quot;</span></span>
<span id="cb78-4"><a href="pipeline.html#cb78-4" aria-hidden="true"></a><span class="kw">mean</span>(y)</span>
<span id="cb78-5"><a href="pipeline.html#cb78-5" aria-hidden="true"></a><span class="co">## [1] 0.594</span></span></code></pre></div>
<p>and get a pretty accurate estimate of <span class="math inline">\(0.594\)</span>. If you run the same code a few more times, you will get different estimates, but all of them will be close to <span class="math inline">\(0.6\)</span>. Theoretically, however, your simulation could have yielded <span class="math inline">\(1000\)</span> Hs, which would lead you to report <span class="math inline">\(p=1\)</span> as the Monte-Carlo estimate. The point is that even though such disasters are theoretically possible, they are exceedingly unlikely. The probability of getting all <span class="math inline">\(H\)</span> in <span class="math inline">\(1000\)</span> tosses of this coin is a number with more than <span class="math inline">\(500\)</span> zeros after the decimal point.</p>
<p>The take-home message is that even though there are no guarantees, Monte Carlo performs well vast majority of the time. The crucial ingredient, however, is the number of simulations. The plot you were asked to make illustrates exactly that. The function <code>cumavg</code> gives you a whole sequence of Monte-Carlo estimates of the same thing (the number <span class="math inline">\(\pi\)</span>) with different numbers of simulations <code>nsim</code>. For small values of <code>nsim</code> the error is typically very large (and very random). As the number of simulations grows, the situations stabilizes and the error decreases. Without going into the theory behind it, let me only mention is that in the majority of practical applications we have the following relationship:
<span class="math display">\[ error \sim \frac{1}{\sqrt{n}}.\]</span>
In words, if you want to double the precision, you need to quadruple the number of simulations. If you want an extra digit in your estimate, you need to multiply the number of simulations by <span class="math inline">\(100\)</span>. Instead of going further into the theory, here is an image where I superimposed <span class="math inline">\(40\)</span> plots like the one you were asked to produce (the red lines are <span class="math inline">\(\pm \frac{4}{\sqrt{n}}\)</span>):</p>
<p><img src="_main_files/figure-html/unnamed-chunk-111-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="conditional-probability-and-independence." class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Conditional probability and independence.</h2>

<div class="exercise">
<span id="exr:unnamed-chunk-112" class="exercise"><strong>Problem 3.7  </strong></span>Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> be two independent geometric random variables with parameters <span class="math inline">\(p=0.5\)</span>, and let <span class="math inline">\(Z=X+Y\)</span>. Compute <span class="math inline">\({\mathbb{P}}[ X = 3| Z = 5]\)</span> using simulation. Compare to the exact value.
</div>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="pipeline.html#cb79-1" aria-hidden="true"></a>nsim =<span class="st"> </span><span class="fl">1e+05</span></span>
<span id="cb79-2"><a href="pipeline.html#cb79-2" aria-hidden="true"></a>X =<span class="st"> </span><span class="kw">rgeom</span>(nsim, <span class="dt">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb79-3"><a href="pipeline.html#cb79-3" aria-hidden="true"></a>Y =<span class="st"> </span><span class="kw">rgeom</span>(nsim, <span class="dt">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb79-4"><a href="pipeline.html#cb79-4" aria-hidden="true"></a>Z =<span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Y</span>
<span id="cb79-5"><a href="pipeline.html#cb79-5" aria-hidden="true"></a>X_cond =<span class="st"> </span>X[Z <span class="op">==</span><span class="st"> </span><span class="dv">5</span>]</span>
<span id="cb79-6"><a href="pipeline.html#cb79-6" aria-hidden="true"></a><span class="kw">mean</span>(X_cond <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb79-7"><a href="pipeline.html#cb79-7" aria-hidden="true"></a><span class="co">## [1] 0.1690112</span></span></code></pre></div>
<p>We have
<span class="math display">\[ {\mathbb{P}}[ X = 3 | Z= 5 ] = \frac{{\mathbb{P}}[ X=3 \text{ and }Z=5]}{{\mathbb{P}}[Z=5]} = \frac{{\mathbb{P}}[X=3 \text{ and }Y = 2]}{{\mathbb{P}}[Z=5]} \]</span>
Since <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, we have <span class="math inline">\({\mathbb{P}}[ X=3 \text{ and }Y=2 ] = {\mathbb{P}}[X=3] {\mathbb{P}}[ Y=2] = 2^{-4} 2^{-3} = 2^{-7}\)</span>. To compute <span class="math inline">\({\mathbb{P}}[ Z = 5]\)</span> we need to split the event <span class="math inline">\(\{ Z = 5 \}\)</span> into events we know how to deal with. Since <span class="math inline">\(Z\)</span> is built from <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, we write
<span class="math display">\[ \begin{align} {\mathbb{P}}[ Z = 5 ] = &amp;{\mathbb{P}}[X=0 \text{ and }Y=5]+ {\mathbb{P}}[ X=1 \text{ and }Y=4] + {\mathbb{P}}[ X=2 \text{ and }Y=3] + \\
&amp;  {\mathbb{P}}[ X=3 \text{ and }Y=2] + {\mathbb{P}}[ X=4 \text{ and }Y=1] + {\mathbb{P}}[ X = 5 \text{ and }Y=0]. \end{align}\]</span>
Each of the individual probabilities in the sum above is <span class="math inline">\(2^{-7}\)</span>, so <span class="math inline">\({\mathbb{P}}[ X = 3 | Z = 5] = \frac{1}{6}\)</span>.
This gives us an error of 0.0023445.</p>
<p><strong>Comments:</strong></p>
<p><em>Math.</em> Let us, first, recall what the conditional probability is. The definition we learn in the probability class is the following <span class="math display">\[ {\mathbb{P}}[A | B] = \frac{{\mathbb{P}}[A \text{ and }B]}{{\mathbb{P}}[B]}\]</span>, as long as <span class="math inline">\({\mathbb{P}}[B]&gt;0\)</span>. The interpretation is that <span class="math inline">\({\mathbb{P}}[A|B]\)</span> is still the probability of <span class="math inline">\(A\)</span>, but now in the world where <span class="math inline">\(B\)</span> is guaranteed to happen. Conditioning usually happens when we receive new information. If someone tells us that <span class="math inline">\(B\)</span> happened, we can disregard everything in the complement of <span class="math inline">\(B\)</span> and adjust our probability to account for that fact. First we remove from <span class="math inline">\(A\)</span> anything that belongs to the complement of <span class="math inline">\(B\)</span>, and recompute the probability <span class="math inline">\({\mathbb{P}}[A \cap B]\)</span>. We also have to divide by <span class="math inline">\({\mathbb{P}}[B]\)</span> because we want the total probability to be equal to <span class="math inline">\(1\)</span>.</p>
<p>Our code starts as usual, but simulating <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> from the required distribution, and constructing a new vector <span class="math inline">\(Z\)</span> as their sum. The variable <code>X_cond</code> is new; we build it from <span class="math inline">\(X\)</span> by removing all the elements whose corresponding <span class="math inline">\(Z\)</span> is <em>not</em> equal to <span class="math inline">\(5\)</span>. This is an example of what is sometimes called the <strong>rejection method</strong> in simulation. We simply reject all simulations which do not satisfy the condition we are conditioning on. We can think of <code>X_cond</code> as bunch of simulations of <span class="math inline">\(X\)</span>, but in the world where <span class="math inline">\(Z=5\)</span> is guaranteed to happen. Once we have <code>X_cond</code>, we proceed as usual by computing the relative frequency of the value <span class="math inline">\(3\)</span> among all possible values <span class="math inline">\(X\)</span> can take. Note that the same <code>X_cond</code> can also be used to compute the conditional probability <span class="math inline">\({\mathbb{P}}[ X=1| Z=5]\)</span>. In fact, <code>X_cond</code> contains the information about the entire <strong>conditional distribution of <span class="math inline">\(X\)</span> given <span class="math inline">\(Z=5\)</span></strong>; if we draw a histogram of <code>X_cond</code>, we will get a good idea of what this distribution looks like:
<img src="_main_files/figure-html/unnamed-chunk-114-1.png" width="672" style="display: block; margin: auto;" />
The histogram above suggests that the distribution of <span class="math inline">\(X\)</span>, given <span class="math inline">\(Z=5\)</span>, is uniform on <span class="math inline">\(\{0,1,2,3,4,5\}\)</span>. It is - a calculation almost identical to the one we performed above gives that <span class="math inline">\({\mathbb{P}}[ X= i| Z=5] = \frac{1}{6}\)</span> for each <span class="math inline">\(i=0,1,2,3,4,5\)</span>.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="simulation-of-random-variables-and-monte-carlo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dist.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": false,
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
